I"‚<h1 class="no_toc" id="2-el-lenguaje-sql">2. El lenguaje SQL</h1>

<ul id="markdown-toc">
  <li><a href="#21-creando-las-tablas-con-sql" id="markdown-toc-21-creando-las-tablas-con-sql">2.1. Creando las tablas con SQL</a>    <ul>
      <li><a href="#211-creaci√≥n-de-tablas-create-table" id="markdown-toc-211-creaci√≥n-de-tablas-create-table">2.1.1. Creaci√≥n de tablas: CREATE TABLE</a></li>
      <li><a href="#212-modificaci√≥n-de-tablas-alter-table" id="markdown-toc-212-modificaci√≥n-de-tablas-alter-table">2.1.2. Modificaci√≥n de tablas: ALTER TABLE</a></li>
      <li><a href="#223-borrado-de-tablas-drop-table" id="markdown-toc-223-borrado-de-tablas-drop-table">2.2.3. Borrado de tablas: DROP TABLE</a></li>
      <li><a href="#214-algunas-consideraciones-sobre-la-integridad-referencial" id="markdown-toc-214-algunas-consideraciones-sobre-la-integridad-referencial">2.1.4. Algunas consideraciones sobre la integridad referencial</a>        <ul>
          <li><a href="#entendiendo-qu√©-es-la-integridad-referencial" id="markdown-toc-entendiendo-qu√©-es-la-integridad-referencial">Entendiendo qu√© es la integridad referencial</a></li>
          <li><a href="#borrado-en-cascada" id="markdown-toc-borrado-en-cascada">Borrado en cascada</a></li>
          <li><a href="#modificaci√≥n-en-cascada" id="markdown-toc-modificaci√≥n-en-cascada">Modificaci√≥n en cascada</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#22-manipulando-los-datos-con-sql" id="markdown-toc-22-manipulando-los-datos-con-sql">2.2. Manipulando los datos con SQL</a>    <ul>
      <li><a href="#221-inserci√≥n-de-datos-insert" id="markdown-toc-221-inserci√≥n-de-datos-insert">2.2.1. Inserci√≥n de datos: INSERT</a></li>
      <li><a href="#222-modificaci√≥n-de-datos-update" id="markdown-toc-222-modificaci√≥n-de-datos-update">2.2.2. Modificaci√≥n de datos: UPDATE</a></li>
      <li><a href="#223-borrado-de-datos-delete" id="markdown-toc-223-borrado-de-datos-delete">2.2.3. Borrado de datos: DELETE</a></li>
    </ul>
  </li>
  <li><a href="#23-buscando-informaci√≥n-con-sql-la-instrucci√≥n-select" id="markdown-toc-23-buscando-informaci√≥n-con-sql-la-instrucci√≥n-select">2.3. Buscando informaci√≥n con SQL: la instrucci√≥n SELECT</a>    <ul>
      <li><a href="#231-seleccionar-columnas-de-una-tabla" id="markdown-toc-231-seleccionar-columnas-de-una-tabla">2.3.1. Seleccionar columnas de una tabla</a></li>
      <li><a href="#232-filtrar-resultados-la-cl√°usula-where" id="markdown-toc-232-filtrar-resultados-la-cl√°usula-where">2.3.2. Filtrar resultados: la cl√°usula WHERE</a></li>
      <li><a href="#233-b√∫squedas-aproximadas-con-caracteres-comod√≠n" id="markdown-toc-233-b√∫squedas-aproximadas-con-caracteres-comod√≠n">2.3.3. B√∫squedas aproximadas con caracteres comod√≠n</a></li>
      <li><a href="#234-ordenar-resultados-con-order-by" id="markdown-toc-234-ordenar-resultados-con-order-by">2.3.4. Ordenar resultados con ORDER BY</a></li>
      <li><a href="#235-agrupar-resultados-con-distinct" id="markdown-toc-235-agrupar-resultados-con-distinct">2.3.5. Agrupar resultados con DISTINCT</a></li>
      <li><a href="#236-funciones-de-agregado-y-group-by" id="markdown-toc-236-funciones-de-agregado-y-group-by">2.3.6. Funciones de agregado y GROUP BY</a></li>
      <li><a href="#237-obtener-resultados-de-varias-tablas-join" id="markdown-toc-237-obtener-resultados-de-varias-tablas-join">2.3.7. Obtener resultados de varias tablas: JOIN</a></li>
      <li><a href="#238-sql-avanzado-introducci√≥n-a-las-subconsultas" id="markdown-toc-238-sql-avanzado-introducci√≥n-a-las-subconsultas">2.3.8. SQL avanzado: introducci√≥n a las subconsultas</a></li>
      <li><a href="#239-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas" id="markdown-toc-239-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas">2.3.9. Otras cuestiones avanzadas: alias y combinaciones de consultas</a></li>
    </ul>
  </li>
  <li><a href="#24-y-c√≥mo-puedo-probar-todo-esto" id="markdown-toc-24-y-c√≥mo-puedo-probar-todo-esto">2.4. ¬øY c√≥mo puedo probar todo esto?</a></li>
  <li><a href="#25-ejercicios" id="markdown-toc-25-ejercicios">2.5. Ejercicios</a>    <ul>
      <li><a href="#ejercicio-1-compa√±√≠a-de-seguros" id="markdown-toc-ejercicio-1-compa√±√≠a-de-seguros">Ejercicio 1: compa√±√≠a de seguros</a></li>
      <li><a href="#ejercicio-1-resuelto" id="markdown-toc-ejercicio-1-resuelto">EJERCICIO 1 RESUELTO:</a></li>
      <li><a href="#ejercicio-2-academia-de-idiomas" id="markdown-toc-ejercicio-2-academia-de-idiomas">Ejercicio 2: academia de idiomas</a></li>
      <li><a href="#soluci√≥n-del-ejercicio-2" id="markdown-toc-soluci√≥n-del-ejercicio-2">Soluci√≥n del ejercicio 2:</a></li>
      <li><a href="#ejercicio-obligatorio-series-de-tv" id="markdown-toc-ejercicio-obligatorio-series-de-tv">Ejercicio obligatorio: Series de TV</a></li>
    </ul>
  </li>
</ul>

<p>Cuando tenemos una base de datos relacional ya dise√±ada, llega el momento de <strong>acceder a esa base de datos para operar con ella</strong>:</p>

<ul>
  <li>En primer lugar, crear las tablas, es decir, las estructuras donde se van a guardar los datos.</li>
  <li>En segundo lugar, operar con los datos: insertar, modificar, borrar y, lo m√°s habitual de todo, buscar informaci√≥n y recuperarla.</li>
</ul>

<p>Para hacer todo eso existe un lenguaje estandarizado que soportan la mayor√≠a de las bases de datos relaciones. Puede que tu nombre te suene: se llama <strong>SQL</strong>, y vamos a dedicar todo este cap√≠tulo a aprenderlo</p>

<h2 id="21-creando-las-tablas-con-sql">2.1. Creando las tablas con SQL</h2>

<p>El lenguaje SQL nos permite <strong>crear las tablas, modificarlas y borrarlas</strong>.</p>

<p>Las instrucciones m√°s importantes para hacer esto son:</p>

<ul>
  <li><strong>CREATE TABLE</strong>: para crear tablas.</li>
  <li><strong>ALTER TABLE</strong>: para modificar una tabla existente.</li>
  <li><strong>DROP TABLE</strong>: para eliminar tablas.</li>
</ul>

<p>Escribiremos, a partir de ahora, las palabras reservadas de SQL en MAY√öSCULA por convenio y para distinguirlas del resto. Realmente, SQL no distingue may√∫sculas de min√∫sculas, as√≠ que puedes escribirlas como prefieras.</p>

<h3 id="211-creaci√≥n-de-tablas-create-table">2.1.1. Creaci√≥n de tablas: CREATE TABLE</h3>

<p>La instrucci√≥n <strong>CREATE TABLE</strong> sirve para <strong>crear tablas</strong> en la base de datos. Tiene much√≠simas posibilidades. No es mi intenci√≥n mostr√°rtelas todas, porque para eso necesitar√≠as un curso de SQL avanzado. Pero, a trav√©s de algunos ejemplos, aprender√°s a usarla a un nivel b√°sico enseguida.</p>

<p>La <strong>sintaxis b√°sica</strong> (que admite montones de a√±adidos, pero que raramente usar√°s, al menos al principio) es esta:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">nombre_de_tabla</span> <span class="p">(</span>
    <span class="n">columna1</span> <span class="n">tipo</span><span class="p">,</span>
    <span class="n">columna2</span> <span class="n">tipo</span><span class="p">,</span>
    <span class="n">columna3</span> <span class="n">tipo</span><span class="p">,</span>
    <span class="n">etc</span><span class="p">.</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Por ejemplo, as√≠ se <strong>crea una tabla</strong> de <em>clientes</em>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>SQL maneja multitud de <strong>tipos de datos</strong>, pero por ahora basta con que conozcas estos:</p>

<ul>
  <li><strong>INTEGER</strong> = n√∫meros enteros. Hay varios subtipos, como BIGINT (entero enorme), SMALLINT (entero peque√±o), etc. Se diferencian entre s√≠ por el n√∫mero m√°s grande que son capaces de almacenar. La mayor√≠a de las veces, INTEGER es m√°s que suficiente.</li>
  <li><strong>VARCHAR</strong> = cadenas de caracteres (se indica la longitud m√°xima entre par√©ntesis).</li>
  <li><strong>CHAR</strong> = cadenas de caracteres. Se diferencia de VARCHAR en que, si no se usan todos los caracteres, se rellenan con espacios. Con los VARCHAR no sucede eso: los caracteres que no se usan, simplemente, no existen. Ante la duda, usa siempre VARCHAR en lugar de CHAR.</li>
  <li><strong>DECIMAL</strong> = n√∫meros reales (se indica entre par√©ntesis la cantidad de cifras antes y despu√©s de la coma decimal)</li>
  <li><strong>DATE</strong> = fechas.</li>
  <li><strong>TIME</strong> = horas.</li>
  <li><strong>DATETIME</strong> = fecha y hora.</li>
  <li><strong>BLOB</strong> = informaci√≥n binaria as√≠, en general. Los campos BLOB pueden usarse para guardar im√°genes, archivos ejecutables, secuencias de v√≠deo o de audio‚Ä¶</li>
  <li><strong>TEXT</strong> = informaci√≥n de texto de grandes dimensiones, que no nos quepa dentro de un VARCHAR o un CHAR.</li>
</ul>

<p>Ahora vamos a utilizar <strong>algunos modificadores</strong> en la tabla <em>clientes</em>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="k">COLLATE</span> <span class="n">utf8</span><span class="o">-</span><span class="n">spanish</span><span class="o">-</span><span class="n">ci</span><span class="p">;</span>
</code></pre></div></div>

<p>F√≠jate en que hemos a√±adido algunas cosas a algunas columnas:</p>

<ul>
  <li><strong>NOT NULL</strong> significa que ese campo no puede quedarse en blanco, es decir, que todos los clientes deben tener obligatoriamente un valor asignado en ese campo.</li>
  <li><strong>UNIQUE</strong> significa que el valor de ese campo no puede repetirse, esto es, que debe ser diferente en todos los clientes de la tabla.</li>
  <li><strong>AUTO_INCREMENT</strong> hace que la base de datos, cada vez que se inserta un registro, asigne a este campo el n√∫mero entero inmediatamente superior al que se asign√≥ al √∫ltimo registro insertado. Solo funciona con campos de tipo INTEGER. Suele utilizarse en el campo ID de las tablas para no tener que ocuparnos de insertar nosotros un n√∫mero manualmente.</li>
  <li><strong>PRIMARY KEY</strong> especifica cual es la clave primaria de la tabla. Pueden ponerse varios campos, separados por comas. Lo l√≥gico es que la clave sea NOT NULL y UNIQUE al mismo tiempo.</li>
</ul>

<p>Tambi√©n hemos a√±adido algunos modificadores que afectan a toda la tabla, no solo a algunos campos:</p>
<ul>
  <li><strong>CHARACTER SET</strong> indica la condificaci√≥n de caracteres que va a usarse en la tabla.</li>
  <li><strong>COLLATE</strong> indica c√≥mo van a ordenarse los caracteres en la tabla. Por ejemplo, usando utf8-spanish-ci nos aseguramos de que la √ë va entre la N y la P. Si us√°semos otras colaciones, la √ë se ordenar√≠a despu√©s de la Z.</li>
</ul>

<p>Los modificadores que se pueden emplear con un CREATE TABLE son muy numerosos, pero la mayor√≠a se usan con muy poca frecuencia. Los principales son los que hemos visto en este ejemplo.</p>

<p>Otro modificadorde uso frecuente es el que se emplea para la creaci√≥n de <strong>claves ajenas</strong>. Obs√©rvalo en este otro ejemplo:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
   <span class="n">id_ciudad</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
   <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_ciudad</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">ciudades</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="k">COLLATE</span> <span class="n">utf8</span><span class="o">-</span><span class="n">spanish</span><span class="o">-</span><span class="n">ci</span><span class="p">;</span>
</code></pre></div></div>

<p>Hemos a√±adido el campo <em>id_ciudad</em> que, obviamente, es una clave ajena que pertenece a la tabla <em>ciudades</em>. Pues bien, para informar a la base de datos que ese campo, en efecto, es una clave ajena, hay que usar FOREIGN KEY, indic√°ndole la tabla (<em>ciudades</em>) y el campo (<em>id</em>) al que est√° enlazada nuestra clave ajena.</p>

<p>Por √∫ltimo, debes saber que tanto a restricci√≥n de clave primaria como a las restricciones de claves ajenas puede <strong>asign√°rseles un nombre</strong>. Esto es importante si luego queremos modificar esas claves sin necesidad de borrar toda la tabla (con la consiguiente p√©rdida de datos) para volver a crearla. Se hace as√≠:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="p">...</span>
   <span class="k">CONSTRAINT</span> <span class="n">pk_clientes</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
   <span class="k">CONSTRAINT</span> <span class="n">fk_clientes_ciudades</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_ciudad</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">ciudades</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Como ves, basta con a√±adir <strong>CONSTRAINT nombre</strong> a la restricci√≥n de clave primaria o de clave ajena. Esto asigna un nombre a esa restricci√≥n para poder referirnos a √©l m√°s adelante (ver ALTER TABLE).</p>

<p>El nombre para las restricciones de clave primaria suele empezar por las letras <em>pk_</em> (de ‚Äúprimary key‚Äù) y el de las restricciones de clave ajena por <em>fk_</em> (de ‚Äúforeign key‚Äù), pero esto solo es una convenci√≥n que no tienes por qu√© respetar.</p>

<h3 id="212-modificaci√≥n-de-tablas-alter-table">2.1.2. Modificaci√≥n de tablas: ALTER TABLE</h3>

<p>La <strong>modificaci√≥n de la estructura de una tabla</strong> que ya existe se hace con la instrucci√≥n <strong>ALTER TABLE</strong>.</p>

<p>Vamos a ver c√≥mo trabaja esta instrucci√≥n con unos ejemplos basado en la tabla <em>clientes</em> del apartado anterior. De nuevo, ALTER TABLE tiene much√≠simas opciones, pero las que te voy a mostrar en estos ejemplos cubren el 99% de los usos habituales.</p>

<p>En primer lugar, si queremos <strong>a√±adir un campo</strong> (o varios) a una tabla ya existente, haremos esto:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">clientes</span>
    <span class="k">ADD</span> <span class="n">telefono</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div></div>

<p>Tambi√©n podemos <strong>eliminar un campo</strong> (o columna) existente (cuidado: todos los datos de ese campo se perder√°n):</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">clientes</span>
    <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">email</span><span class="p">;</span>
</code></pre></div></div>

<p>Podemos, asimismo, <strong>renombrar campos</strong>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">clientes</span>
    <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">email</span> <span class="k">TO</span> <span class="n">correo_electronico</span><span class="p">;</span>
</code></pre></div></div>

<p>O podemos <strong>modificar campos</strong>, cambiando su tipo o sus restricciones (¬°Ojo! Esto puede afectar a los datos que haya almacenados en ese campo, si la tabla ya tiene datos, puesto que el SGBD intentar√° convertirlos de un tipo de dato a otro. Si no lo consigue, la instrucci√≥n fallar√°):</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="n">telefono</span> <span class="nb">INTEGER</span><span class="p">;</span>
</code></pre></div></div>

<p>Por √∫ltimo, con ALTER TABLE se pueden <strong>crear o borrar las restricciones</strong> de la tabla, tales como claves primarias o claves ajenas.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">pk_clientes</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</code></pre></div></div>

<p>Para borrar una restricci√≥n, tendremos que haberles asignado un nombre al crear la tabla. As√≠:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">pk_clientes</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="223-borrado-de-tablas-drop-table">2.2.3. Borrado de tablas: DROP TABLE</h3>

<p>El <strong>borrado de tablas</strong> se hace en sql con la instrucci√≥n <strong>DROP TABLE</strong>. Es muy f√°cil de usar, puesto que solo hay que indicar el nombre de la tabla que queremos borrar.</p>

<p>¬°Mucho cuidado! Esta acci√≥n es destructiva y perder√°s todos los datos que hubiera almacenados en esa tabla.</p>

<p>Por ejemplo, para borrar la tabla <em>clientes</em> de los ejemplos anteriores, escribir√≠amos esto:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">clientes</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="214-algunas-consideraciones-sobre-la-integridad-referencial">2.1.4. Algunas consideraciones sobre la integridad referencial</h3>

<p>La <strong>integridad referencial</strong> es un mecanismo de seguridad de las bases de datos que asegura que la informaci√≥n entre las claves ajenas y las claves primarias a las que hacen referencia permanezca siempre bien sincronizada.</p>

<p>Enseguida pondremos un ejemplo en el que lo entender√°s muy bien. Ahora lo importante es que quede claro esto: perder esa sincronizaci√≥n entre clave ajena y clave primaria (es decir, romper la integridad referencial) es equivalente a perder datos. Y, si una base de datos va por ah√≠ perdiendo datos, ¬øpara qu√© narices sirve?</p>

<h4 id="entendiendo-qu√©-es-la-integridad-referencial">Entendiendo qu√© es la integridad referencial</h4>

<p>En el siguiente ejemplo se ve muy bien en qu√© consiste la <strong>p√©rdida de integridad referencial</strong> y los problemas de p√©rdida de datos que causa.</p>

<p>Imaginemos dos tablas de una base de datos m√°s grande (por ejemplo, de una biblioteca): la tabla <strong><em>libros</em></strong> contiene informaci√≥n sobre los libros (<em>cod_libro</em> y <em>t√≠tulo</em>, entre otros campos), mientras que la tabla <strong><em>autores</em></strong> contiene informaci√≥n sobre los autores de los libros (<em>cod_autor</em> y <em>nombre</em>, entre otros campos).</p>

<p>La tabla <em>libros</em> tiene una clave ajena, <em>cod_autor</em>, que es un campo que en realidad pertenece a la tabla <em>autores</em> pero que expandimos hasta <em>libros</em> para implementar la relaci√≥n 1:N entre ambas entidades. ¬°Repasa el cap√≠tulo anterior, sobre dise√±o de bases de datos, si no sabes de lo que estamos hablando!</p>

<p>(En realidad, la relaci√≥n entre <em>libros</em> y <em>autores</em> es N:N, porque un libro puede ser escrito por muchos autores y cada autor puede escribir muchos libros, pero aqu√≠ la consideramos una 1:N para simplificar el ejemplo)</p>

<p>Este es el aspecto que podr√≠an tener esas dos tablas o, al menos, un fragmento de ellas:</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial.png" alt="Ejemplo de integridad referencial" /></p>

<p>No hay que se un lince para darse cuenta de que todos los c√≥digos de autor que aparecen en la tabla <em>libros</em> se corresponden con autores que <strong>realmente existen</strong> en la tabla <em>autores</em>.</p>

<p>¬øPero qu√© pasar√≠a si, por cualquier raz√≥n, un c√≥digo de autor inexistente acabase por error en la tabla de <em>libros</em>? Entonces tendr√≠amos algo como esto:</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-rota.png" alt="Ejemplo de integridad referencial rota" /></p>

<p>Ah√≠ lo tenemos: el libro 484 (‚ÄúAna Karenina‚Äù) est√° asociado al autor 32, que <em>no existe en la tabla de autores</em>. ¬øEl resultado? <strong>Hemos perdido informaci√≥n</strong>. Ya no hay manera de saber qui√©n escribi√≥ ese libro. Es lo mismo que si hubi√©semos borrado un registro, o parte de un registro, de una tabla, aunque en realidad nadie ha borrado nada.</p>

<p>Te puedes estar diciendo: ‚ÄúS√≠, claro, ¬øpero qui√©n va a ser tan idiota de escribir un c√≥digo que no existe en el campo <em>cod_autor</em>?‚Äù</p>

<p>Hay cientos de razones por las que el c√≥digo equivocado puede acabar asignado a una clave ajena: puede tratarse de un error de programaci√≥n en la aplicaci√≥n cliente, puede haber un fallo de comunicaciones, puede ocurrir un problema de concurrencia, puede que alguien elimine, a prop√≥sito o sin querer, un autor que ya ten√≠a libros asignados.</p>

<p>Y s√≠, tambi√©n hay gente idiota en el mundo, esto es incuestionable. Y algunos podr√≠an acabar usando nuestra base de datos.</p>

<p>Como el problema de la integridad referencial es tan frecuente y potencialmente devastador, <strong>las bases de datos se autoprotegen e impiden que la integridad referencial pueda violarse</strong>.</p>

<p>El efecto colateral de esta obsesi√≥n por la protecci√≥n de los datos es que <em>no podr√°s insertar los datos en cualquier orden</em>. En el ejemplo anterior, tendr√°s que insertar primero al autor del libro en la tabla <em>autores</em> y luego al libro en la tabla <em>libros</em>, y no al rev√©s, porque en tal caso estar√≠as violando la integridad referencial.</p>

<h4 id="borrado-en-cascada">Borrado en cascada</h4>

<p>El <strong>borrado en cascada</strong> es una de las formas que tiene la base de datos de proteger la integridad referencial.</p>

<p>Uno de los errores m√°s frecuentes que provoca la violaci√≥n de la integridad referencial es el borrado de un registro de una tabla que est√° referenciado en otra tabla como clave ajena.</p>

<p>Para entenderlo mejor, vamos a volver sobre nuestro ejemplo de la tabla <strong><em>libros</em></strong> y la tabla <strong><em>autores</em></strong>. Supongamos que vamos a borrar un autor (el que tiene c√≥digo 4):</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-borrado-1.png" alt="Ejemplo de integridad referencial - Borrado" /></p>

<p>El resultado de borrar ese registro es que se rompe la integridad referencial, porque el libro 485 har√° referencia a un autor que ya no existe:</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-borrado-2.png" alt="Ejemplo de integridad referencial - Borrado" /></p>

<p>La base de datos impedir√° este borrado para no violar la integridad referencial. Pero se puede hacer algo m√°s: <strong>activar el borrado en cascada</strong>.</p>

<p>Cuando se activa el borrado en cascada para una clave ajena, la base de datos se encargar√° de eliminar los registros adecuados si se borra un registro de la tabla a la que hace referencia esa clave ajena. As√≠ tambi√©n se protege la integridad referencial.</p>

<p>En el ejemplo anterior, al borrar el autor 4, tambi√©n se borrar√°n en cascada (¬°y autom√°ticamente!) <em>todos los libros escritos por ese autor</em>:</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-borrado-3.png" alt="Ejemplo de integridad referencial - Borrado" /></p>

<p>El borrado en cascada se habilita durante la creaci√≥n de la tabla con el modificador <strong>ON DELETE CASCADE</strong>. Por ejemplo, si queremos habilitarlo para la tabla <em>libros</em> anterior:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">libros</span> <span class="p">(</span>
    <span class="n">cod_libro</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">titulo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">cod_autor</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">autores</span><span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="modificaci√≥n-en-cascada">Modificaci√≥n en cascada</h4>

<p>La <strong>modificaci√≥n de registros</strong> tambi√©n puede provocar <strong>fallos de integridad referencial</strong>.</p>

<p>Por ejemplo: ¬øqu√© ocurre si modificamos la clave de un registro de nuestra tabla de <em>autores</em>?</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-modificacion-1.png" alt="Ejemplo de integridad referencial - Modificaci√≥n" /></p>

<p>Aqu√≠ lo tenemos otra vez: al cambiar el c√≥digo del autor ‚ÄúBenito P√©rez Gald√≥s‚Äù de 4 a 5, el libro 485 vuelve a quedarse sin autor. ¬°Hemos perdido informaci√≥n de nuevo!</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-modificacion-2.png" alt="Ejemplo de integridad referencial - Modificaci√≥n" /></p>

<p>Como en el caso del borrado, la base de datos <strong>nos prohibir√°</strong> hacer este tipo de cosas para <strong>proteger la integridad referencial</strong>.</p>

<p>Y, como en el caso del borrado, tambi√©n existe la posibilidad de habilitar la <strong>actualizaci√≥n o modificaci√≥n en cascada</strong>, de manera que, si cambia el valor de una clave primaria, pueda modificarse el valor de la clave ajena autom√°ticamente:</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-modificacion-3.png" alt="Ejemplo de integridad referencial - Modificaci√≥n" /></p>

<p>Para habilitar la modificaci√≥n en cascada, hay que especificarlo con <strong>ON UPDATE CASCADE</strong> durante la creaci√≥n en la clave ajena:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">libros</span> <span class="p">(</span>
    <span class="n">cod_libro</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">titulo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">cod_autor</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">autores</span><span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Como ves en este c√≥digo, la actualizaci√≥n y el borrado en cascada pueden usarse simult√°neamente. Tambi√©n pueden habilitarse m√°s tarde, cuando la tabla ya est√° en uso, mediante un <strong>ALTER TABLE</strong>.</p>

<h2 id="22-manipulando-los-datos-con-sql">2.2. Manipulando los datos con SQL</h2>

<p>Hasta aqu√≠ hemos visto c√≥mo SQL nos permite crear la estructura de la base de datos, es decir, las tablas con sus campos, tipos, restricciones, etc.</p>

<p>Pero a√∫n no lo hemos usado para <strong>almacenar y manipular datos</strong>, que es el objetivo final de toda base de datos. De eso se encarga otra parte de SQL llamada <strong>DML</strong> (lenguaje de manipulaci√≥n de datos).</p>

<p>En realidad, la creaci√≥n de la estructura se hace solo una vez, cuando la base de datos se construye. Cuando la base de datos ya est√° en uso, raramente se altera la estructura, puesto que ser√≠a como modificar la estructura de una casa cuando ya est√° habitada: hay que meterse de alba√±iles y eso siempre es un engorro.</p>

<p><em>Durante la inmensa mayor√≠a del tiempo de explotaci√≥n de una base de datos, el SQL que se utiliza es el que vamos a ver en esta secci√≥n.</em></p>

<p>SQL tiene varias instrucciones para manipular datos, pero nos vamos a centrar en las cuatro m√°s importantes:</p>

<ul>
  <li><strong>INSERT</strong>: sirve para insertar datos en una tabla.</li>
  <li><strong>UPDATE</strong>: modifica datos ya existentes.</li>
  <li><strong>DELETE</strong>: elimina datos de una tabla.</li>
  <li><strong>SELECT</strong>: consulta datos de una o varias tablas.</li>
</ul>

<p>Insisto en la idea: estas instrucciones act√∫an a nivel de datos, es decir, de <em>registros</em> o <em>filas</em> de las tablas. Insertan, modifican y borran registros. Para insertar, modificar y borrar <em>campos</em> est√° el lenguaje de definici√≥n de datos, es decir, CREATE TABLE, ALTER TABLE o DROP TABLE.</p>

<h3 id="221-inserci√≥n-de-datos-insert">2.2.1. Inserci√≥n de datos: INSERT</h3>

<p>La instrucci√≥n <strong>INSERT</strong> se utiliza para <strong>insertar registros en una tabla</strong>.</p>

<p>Como siempre, vamos a aprender a utilizarla mediante algunos ejemplos.</p>

<p>Supongamos que tenemos una tabla llamada <em>personas</em> con los siguientes campos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PERSONAS(id, nombre, apellido1, apellido2, estatura, fecha_nacimiento, pais_nacimiento)
</code></pre></div></div>

<p>Esta tabla se habr√° creado mediante esta instrucci√≥n:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">personas</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">INTEGER</span><span class="p">,</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">pais_nacimiento</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Pues bien: para <strong>insertar una fila</strong> en esta tabla, basta con escribir esta instrucci√≥n <strong>INSERT</strong>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">personas</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">estatura</span><span class="p">,</span> <span class="n">fecha_nacimiento</span><span class="p">,</span> <span class="n">pais_nacimiento</span><span class="p">)</span>
       <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Jos√©'</span><span class="p">,</span> <span class="s1">'P√©rez'</span><span class="p">,</span> <span class="s1">'S√°nchez'</span><span class="p">,</span> <span class="s1">'179'</span><span class="p">,</span> <span class="s1">'13/12/1998'</span><span class="p">,</span> <span class="s1">'M√©xico'</span><span class="p">);</span>
</code></pre></div></div>

<p>En este c√≥digo puedes observar varias cosas curiosas:</p>

<ul>
  <li>No indicamos el valor del campo <em>id</em> porque lo hemos declarado como AUTO_INCREMENT y la base de datos se encargar√° de asignarle un valor autom√°ticamente.</li>
  <li>Primero indicamos una lista de campos y luego una lista de valores. Los valores se asignar√°n a los campos en el mismo orden en el que est√°n escritos.</li>
  <li>No hacemos distinci√≥n entre campos de texto, num√©ricos o fechas: todos los valores se escriben entre comillas. Da igual que sean comillas simples (‚Äò) o dobles (‚Äú): SQL admite las dos. De hecho, los n√∫meros pueden escribirse sin comillas, pero, para evitar errores, mi recomendaci√≥n es que escribas todos los valores, siempre, entre comillas.</li>
</ul>

<p>Es posible no asignar valores a todos los campos. Por ejemplo, <em>estatura</em>, <em>fecha_nacimiento</em> y <em>pais_nacimiento</em> no est√°n declarados como NOT NULL, es decir, que se pueden dejar en blanco, as√≠ que este INSERT tambi√©n funcionar√≠a:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">personas</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">)</span>
       <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Susana'</span><span class="p">,</span> <span class="s1">'Garc√≠a'</span><span class="p">,</span> <span class="s1">'Moreno'</span><span class="p">);</span>
</code></pre></div></div>

<p>En cambio, si intentamos dejar en blanco el nombre o uno de los dos apellidos, el INSERT fallar√°.</p>

<h3 id="222-modificaci√≥n-de-datos-update">2.2.2. Modificaci√≥n de datos: UPDATE</h3>

<p>La <strong>modificaci√≥n o actualizaci√≥n de registros</strong> se hace mediante la instrucci√≥n <strong>UPDATE</strong>.</p>

<p>La podemos ver en acci√≥n en este ejemplo basado en la misma tabla <em>personas</em> del apartado anterior:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Luis'</span>
   <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</code></pre></div></div>

<p>Lo que hace UPDATE es localizar un registro que coincida con la condici√≥n expresada en la cl√°usula WHERE, el decir, localiza el registro cuyo id valga 18, y modifica el valor del campo <em>nombre</em> de ese registro, asign√°ndole el valor ‚ÄúLuis‚Äù.</p>

<p>Se pueden actualizar varios campos a la vez:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Luis'</span><span class="p">,</span>
       <span class="n">estatura</span> <span class="o">=</span> <span class="s1">'180'</span>
   <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
</code></pre></div></div>

<p>Y tambi√©n se puede usar otra condici√≥n que no sea sobre el campo <em>id</em>. Por ejemplo, esta instrucci√≥n UPDATE actualizar√° todos los nombres almacenados como ‚ÄúPaco‚Äù y los cambiar√° por ‚ÄúFrancisco‚Äù.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Francisco'</span>
   <span class="k">WHERE</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Paco'</span><span class="p">;</span>
</code></pre></div></div>

<p>Por lo tanto, un UPDATE puede afectar 0, 1 o muchas filas de la tabla. ¬°Mucho cuidado con ejecutar un UPDATE sin cl√°usula WHERE! Esa actualizaci√≥n afectar√° a <strong>todos los registros</strong> de la tabla:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Francisco'</span><span class="p">;</span>
</code></pre></div></div>

<p>¬°Acabamos de cambiar el nombre de todas las personas de nuestra base de datos!</p>

<h3 id="223-borrado-de-datos-delete">2.2.3. Borrado de datos: DELETE</h3>

<p>Para <strong>eliminar registros</strong> utilizamos la instrucci√≥n <strong>DELETE</strong>.</p>

<p>Aqu√≠ tienes un ejemplo sobre la tabla <em>personas</em>. Vamos a borrar la persona con id = 18:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">personas</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</code></pre></div></div>

<p>Al igual que UPDATE, DELETE localizar√° el registro (o registros) que coincida con la condici√≥n expresada en la cl√°usula WHERE. Y, una vez localizado, lo borrar√°.</p>

<p>Obviamente, DELETE es una <strong>instrucci√≥n destructiva</strong> y debe usarse con cautela.</p>

<p>Se pueden borrar varios registros a la vez. Por ejemplo, as√≠ borraremos a todas las personas cuyo primer apellido sea ‚ÄúP√©rez‚Äù:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">personas</span> <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="s1">'P√©rez'</span><span class="p">;</span>
</code></pre></div></div>

<p>Y as√≠ borramos <strong>todos los registros</strong> de una tabla y la dejamos completamente vac√≠a. ¬°Util√≠zalo solo cuando est√©s muy seguro/a de lo que est√°s haciendo!</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="23-buscando-informaci√≥n-con-sql-la-instrucci√≥n-select">2.3. Buscando informaci√≥n con SQL: la instrucci√≥n SELECT</h2>

<p>Para <strong>buscar datos</strong> entre las tablas de una base de datos se usa la sentencia <strong>SELECT</strong>. Estas b√∫squedas suelen recibir el nombre de <strong>consultas</strong>.</p>

<p>El resultado de una b√∫squeda de datos tiene forma de tabla y est√° constituido por el conjunto de datos que cumplen unos <strong>criterios de b√∫squeda</strong>, porque, para buscar datos con SQL, no hace falta indicarle a la base de datos c√≥mo hacer la b√∫squeda, sino <em>qu√© datos tiene que buscar</em>. Y ella se encarga de todo.</p>

<p>S√≠, es incre√≠ble, pero funciona.</p>

<p>La sentencia SELECT es, probablemente, la m√°s compleja del lenguaje SQL. Sin embargo, no necesitas conocerla en profundidad para sacarle partido. La mayor parte del tiempo, SELECT se usa en alguna de sus formas m√°s simples. Si m√°s adelante te vuelves un experto/a en bases de datos, ya aprender√°s los usos m√°s complejos.</p>

<p>Para comprender mejor los siguientes ejemplos, vamos a suponer que nuestra tabla <em>personas</em> contiene estos siete registros (que quede claro que, en un caso real, la tabla podr√≠a tener cientos o miles de registros):</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>nombre</th>
      <th>apellido1</th>
      <th>apellido2</th>
      <th>estatura</th>
      <th>fecha_nacimiento</th>
      <th>pais_nacimiento</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Antonia</td>
      <td>L√≥pez</td>
      <td>Zapata</td>
      <td>171</td>
      <td>18/02/2002</td>
      <td>Espa√±a</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Micaela</td>
      <td>Cruz</td>
      <td>Ortega</td>
      <td>168</td>
      <td>23/03/1993</td>
      <td>M√©xico</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Luis Fernando</td>
      <td>Guzm√°n</td>
      <td>Rojas</td>
      <td>174</td>
      <td>01/01/2001</td>
      <td>Colombia</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Juan</td>
      <td>L√≥pez</td>
      <td>Guti√©rrez</td>
      <td>191</td>
      <td>28/02/1997</td>
      <td>Argentina</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Esteban</td>
      <td>L√≥pez</td>
      <td>L√≥pez</td>
      <td>166</td>
      <td>07/09/2001</td>
      <td>M√©xico</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Ana Luc√≠a</td>
      <td>Smith</td>
      <td>L√≥pez</td>
      <td>185</td>
      <td>19/01/2000</td>
      <td>Argentina</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Fernando Jos√©</td>
      <td>Delgado</td>
      <td>Aguas</td>
      <td>157</td>
      <td>17/08/1969</td>
      <td>M√©xico</td>
    </tr>
  </tbody>
</table>

<h3 id="231-seleccionar-columnas-de-una-tabla">2.3.1. Seleccionar columnas de una tabla</h3>

<p>La sintaxis m√°s b√°sica concebible de una sentencia SELECT funcional es esta:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">columna1</span><span class="p">,</span> <span class="n">columna2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">columnaN</span>
  <span class="k">FROM</span> <span class="n">nombre_tabla</span><span class="p">;</span>
</code></pre></div></div>
<p>Por ejemplo, esta instrucci√≥n nos devolver√° todos los registros de la tabla <em>personas</em>, pero seleccionando solo las columnas <em>nombre</em>, <em>apellido1</em> y <em>apellido2</em> y desechando todas las dem√°s:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
</code></pre></div></div>

<p>El resultado de la consulta ser√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia L√≥pez Zapata
Micaela Cruz Ortega
Luis Fernando Guzm√°n Rojas
Juan L√≥pez Guti√©rrez
Esteban L√≥pez L√≥pez
Ana Luc√≠a Smith L√≥pez
Fernando Jos√© Delgado Aguas
</code></pre></div></div>

<p>El s√≠mbolo * (asterisco) significa ‚Äútodas las columnas‚Äù. De modo que esto nos devolver√° todo el contenido de la tabla <em>personas</em> sin excepci√≥n:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
</code></pre></div></div>

<p>El resultado de esta consulta ser√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 Antonia L√≥pez Zapata 171 18/02/2002 Espa√±a
2 Micaela Cruz Ortega 168 23/03/1993 M√©xico
3 Luis Fernando Guzm√°n Rojas 174 01/01/2001 Colombia
4 Juan L√≥pez Guti√©rrez 191 28/02/1997 Argentina
5 Esteban L√≥pez L√≥pez 166 07/09/2001 M√©xico
6 Ana Luc√≠a Smith L√≥pez 185 19/01/2000 Argentina
7 Fernando Jos√© Delgado Aguas 157 17/08/1969 M√©xico
</code></pre></div></div>

<h3 id="232-filtrar-resultados-la-cl√°usula-where">2.3.2. Filtrar resultados: la cl√°usula WHERE</h3>

<p>Normalmente, no vamos a necesitar <em>todos</em> los registros de una tabla, sino que queremos localizar alguno o algunos en concreto. Para eso sirven las b√∫squedas, ¬øno? Para encontrar unos pocos resultados entre un mont√≥n de datos.</p>

<p>Pues bien, para <strong>filtrar esos resultados</strong> se utiliza la <strong>cl√°usula WHERE</strong>.</p>

<p>Es sencilla de comprender. Simplemente, se indica una <strong>condici√≥n</strong> que afecte a alguno de los campos de la tabla, y la base de datos se encargar√° de encontrar para nosotros los registros que cumplan esa condici√≥n.</p>

<p>Por ejemplo, esta consulta nos devuelve los nombres y apellidos de todas las personas cuya estatura es igual a 168 cm (recuerda que <em>estatura</em> es un campo de nuestra tabla <em>personas</em>):</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">=</span> <span class="s1">'168'</span><span class="p">;</span>
</code></pre></div></div>

<p>Como resultado, solo obtendremos un registro, porque solo una persona cumple esa condici√≥n:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
</code></pre></div></div>

<p>La condici√≥n puede utilizar los <strong>operadores de comparaci√≥n</strong> habituales:</p>

<ul>
  <li><strong>Igual que</strong>: =</li>
  <li><strong>Mayor que</strong>: &gt;</li>
  <li><strong>Mayor o igual</strong>: &gt;=</li>
  <li><strong>Menor que</strong>: &lt;</li>
  <li><strong>Menor o igual</strong>: &lt;=</li>
  <li><strong>Distinto de</strong>: !=</li>
</ul>

<p>Adem√°s, tambi√©n existen <strong>operadores l√≥gicos</strong> que ya conoces de otros lenguajes de programaci√≥n: <strong>AND</strong>, <strong>OR</strong> y <strong>NOT</strong>.</p>

<p>Con todo esto, se pueden hacer consultas bastante elaboradas con muy poco esfuerzo. Por ejemplo, vamos a pedirle a la base de datos que busque a todas las personas que miden m√°s de 170 cm:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">&gt;</span> <span class="s1">'170'</span><span class="p">;</span>
</code></pre></div></div>

<p>El resultado ser√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia L√≥pez Zapata
Luis Fernando Guzm√°n Rojas
Juan L√≥pez Guti√©rrez
Ana Luc√≠a Smith L√≥pez
</code></pre></div></div>

<p>Esta otra consulta localiza a todas las personas cuyo primer apellido es ‚ÄúL√≥pez‚Äù y que miden m√°s de 170 cm:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="s1">'L√≥pez'</span>
    <span class="k">AND</span> <span class="n">estatura</span> <span class="o">&gt;</span> <span class="s1">'170'</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia L√≥pez Zapata
Juan L√≥pez Guti√©rrez
</code></pre></div></div>

<p>Y esta otra busca a todas las personas que tienen ‚ÄúL√≥pez‚Äù como primer o segundo apellido y que han nacido antes del a√±o 2002. Observa c√≥mo se pueden usar par√©ntesis para agrupar condiciones:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="p">(</span><span class="n">apellido1</span> <span class="o">=</span> <span class="s1">'L√≥pez'</span> <span class="k">OR</span> <span class="n">apellido2</span> <span class="o">=</span> <span class="s1">'L√≥pez'</span><span class="p">)</span>
    <span class="k">AND</span> <span class="n">fecha_nacimiento</span> <span class="o">&lt;</span> <span class="s1">'01/01/2002'</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Juan L√≥pez Guti√©rrez
Esteban L√≥pez L√≥pez
Ana Luc√≠a Smith L√≥pez
</code></pre></div></div>

<h3 id="233-b√∫squedas-aproximadas-con-caracteres-comod√≠n">2.3.3. B√∫squedas aproximadas con caracteres comod√≠n</h3>

<p>Las comparaciones en la cl√°usula WHERE permiten usar lo que se llaman <strong>caracteres comod√≠n</strong>, que son b√°sicamente dos: % (s√≠mbolo del tanto por ciento) y _ (s√≠mbolo del subrayado).</p>

<ul>
  <li><strong>%</strong> significa ‚Äúcualquier conjunto de caracteres, incluyendo ning√∫n car√°cter‚Äù.</li>
  <li><strong>_</strong> significa ‚Äúun car√°cter cualquiera‚Äù. En algunos gestores de bases de datos, este car√°cter es ‚Äú?‚Äù (interrogaci√≥n)</li>
</ul>

<p>Las comparaciones que usan car√°cteres comod√≠n deben escribirse con el operador de comparaci√≥n <strong>LIKE</strong>, no con los operadores habituales.</p>

<p>Por ejemplo, esta consulta localiza personas cuyo nombre comienza por la letra A, sin importar cu√°ntos caracteres contenga el nombre a continuaci√≥n de esa A:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">nombre</span> <span class="k">LIKE</span> <span class="s1">'A%'</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia L√≥pez Zapata
Ana Luc√≠a Smith L√≥pez
</code></pre></div></div>

<p>Esta otra consulta busca a personas que hayan en el mes de enero de cualquier a√±o:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">fecha_nacimiento</span> <span class="k">LIKE</span> <span class="s1">'__/01/____'</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Luis Fernando Guzm√°n Rojas
Ana Luc√≠a Smith L√≥pez
</code></pre></div></div>

<h3 id="234-ordenar-resultados-con-order-by">2.3.4. Ordenar resultados con ORDER BY</h3>

<p>Los resultados obtenidos en una consulta pueden <strong>ordenarse</strong> por cualquier campo con la <strong>cl√°usula ORDER BY</strong>, independientemente de cuales sean las condiciones de b√∫squeda.</p>

<p>Por ejemplo, para obtener una lista de personas ordenadas por apellido:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
Fernando Jos√© Delgado Aguas
Luis Fernando Guzm√°n Rojas
Antonia L√≥pez Zapata
Juan L√≥pez Guti√©rrez
Esteban L√≥pez L√≥pez
Ana Luc√≠a Smith L√≥pez
</code></pre></div></div>

<p>F√≠jate que Antonia L√≥pez, Juan L√≥pez y Esteban L√≥pez comparten el primer apellido y, por ese motivo, siguen apareciendo desordenados. O, mejor dicho, aparecen en el orden en el que est√°n almacenados en la tabla, que no tiene por qu√© ser alfab√©tico.</p>

<p>Se puede indicar un segundo criterio de ordenaci√≥n (y un tercero, y un cuarto‚Ä¶). Nosotros vamos a usar como segundo criterio el segundo apellido, as√≠:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
Fernando Jos√© Delgado Aguas
Luis Fernando Guzm√°n Rojas
Esteban L√≥pez L√≥pez
Juan L√≥pez Guti√©rrez
Antonia L√≥pez Zapata
Ana Luc√≠a Smith L√≥pez
</code></pre></div></div>

<p>El ordenamiento se hace, por defecto, de manera <strong>ascendente</strong> (num√©rica en caso de campos num√©ricos o alfab√©tica en caso de campos de texto). Se puede forzar un ordenamiento <strong>descendente</strong> con el modificador <strong>DESC</strong>.</p>

<p>Por ejemplo, aqu√≠ obtenemos la lista de las personas apellidadas ‚ÄúL√≥pez‚Äù ordenadas de la m√°s alta a la m√°s bajita:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">estatura</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="nv">"L√≥pez"</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">estatura</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Juan L√≥pez Guti√©rrez 191
Antonia L√≥pez Zapata 171
Esteban L√≥pez L√≥pez 166
</code></pre></div></div>

<h3 id="235-agrupar-resultados-con-distinct">2.3.5. Agrupar resultados con DISTINCT</h3>

<p>Atenci√≥n, pregunta. ¬øQu√© ocurrir√° si ejecutamos esta consulta?</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">apellido1</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">;</span>
</code></pre></div></div>

<p>Si has respondido que obtendremos todos los primeros apellidos de todas las personas de la tabla <em>personas</em>, ordenados alfab√©ticamente, has acertado.</p>

<p><em>Pero hay varias personas que comparten el primer apellido.</em></p>

<p>Por esa raz√≥n, ese apellido aparece (‚ÄúL√≥pez‚Äù) repetido varias veces en el resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cruz
Delgado
Guzm√°n
L√≥pez
L√≥pez
L√≥pez
Smith
</code></pre></div></div>

<p>Esta repetici√≥n de resultados puede ser algo buscado o un efecto secundario indeseable de la b√∫squeda. Para <strong>evitar resultados repetidos</strong> se usa <strong>DISTINCT</strong>. Por ejemplo, el siguiente SELECT nos mostrar√° todos los primeros apellidos de la tabla, pero sin repetir ninguno:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">apellido1</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cruz
Delgado
Guzm√°n
L√≥pez
Smith
</code></pre></div></div>

<h3 id="236-funciones-de-agregado-y-group-by">2.3.6. Funciones de agregado y GROUP BY</h3>

<p>En la lista de campos, se pueden utilizar las llamadas <strong>funciones de agregado</strong>. Se trata de funciones que realizan c√°lculos sobre los resultados de la consulta.</p>

<p>Por ejemplo, esta consulta (que no usa funciones de agregado) nos devuelve los IDs de las personas cuyo pa√≠s de nacimiento es ‚ÄúM√©xico‚Äù:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">id</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">pais_nacimiento</span> <span class="o">=</span> <span class="nv">"M√©xico"</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
Esteban L√≥pez L√≥pez
Fernando Jos√© Delgado Aguas
</code></pre></div></div>

<p>En cambio, esta otra consulta (que usa la funci√≥n de agregado COUNT()) nos devuelve <em>el n√∫mero de personas</em> cuyo pa√≠s de nacimiento es ‚ÄúM√©xico‚Äù:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">pais_nacimiento</span> <span class="o">=</span> <span class="nv">"M√©xico"</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
</code></pre></div></div>

<p>Las <strong>funciones de agregado m√°s importantes</strong> son las siguientes:</p>

<ul>
  <li><strong>COUNT()</strong>: cuenta el n√∫mero de filas que cumplen los criterios de b√∫squeda de la consulta.</li>
  <li><strong>MIN()</strong>: calcula el valor m√≠nimo de un campo num√©rico.</li>
  <li><strong>MAX()</strong>: calcula el valor m√°ximo de un campo num√©rico.</li>
  <li><strong>AVG()</strong>: calcula el valor promedio de un campo num√©rico.</li>
  <li><strong>SUM()</strong>: calcula la suma de todos los valores de un campo num√©rico.</li>
</ul>

<p>Con estas funciones, es muy f√°cil buscar, por ejemplo, la estatura m√°xima de todas las personas cuyo primer apellido es ‚ÄúL√≥pez‚Äù:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">estatura</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="nv">"L√≥pez"</span><span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>191
</code></pre></div></div>

<p>Las funciones de agregado se usan a menudo con la <strong>cl√°sula GROUP BY</strong>, que nos permite <strong>agrupar los resultados por alg√∫n campo</strong>. Observa c√≥mo funciona en este ejemplo:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">pais_nacimiento</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span><span class="p">;</span>
</code></pre></div></div>

<p>Esta consulta nos dir√° cu√°ntas personas han nacido en cada pa√≠s, ofreci√©ndonos un resultado con un aspecto como este:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Argentina 2
Colombia 1
Espa√±a 1
M√©xico 3
</code></pre></div></div>

<p>Lo que ha ocurrido aqu√≠ es que los resultados se han agrupado por paises (<strong>GROUP BY pais_nacimiento</strong>) y, para cada grupo, se ha hecho el c√°lculo de la funci√≥n de agregado (<strong>COUNT(id)</strong>).</p>

<p>La cl√°usula GROUP BY aparece, a veces, acompa√±ada de la <strong>cl√°usula HAVING</strong>, que es <strong>como WHERE pero aplicable a funciones de agregado</strong>.</p>

<p>Por ejemplo, esta consulta nos mostrar√° la cantidad de personas nacidas en cada pa√≠s pero solo de aquellos pa√≠ses de los que se contabilicen al menos 3 personas en la tabla:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">pais_nacimiento</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span>
    <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">;</span>
</code></pre></div></div>

<p>Resultado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M√©xico 3
</code></pre></div></div>

<h3 id="237-obtener-resultados-de-varias-tablas-join">2.3.7. Obtener resultados de varias tablas: JOIN</h3>

<p>Hasta ahora, solo hemos visto ejemplos de consultas que obtienen datos de una sola tabla, pero es muy frecuente que queramos <strong>extraer datos de varias tablas relacionadas entre s√≠</strong>.</p>

<p>SQL permite hacer eso con la cl√°usula <strong>JOIN</strong>.</p>

<p>Para comprender c√≥mo funciona JOIN, necesitamos a√±adir una o dos tablas a nuestra base de datos, as√≠ que los siguientes ejemplos se basar√°n en estas tres tablas:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PERSONAS(id, nombre, apellido1, apellido2, estatura, fecha_nacimiento, id_pais)
PAISES(id, nombre, id_continente)
CONTINENTES(id, nombre)
</code></pre></div></div>

<p>Como puedes imaginarte, el campo <em>id_pais</em> de la tabla <em>PERSONAS</em> es una clave ajena que est√° relacionada con el campo <em>id</em> de la tabla <em>PAISES</em>.</p>

<p>Del mismo modo, <em>id_continente</em> en la tabla <em>PAISES</em> es una clave ajena enlazada con <em>id</em> en la tabla CONTINENTES.</p>

<p>Para que quede m√°s claro, te muestro un ejemplo de lo que podr√≠an contener estas tablas:</p>

<p><strong>TABLA PERSONAS</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>nombre</th>
      <th>apellido1</th>
      <th>apellido2</th>
      <th>estatura</th>
      <th>fecha_nacimiento</th>
      <th>id_pais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Antonia</td>
      <td>L√≥pez</td>
      <td>Zapata</td>
      <td>171</td>
      <td>18/02/2002</td>
      <td>3</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Micaela</td>
      <td>Cruz</td>
      <td>Ortega</td>
      <td>168</td>
      <td>23/03/1993</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Luis Fernando</td>
      <td>Guzm√°n</td>
      <td>Rojas</td>
      <td>174</td>
      <td>01/01/2001</td>
      <td>2</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Juan</td>
      <td>L√≥pez</td>
      <td>Guti√©rrez</td>
      <td>191</td>
      <td>28/02/1997</td>
      <td>7</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Esteban</td>
      <td>L√≥pez</td>
      <td>L√≥pez</td>
      <td>166</td>
      <td>07/09/2001</td>
      <td>1</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Ana Luc√≠a</td>
      <td>Smith</td>
      <td>L√≥pez</td>
      <td>185</td>
      <td>19/01/2000</td>
      <td>7</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Fernando Jos√©</td>
      <td>Delgado</td>
      <td>Aguas</td>
      <td>157</td>
      <td>17/08/1969</td>
      <td>1</td>
    </tr>
    <tr>
      <td>etc</td>
      <td>etc</td>
      <td>etc</td>
      <td>etc</td>
      <td>etc</td>
      <td>etc</td>
      <td>etc</td>
    </tr>
  </tbody>
</table>

<p><strong>TABLA PAISES</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>nombre</th>
      <th>id_continente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>M√©xico</td>
      <td>2</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Colombia</td>
      <td>2</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Espa√±a</td>
      <td>4</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Australia</td>
      <td>5</td>
    </tr>
    <tr>
      <td>5</td>
      <td>China</td>
      <td>3</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Egipto</td>
      <td>1</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Argentina</td>
      <td>2</td>
    </tr>
    <tr>
      <td>etc</td>
      <td>etc</td>
      <td>etc</td>
    </tr>
  </tbody>
</table>

<p><strong>TABLA CONTINENTES</strong></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>nombre</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>√Åfrica</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Am√©rica</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Asia</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Europa</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Ocean√≠a</td>
    </tr>
  </tbody>
</table>

<p>Ahora el nombre del pa√≠s no est√° almacenado directamente en la tabla <em>personas</em>, sino en la tabla <em>paises</em>. Ambas tablas se relacionan gracias al campo <em>id_pais</em>. Lo mismo ocurre entre <em>paises</em> y <em>continentes</em>.</p>

<p>Por lo tanto, si necesitamos recuperar, por ejemplo, <strong>los nombres y apellidos de todas las personas junto con su pa√≠s de nacimiento</strong>, ser√° necesario mezclar los datos de las tablas <em>personas</em> y <em>paises</em>. Esto se hace as√≠:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
</code></pre></div></div>

<p>El resultado ser√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia L√≥pez Zapata Espa√±a
Micaela Cruz Ortega M√©xico
Luis Fernando Guzm√°n Rojas Colombia
Juan L√≥pez Guti√©rrez Argentina
Esteban L√≥pez L√≥pez M√©xico
Ana Luc√≠a Smith L√≥pez Argentina
Fernando Jos√© Delgado Aguas M√©xico
</code></pre></div></div>

<p>Observa algunas cosas importantes en esta sentencia:</p>

<ul>
  <li>En la <strong>cl√°sula FROM</strong> indicamos la tabla principal de nuestra consulta (<em>personas</em>).</li>
  <li>En la <strong>cl√°sula JOIN</strong> indicamos la segunda tabla de nuestra consulta (<em>paises</em>) y le indicamos a SQL cu√°l es el campo que relaciona <em>personas</em> con <em>paises</em> (<code class="language-plaintext highlighter-rouge">personas.id_pais = paises.id</code>).</li>
  <li>En la lista de campos, tenemos dos campos llamados <em>nombre</em>, uno perteneciente a la tabla <em>personas</em> (el nombre de la persona) y otro perteneciente a la tabla <em>paises</em> (el nombre del pa√≠s). Por eso es necesario distinguirlos poniendo delante el identificador de la tabla (<em>personas.nombre</em> y <em>paises.nombre</em>). Con <em>apellido1</em> y <em>apellido2</em> no hace falta, puesto que esos campos solo existen en la tabla <em>personas</em>.</li>
</ul>

<p>Y poco m√°s hay que decir sobre los JOIN. Son as√≠ de sencillos. SQL se encargar√° de mostrar a cada persona con su pa√≠s correspondiente, cruzando los datos de las dos tablas.</p>

<p>Se puede hacer <strong>JOIN de m√°s de dos tablas</strong>. En esos casos, basta con cruzar las tablas por parejas. Por ejemplo, para mostrar la lista de personas junto con su pa√≠s y su continente de nacimiento, primero cruzaremos <em>personas</em> con <em>paises</em> y despu√©s <em>paises</em> con <em>continentes</em>. No se puede cruzar directamente <em>personas</em> con <em>continentes</em> porque no tienen ning√∫n campo en com√∫n, es decir, no est√°n directamente relacionadas entre s√≠.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">continentes</span><span class="p">.</span><span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
  <span class="k">JOIN</span> <span class="n">continentes</span> <span class="k">ON</span> <span class="n">paises</span><span class="p">.</span><span class="n">id_continente</span> <span class="o">=</span> <span class="n">continentes</span><span class="p">.</span><span class="n">id</span>
</code></pre></div></div>

<p>El resultado de esta consulta ser√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia L√≥pez Zapata Espa√±a Europa
Micaela Cruz Ortega M√©xico Am√©rica
Luis Fernando Guzm√°n Rojas Colombia Am√©rica
Juan L√≥pez Guti√©rrez Argentina Am√©rica
Esteban L√≥pez L√≥pez M√©xico Am√©rica
Ana Luc√≠a Smith L√≥pez Argentina Am√©rica
Fernando Jos√© Delgado Aguas M√©xico Am√©rica
</code></pre></div></div>

<p>Por √∫ltimo, <strong>las consultas con JOIN tambi√©n pueden llevar cl√°usulas WHERE, ORDER BY, GROUP BY o HAVING</strong>, como cualquier otra consulta. Por ejemplo, vamos a buscar los nombres, apellidos, pa√≠s de nacimiento y continente de todas las personas nacidas a partir de 1 de enero del a√±o 2000 y vamos a ordenar los resultados por apellidos:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">continentes</span><span class="p">.</span><span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
  <span class="k">JOIN</span> <span class="n">continentes</span> <span class="k">ON</span> <span class="n">paises</span><span class="p">.</span><span class="n">id_continente</span> <span class="o">=</span> <span class="n">continentes</span><span class="p">.</span><span class="n">id</span>
  <span class="k">WHERE</span> <span class="n">fecha_nacimiento</span> <span class="o">&gt;=</span> <span class="s1">'01/01/2000'</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">;</span>
</code></pre></div></div>

<p>El resultado ser√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Luis Fernando Guzm√°n Rojas Colombia Am√©rica
Esteban L√≥pez L√≥pez M√©xico Am√©rica
Antonia L√≥pez Zapata Espa√±a Europa
Ana Luc√≠a Smith L√≥pez Argentina Am√©rica
</code></pre></div></div>

<h3 id="238-sql-avanzado-introducci√≥n-a-las-subconsultas">2.3.8. SQL avanzado: introducci√≥n a las subconsultas</h3>

<p>Hay ciertas situaciones en las que nos encontramos con una consulta tan compleja que no se puede resolver con las herramientas que hemos visto hasta ahora.</p>

<p>En esos casos, <strong>utilizar una subconsulta en una cl√°usula WHERE o HAVING</strong> suele obrar milagros. Sin embargo, no conviene abusar de este recurso: las consultas con subconsultas siempre consumen m√°s recursos y son m√°s lentas de ejecutar que las consultas convencionales.</p>

<p>La subconsulta se inserta en cualquier cl√°usula WHERE o HAVING con alguno de estos operadores:</p>

<ul>
  <li><strong>ANY</strong>, <strong>ALL</strong> o <strong>SOME</strong>.</li>
  <li><strong>IN</strong> o <strong>NOT IN</strong>.</li>
  <li><strong>EXISTS</strong> o <strong>NOT EXISTS</strong>.</li>
  <li><strong>=, &gt;, &gt;=, &lt;, &lt;=</strong>.</li>
</ul>

<p>El significado de los operadores es bastante obvio. Como siempre, se comprende mejor con algunos ejemplos.</p>

<p><strong>Ejemplo 1: buscar a todas las personas que hayan nacido en alg√∫n pa√≠s del continente americano:</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id_pais</span> <span class="k">FROM</span> <span class="n">paises</span>
                              <span class="k">WHERE</span> <span class="n">id_continente</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></div></div>

<p>Observa bien el c√≥digo de esta consulta: le estamos pidiendo a la base de datos que, en primer lugar, ejecute la consulta que hay entre par√©ntesis (es decir, la <em>subconsulta</em>). Esta consulta nos devolver√° una lista de IDs de paises del contienente americano. Y luego, gracias a la cl√°sula WHERE de la consulta principal, seleccionaremos solo a las personas que hayan nacido en alguno de esos pa√≠ses.</p>

<p>(Esta consulta, por cierto, puede resolverse sin subconsultas de forma m√°s eficiente. Puedes pensar en ello si lo deseas: es un interesante ejercicio).</p>

<p><strong>Ejemplo 2: buscar todos los pa√≠ses de los cuales hay al menos una persona en la base de datos:</strong></p>

<p>Tambi√©n puede hacerse sin subconsultas, pero la soluci√≥n con subconsulta es as√≠ de simple:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">paises</span>
  <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="k">ANY</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id_pais</span> <span class="k">FROM</span> <span class="n">personas</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Ejemplo 3: buscar a las personas m√°s altas de la base de datos</strong>:</p>

<p>Es decir, buscar a las personas que compartan el valor m√°ximo de estatura, sea este el que sea. Este es un ejemplo de consulta que dif√≠cilmente podr√≠as resolver sin subconsultas, pero que con subconsultas queda en algo tan simple como:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">estatura</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">personas</span><span class="p">);</span>
</code></pre></div></div>

<p>Las subconsultas se pueden considerar SQL avanzado, por lo que no es necesario que las domines en este momento, pero s√≠ que conozcas su existencia por si m√°s adelante en tu carrera como programador/a tienes que profundizar en ellas.</p>

<h3 id="239-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas">2.3.9. Otras cuestiones avanzadas: alias y combinaciones de consultas</h3>

<p>Como dijimos al principio, SQL en general y la instrucci√≥n SELECT en particular son muy amplios y se pueden aplicar en much√≠simos casos diferentes, desde consultas sencill√≠simas hasta casos complejos donde tu cerebro puede tener un amago de explosi√≥n mientras trata de buscar una soluci√≥n.</p>

<p>Te menciono aqu√≠ <strong>algunos aspectos avanzados de los SELECT</strong> para que los conozcas, haci√©ndote saber que, si no aprendes a controlarlos ahora, no es ninguna tragedia: m√°s adelante, si te especializas en esto, sin duda aprender√°s a dominarlos.</p>

<p>Por ahora basta con que los conozcas y los comprendas. En algunos de los ejercicios del tema usaremos estos aspectos avanzados para buscar soluciones a supuestos pr√°cticos particularmente enrevesados.</p>

<p><strong>ALIAS</strong></p>

<p>Los alias son <strong>nombres alternativos que se asignan a las tablas o a las columnas</strong> en una consulta.</p>

<p>El objetivo del alias puede ser doble:</p>

<ul>
  <li>Usar un nombre m√°s corto para facilitar la escritura de una expresi√≥n que, de otro modo, ser√≠a muy larga.</li>
  <li>Poder referirse a la misma tabla en dos conextos diferentes.</li>
</ul>

<p>El primer uso es muy f√°cil de entender. El segundo, no tanto. De momento, vamos a ver el uso m√°s f√°cil. No te preocupes demasiado por el otro: veremos alg√∫n ejemplo en los ejercicios de este cap√≠tulo.</p>

<p>El <strong>alias se indica con la palabra AS</strong>.</p>

<p>Por ejemplo, en la siguiente consulta, se usan alias para acortar los identificadores de los campos <em>persona.nombre</em>, <em>paises.nombre</em> y <em>continentes.nombre</em>, que pasan a ser <em>nom_pers</em>, <em>nom_pais</em> y <em>nom_cont</em>, respectivamente. Observa como podemos referirnos a cualquiera de esos campos por su nombre o su alias, como hacemos en la cl√°usula WHERE de este ejemplo.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span> <span class="k">AS</span> <span class="n">nom_pers</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span> <span class="k">AS</span> <span class="n">nom_pais</span><span class="p">,</span> <span class="n">continentes</span><span class="p">.</span><span class="n">nombre</span> <span class="k">AS</span> <span class="n">nom_cont</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
  <span class="k">JOIN</span> <span class="n">continentes</span> <span class="k">ON</span> <span class="n">paises</span><span class="p">.</span><span class="n">id_continente</span> <span class="o">=</span> <span class="n">continentes</span><span class="p">.</span><span class="n">id</span>
  <span class="k">WHERE</span> <span class="n">nom_pers</span> <span class="k">LIKE</span> <span class="s1">'A%'</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>COMBINACIONES DE CONSULTAS</strong></p>

<p>Es posible <strong>combinar los resultados de dos consultas</strong> para obtener un resultado m√°s amplio.</p>

<p>Si tenemos dos consultas, que llamaremos C1 y C2, sus resultados pueden combinarse de tres modos diferentes:</p>

<ul>
  <li>Con <strong>UNION</strong>: los registros de C1 y de C2 se sumar√°n, es decir, el resultado de <strong>C1 UNION C2</strong> ser√°n todas las filas que est√©n en C1 m√°s las que est√©n en C2.</li>
  <li>Con <strong>INSERSECT</strong>: el resultado de <strong>C1 INSERSECT C2</strong> ser√°n todas las filas que est√°n a la vez en C1 y en C2, es decir, la insersecci√≥n de los dos conjuntos de resultados.</li>
  <li>Con <strong>EXCEPT</strong>: el resultado de <strong>C1 EXCEPT C2</strong> ser√°n todas las filas que est√©n en C1, quitando las que est√©n en C2.</li>
</ul>

<p>Para poder hacer UNION, INSERSECT o EXCEPT de dos consultas, ambas tienen que haber producido exactamente el mismo conjunto de campos. Si no, estas operaciones no son posibles.</p>

<p>Por ejemplo, observa el siguiente c√≥digo. F√≠jate en que las dos consultas producen el mismo conjunto de campos (<em>nombre, apellido1, apellido2</em>). Si no, no ser√≠a posible combinarlas. Observa tambi√©n el uso de los par√©ntesis:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">pais_nacimiento</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">)</span>
<span class="k">UNION</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
   <span class="k">FROM</span> <span class="n">personas</span><span class="p">)</span>
   <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">&gt;</span> <span class="s1">'180'</span><span class="p">);</span>
</code></pre></div></div>

<p>(por supuesto, esto mismo puede resolverse sin usar UNION)</p>

<ul>
  <li>
    <p>La combinaci√≥n de estas dos consultas con <strong>UNION</strong> nos devuelve la lista de personas que han nacido en Argentina <strong>O</strong> que miden m√°s de 180 cm. Cualquier persona que cumpla una de las dos condiciones estar√° en el resultado final.</p>
  </li>
  <li>
    <p>Si combin√°semos las mismas consultas con <strong>INSERSECT</strong> en lugar de con UNION, lo que obtendr√≠amos ser√≠a la lista de personas que nacieron en Argentina <strong>Y</strong> que miden m√°s de 180 cm. Es decir, las personas que formen parte de los dos resultados y, por lo tanto, cumplan <em>a la vez</em> las dos condiciones.</p>

    <p>F√≠jate en que en el enunciado solo hemos cambiado una ‚ÄúO‚Äù por una ‚ÄúY‚Äù, pero es que esa es precisamente la diferencia entre UNION e INTERSECT.</p>
  </li>
  <li>
    <p>Por √∫ltimo, si combinamos las mismas consultas con <strong>EXCEPT</strong>, obtendremos la lista de personas que nacieron en Argentina, excepto las que miden m√°s de 180 cm. Habremos eliminado del primer SELECT los resultados que est√©n en el segundo SELECT. Esto es, obtendremos la lista de personas nacidas en argentina que miden 180 cm o menos.</p>
  </li>
</ul>

<p>Es un l√≠o desde el punto de vista l√≥gico, ¬øverdad? Y es que no se te habr√°n escapado las semejanzas de UNION, INTERSECT y EXCEPT con los operadores l√≥gicos Y, O y NO. En efecto, UNION, INSERSECT y EXCEPT son los equivalentes a Y, O y NO a nivel de consultas completas.</p>

<p>Aplicaremos UNION, INSERSECT y EXCEPT a algunas de las consultas m√°s complejas de nuestros ejercicios propuestos.</p>

<h2 id="24-y-c√≥mo-puedo-probar-todo-esto">2.4. ¬øY c√≥mo puedo probar todo esto?</h2>

<p>Seguro que te has hecho esta pregunta mientras le√≠as los ejemplos de este cap√≠tulo y tal vez incluso intentabas resolverlos por tu cuenta.</p>

<p>Es una excelente pregunta.</p>

<p>Para ejecutar SQL <strong>necesitas un gestor de bases de datos relacionales</strong>. Puede instalar un gestor de escritorio, para bases de datos dom√©sticas, como <em>Microsoft Access</em> o <em>Libreoffice Base</em>, o puedes decantarte por un gestor profesional en red, como <em>MySQL, MariaDB, Oracle, SQLite</em> o <em>SQL Server</em>.</p>

<p>En realidad, da igual, porque el SQL es m√°s o menos igual en todos.</p>

<p>(Digo ‚Äúm√°s o menos‚Äù porque cada base de datos hace su propia interpretaci√≥n del est√°ndar SQL y puede haber peque√±as diferencias entre uno y otro).</p>

<p>Si nunca has usado una base de datos profesional como MySQL, Oracle u SQL Server, probablemente <strong>lo m√°s sencillo es que empieces por Microsoft Access o Libreoffice Base</strong>. Si, en cambio, ya conoces las bases de datos profesionales, no necesitas leer este apartado. Puedes pasar directamente a los ejercicios, aunque probablemente tampoco los necesites.</p>

<p>Ten en cuenta que tanto Microsoft Access como Libreoffice Base usan versiones de SQL bastante alejadas del est√°ndar (m√°s a√∫n en el caso de Base). Son la manera m√°s sencilla de ejecutar SQL, pero probablemente no la mejor. Si a√∫n as√≠ es lo √∫nico que tienes a mano, te cuento brevemente c√≥mo ponerlas en marcha:</p>

<ol>
  <li>
    <p><strong>Instala Microsoft Access (forma parte del paquete Microsoft Office) o Libreoffice Base (forma parte del paquete Libreoffice)</strong> en tu ordenador. Microsoft ofrece una versi√≥n online de su Office. Recuerda que Microsoft Office es un paquete de software propietario y que copiar y usar programas de forma fraudulenta es un delito penal. Libreoffice, en cambio, es software libre y puedes usarlo y distribuirlo libremente. Eso s√≠: ¬°desc√°rgalo solo de la web oficial, por favor!</p>
  </li>
  <li>
    <p><strong>Arranca el programa</strong> (claro).</p>
  </li>
  <li>
    <p><strong>En Microsoft Access</strong>, crea una base de datos (o abre una existente). Ahora puedes ejecutar tus sentencias SQL pulsando el bot√≥n ‚ÄúCreate‚Äù de la parte superior de la pantalla, y luego seleccionando ‚ÄúQuery design‚Äù -&gt; ‚ÄúShow table‚Äù -&gt; ‚ÄúSQL view‚Äù. Escribe tu sentencia SQL y pulsa ‚ÄúRun‚Äù para probarla.</p>
  </li>
  <li>
    <p><strong>En Libreoffice Base</strong>, crea una base de datos (o abre una existente). Selecciona ‚ÄúTool - SQL‚Äù y luego ‚ÄúCreate Query in SQL view‚Äù. En la pantalla siguiente, haz clic en ‚ÄúView‚Äù -&gt; ‚ÄúSwitch Design View On/Off‚Äù. Escribe tu sentencia SQL y pulsa ‚ÄúRun‚Äù para probarla.</p>
  </li>
</ol>

<p>Existe otra posibilidad para ejecutar SQL sin complicarte la vida: las <strong>soluciones online</strong>. Hay p√°ginas son <a href="https://sqliteonline.com">sqliteonline.com</a> o <a href="https://sqlfiddle.com">sqlfiddle.com</a> que te permiten lanzar sentencias SQL contra bases de datos virtuales de forma gratuita y sin necesidad de registrarte en ning√∫n sitio.</p>

<p>En realidad, todo esto no tiene nada que ver con aprender SQL, sino con aprender a manejar un determinado programa. Elige el tuyo y bichea un poco hasta que averig√ºes c√≥mo se ejecuta el SQL. Se presupone de ti que eres un usuario/a de ordenadores de nivel medio-avanzado, y por eso quieres aprender a programar. No tiene mucho sentido explicar aqu√≠ c√≥mo ejecutar SQL en cada gestor de bases de datos porque puede haber importantes diferencias entre un gestor de bases de datos y otro o, incluso, entre versiones del mismo programa. Y, en √∫ltima instancia, es algo tan simple como trastear un rato con el programa.</p>

<h2 id="25-ejercicios">2.5. Ejercicios</h2>

<p>Como de costumbre, vamos a proponer una bater√≠a de ejercicios de SQL para que practiques todo lo que hemos visto a lo largo de este cap√≠tulo.</p>

<p>Muchos de ellos los encontrar√°s resueltos en la siguiente secci√≥n. Ya sabes lo que digo siempre: es una p√©sima idea mirar las soluciones antes de haber intentado resolverlos por tu cuenta.</p>

<h4 id="ejercicio-1-compa√±√≠a-de-seguros">Ejercicio 1: compa√±√≠a de seguros</h4>

<p>Una compa√±√≠a de seguros dispone de una base de datos con las siguientes tablas:</p>

<ul>
  <li>Personas (dni#, nombre, apellidos, direcci√≥n, ciudad, pa√≠s)</li>
  <li>Coches (matr√≠cula#, marca, modelo, potencia, conductor, seguro)</li>
  <li>Seguros (n√∫m-p√≥liza#, compa√±√≠a, tipo, franquicia, dni-tomador, fecha)</li>
</ul>

<p>Las claves ajenas, es decir, las claves de unas tablas que se han copiado en otras para implementar las relaciones, son estas:</p>

<ul>
  <li>Coches.conductor ‚Üí Personas.dni (es decir, el campo <em>coches.conductor</em> es una clave ajena de <em>personas.dni</em>)</li>
  <li>Coches.seguro ‚Üí Seguros.n√∫m-p√≥liza (el campo <em>coches.seguro</em> es una clave ajena de <em>seguros.num-numpoliza</em>)</li>
  <li>Seguros.dni-tomador ‚Üí Personas.dni (el campo <em>seguros.dni-tomador</em> es una clave ajena de <em>personas.dni</em>)</li>
</ul>

<p>Se pide escribir el c√≥digo SQL necesario para:</p>

<p><strong>a) Crear las tablas</strong> (CREATE TABLE), suponiendo las siguientes restricciones:</p>

<ul>
  <li>Todas las claves primarias y ajenas son campos obligatorios (no pueden ser nulos). Adem√°s, las claves primarias no pueden tomar valores repetidos.</li>
  <li><em>Personas.pa√≠s</em> tendr√°, por defecto, el valor ‚ÄúEspa√±a‚Äù. Personas.ciudad tendr√°, por defecto, el valor ‚ÄúAlmer√≠a‚Äù.</li>
  <li>Hay que activar el borrado y actualizaci√≥n en cascada en todas las relaciones.</li>
  <li>Es conveniente definir todas las claves como restricciones (<em>constraints</em>), con el objeto de poder modificarlas m√°s adelante.</li>
  <li>Todos los datos son cadenas de caracteres (la longitud puedes elegirla t√∫, siempre que sea razonable), excepto los siguientes:
    <ul>
      <li><em>Coches.potencia</em> es un n√∫mero real con tres cifras enteras y dos cifras decimales.</li>
      <li><em>Seguros.n√∫m-p√≥liza</em> es un n√∫mero entero largo.</li>
      <li><em>Seguros.franquicia</em> es un n√∫mero real con seis cifras enteras y dos decimales.</li>
      <li><em>Seguros.fecha</em> es de tipo fecha (claro)</li>
    </ul>
  </li>
</ul>

<p><strong>b) Realizar los siguientes cambios en las tablas</strong> (ALTER TABLE, INSERT, UPDATE, DELETE):</p>

<ol>
  <li>Agregar a la tabla Personas el campo <em>sexo</em>, con un s√≥lo car√°cter y obligatorio.</li>
  <li>Desactivar el borrado en cascada (no la actualizaci√≥n) de la clave ajena en la tabla Seguros.</li>
  <li>Insertar estos registros:
    <ul>
      <li>En <em>Personas</em>, DNI = 1111A, Juan Mart√≠n, C/ Barco, Roquetas de Mar, Espa√±a</li>
      <li>En <em>Seguros</em>, N¬∫ P√≥liza = 1, Compa√±√≠a = Mapfre, Franquicia = 299,95 ‚Ç¨, Tomador = Juan Mart√≠n</li>
    </ul>
  </li>
  <li>Modificar todos los seguros de tipo ‚ÄúTodo riesgo‚Äù para que la franquicia sea de 120 ‚Ç¨</li>
  <li>Borrar todas las personas que no vivan ni en Espa√±a ni en Portugal.</li>
</ol>

<p><strong>c) Realizar las siguientes consultas</strong> (SELECT):</p>

<ol>
  <li>Nombre y apellidos, ordenados alfab√©ticamente, de todas las personas cuyo nombre sea ‚ÄúLaura‚Äù</li>
  <li>Nombre y apellidos, ordenados alfab√©ticamente, de todas las personas que viven en ciudades que empiezan por ‚ÄúA‚Äù.</li>
  <li>Compa√±√≠as de seguros que aseguran coches de la marca Seat y cuyas p√≥lizas fueron contratadas despu√©s del a√±o 2005.</li>
  <li>Precio medio de las franquicias de los coches asegurados por la compa√±√≠a Mapfre y cuya potencia es mayor de 100 caballos.</li>
</ol>

<h4 id="ejercicio-1-resuelto">EJERCICIO 1 RESUELTO:</h4>

<p><strong>a) Crear las tablas con las restricciones detalladas en el enunciado del ejercicio:</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Personas</span> <span class="p">(</span>
	<span class="n">dni</span>       <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">nombre</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">apellidos</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">ciudad</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="nv">"Almer√≠a"</span><span class="p">,</span>
	<span class="n">pa</span><span class="err">√≠</span><span class="n">s</span>      <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="nv">"Espa√±a"</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_personas</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Seguros</span> <span class="p">(</span>
	<span class="n">num_p</span><span class="err">√≥</span><span class="n">liza</span>  <span class="nb">BIGINT</span> <span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">compa</span><span class="err">√±√≠</span><span class="n">a</span>    <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">tipo</span>        <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
	<span class="n">franquicia</span>  <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">dni_tomador</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">fecha</span>       <span class="nb">DATE</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_seguros</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">num_p</span><span class="err">√≥</span><span class="n">liza</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_seguros_personas</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni_tomador</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Personas</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Coches</span> <span class="p">(</span>
	<span class="n">matr</span><span class="err">√≠</span><span class="n">cula</span>  <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>	<span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">marca</span>      <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">modelo</span>     <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
	<span class="n">potencia</span>   <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
	<span class="n">conductor</span>  <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">seguro</span>     <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_coches</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">matricula</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_coches_personas</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">conductor</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Personas</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_coches_seguros</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">seguro</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Seguros</span><span class="p">(</span><span class="n">num_p</span><span class="err">√≥</span><span class="n">liza</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</code></pre></div></div>

<p><strong>b) Realizar los siguientes cambios en las tablas</strong></p>

<p><strong>Agregar a la tabla Personas el campo sexo, con un s√≥lo car√°cter y obligatorio.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Personas</span>
	<span class="k">ADD</span> <span class="n">Sexo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Desactivar el borrado en cascada (no la actualizaci√≥n) de la clave ajena en la tabla Seguros.</strong></p>

<p>(No puede eliminarse solamente el borrado en cascada, as√≠ que hay que quitar por completo la restricci√≥n ‚Äúfk_seguros_personas‚Äù, y luego volver a crearla sin borrado en cascada. Observa que esto no afectar√° a los datos de la tabla.)</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Seguros</span>
	<span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">fk_seguros_personas</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Seguros</span>
	<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">fk_seguros_personas</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni_tomador</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Personas</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Insertar estos registros:</strong></p>
<ul>
  <li>En Personas, DNI = 1111A, Juan Mart√≠n, C/ Barco, Roquetas de Mar, Espa√±a</li>
  <li>En Seguros, N¬∫ P√≥liza = 1, Compa√±√≠a = Mapfre, Franquicia = 299,95 ‚Ç¨, Tomador = Juan Mart√≠n</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Personas</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'1111A'</span><span class="p">,</span> <span class="s1">'Juan'</span><span class="p">,</span> <span class="s1">'Mart√≠n'</span><span class="p">,</span> <span class="s1">'C/ Barco'</span><span class="p">,</span> <span class="s1">'Roquetas de Mar'</span><span class="p">,</span> <span class="s1">'Espa√±a'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Seguros</span> <span class="p">(</span><span class="n">num_p</span><span class="err">√≥</span><span class="n">liza</span><span class="p">,</span> <span class="n">compa</span><span class="err">√±√≠</span><span class="n">a</span><span class="p">,</span> <span class="n">franquicia</span><span class="p">,</span> <span class="n">dni_tomador</span><span class="p">)</span>
	<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Mapfre'</span><span class="p">,</span> <span class="mi">299</span><span class="p">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">'1111A'</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Modificar todos los seguros de tipo ‚ÄúTodo riesgo‚Äù para que la franquicia sea de 120 ‚Ç¨</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">Pacientes</span>
	<span class="k">SET</span> <span class="n">pais</span> <span class="o">=</span> <span class="s1">'Desconocido'</span>
	<span class="k">WHERE</span> <span class="n">tipo</span> <span class="o">=</span> <span class="s1">'Todo riesgo'</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Borrar todas las personas que no vivan ni en Espa√±a ni en Portugal.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Personas</span>
	<span class="k">WHERE</span> <span class="n">pa</span><span class="err">√≠</span><span class="n">s</span> <span class="o">&lt;&gt;</span> <span class="s1">'Espa√±a'</span> <span class="k">AND</span> <span class="n">pa</span><span class="err">√≠</span><span class="n">s</span> <span class="o">&lt;&gt;</span> <span class="s1">'Portugal'</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>c) Realizar las siguientes consultas</strong> (SELECT):</p>

<p><strong>Nombre y apellidos, ordenados alfab√©ticamente, de todas las personas cuyo nombre sea ‚ÄúLaura‚Äù</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Personas</span>
	<span class="k">WHERE</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Laura'</span>
	<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">nombre</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Nombre y apellidos, ordenados alfab√©ticamente, de todas las personas que viven en ciudades que empiezan por ‚ÄúA‚Äù (consideraremos tambi√©n la ‚ÄúA‚Äù con tilde):</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Personas</span>
	<span class="k">WHERE</span> <span class="n">ciudad</span> <span class="k">LIKE</span> <span class="s1">'A*'</span>  <span class="k">OR</span>  <span class="n">ciudad</span> <span class="k">LIKE</span> <span class="s1">'√Å*'</span>
	<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">nombre</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Compa√±√≠as de seguros que aseguran coches de la marca Seat y cuyas p√≥lizas fueron contratadas despu√©s del a√±o 2005.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">compa</span><span class="err">√±√≠</span><span class="n">a</span>
	<span class="k">FROM</span> <span class="n">Seguros</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Coches</span> <span class="k">ON</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">num_p</span><span class="err">√≥</span><span class="n">liza</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">seguro</span>
	    <span class="k">WHERE</span> <span class="n">marca</span> <span class="o">=</span> <span class="s1">'Seat'</span>
	    <span class="k">AND</span> <span class="n">fecha</span> <span class="o">&gt;</span> <span class="s1">'31/12/2005'</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>Precio medio de las franquicias de los coches asegurados por la compa√±√≠a Mapfre y cuya potencia es mayor de 100 caballos.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">franquicia</span><span class="p">)</span>
	<span class="k">FROM</span> <span class="n">Seguros</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Coches</span> <span class="k">ON</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">num_p</span><span class="err">√≥</span><span class="n">liza</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">seguro</span>
	    <span class="k">WHERE</span> <span class="n">compa</span><span class="err">√±√≠</span><span class="n">a</span> <span class="o">=</span> <span class="s1">'Mapfre'</span>
	    <span class="k">AND</span> <span class="n">potencia</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ejercicio-2-academia-de-idiomas">Ejercicio 2: academia de idiomas</h4>

<p>(Advertencia: las consultas de este ejercicio son m√°s complicadas. Solo las ponemos aqu√≠ a modo de ejemplo, pero no os vamos a pedir que sep√°is hacerlas).</p>

<p>La base de datos de una academia de idiomas est√° formada por las siguientes tablas:</p>

<ul>
  <li>PROFESORES(#dni-prof, nombre, apellidos, idioma)</li>
  <li>ALUMNOS(#dni-alum, nombre, apellidos)</li>
  <li>GRUPOS(#cod-grupo, denominaci√≥n)</li>
  <li>HORARIOS(#cod-grupo, #d√≠a-semana, #dni-prof, hora-inicio, hora-fin, aula)</li>
</ul>

<p>Se pide escribir las sentencias SQL necesarias para:</p>

<p>1) Consultar los nombres y apellidos de los profesores que dan clase de franc√©s de lunes a jueves a partir de las 16:00 horas, junto con la denominaci√≥n de los grupos a los que dan clase y el horario de cada d√≠a.
2) Consultar los nombres y apellidos de los alumnos que reciben clases de al menos dos idiomas diferentes.
3) Consultar los nombres y apellidos de los alumnos que reciben clases de INGL√âS y de FRANC√âS.
4) Consultar los nombres y apellidos de los alumnos que reciben clases de INGL√âS o de FRANC√âS.
5) Consultar los nombres y apellidos de los alumnos que reciben clases de INGL√âS pero no reciben clases de ALEM√ÅN.</p>

<h4 id="soluci√≥n-del-ejercicio-2">Soluci√≥n del ejercicio 2:</h4>

<p><strong>1) Consultar los nombres y apellidos de los profesores que dan clase de franc√©s de lunes a jueves a partir de las 16:00 horas, junto con la denominaci√≥n de los grupos a los que dan clase y el horario de cada d√≠a.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">denominaci</span><span class="err">√≥</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="err">√≠</span><span class="n">a_semana</span><span class="p">,</span> <span class="n">hora_inicio</span><span class="p">,</span> <span class="n">hora_fin</span> 
	<span class="k">FROM</span> <span class="n">Profesores</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Grupos</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Grupos</span><span class="p">.</span><span class="n">cod_grupo</span>
	  <span class="k">WHERE</span> <span class="p">(</span><span class="n">d</span><span class="err">√≠</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'L'</span> <span class="k">OR</span> <span class="n">d</span><span class="err">√≠</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'M'</span> <span class="k">OR</span> <span class="n">d</span><span class="err">√≠</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'X'</span> <span class="k">OR</span> <span class="n">d</span><span class="err">√≠</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'J'</span><span class="p">)</span>
	    <span class="k">AND</span> <span class="n">hora_inicio</span> <span class="o">&gt;=</span> <span class="s1">'16:00'</span>
	    <span class="k">AND</span> <span class="n">idioma</span> <span class="o">=</span> <span class="s1">'Franc√©s'</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>2) Consultar los nombres y apellidos de los alumnos que reciben clases de al menos dos idiomas diferentes.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">AS</span> <span class="n">Profes1</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profes1</span><span class="p">.</span><span class="n">dni_prof</span>
    <span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">dni</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">dni</span> 
				<span class="k">FROM</span> <span class="n">Alumnos</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
        <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">AS</span> <span class="n">Profes2</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profes2</span><span class="p">.</span><span class="n">dni_prof</span>
				  <span class="k">WHERE</span> <span class="n">Profes1</span><span class="p">.</span><span class="n">idioma</span> <span class="o">&lt;&gt;</span> <span class="n">Profes2</span><span class="p">.</span><span class="n">idioma</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>3) Consultar los nombres y apellidos de los alumnos que reciben clases de INGL√âS y de FRANC√âS.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	<span class="k">WHERE</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Ingl√©s"</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	  <span class="k">WHERE</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Franc√©s"</span>
</code></pre></div></div>

<p><strong>4) Consultar los nombres y apellidos de los alumnos que reciben clases de INGL√âS o de FRANC√âS.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	  <span class="k">WHERE</span> <span class="p">(</span><span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Ingl√©s"</span> <span class="k">OR</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Franc√©s"</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>5) Consultar los nombres y apellidos de los alumnos que reciben clases de INGL√âS pero no reciben clases de ALEM√ÅN.</strong></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	  <span class="k">WHERE</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Ingl√©s"</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Horarios</span> <span class="k">ON</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
  <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">Profesores</span> <span class="k">ON</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	  <span class="k">WHERE</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Alem√°n"</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ejercicio-obligatorio-series-de-tv">Ejercicio obligatorio: Series de TV</h4>

<p>La base de datos para nuestras series de TV favoritas incluye estas tablas:</p>

<ul>
  <li>SERIES (id#, titulo, canal, puntuacion)</li>
  <li>TEMPORADAS (id#, anyo, num_capitulos, id_serie)</li>
  <li>PERSONAS (id#, nombre, apellido)</li>
  <li>DIRIGEN (id_persona#, id_serie#)</li>
  <li>ACTUAN (id_persona#, id_serie#)</li>
</ul>

<ol>
  <li>Crea las tablas con las instrucciones CREATE TABLE necesarias, asignando los tipos de datos que te parezcan m√°s adecuados.</li>
  <li>Inserta unos cuantos datos de ejemplo en cada una de las tablas con INSERT INTO.</li>
  <li>Escribe las siguientes consultas:
    <ul>
      <li>Obtener los t√≠tulos y canales de todas las series, ordenadas por puntuaci√≥n (de mayor a menor) y, en caso de empate, por orden alfab√©tico.</li>
      <li>Obtener los t√≠tulos de todas las series donde act√∫e‚Ä¶ (pon aqu√≠ el nombre de tu actor o actriz favorito).</li>
      <li>Obtener todos los datos disponibles (reparto, directores, temporadas, etc.) de la serie‚Ä¶ (pon aqu√≠ el t√≠tulo de tu serie preferida).</li>
      <li>Obtener el n√∫mero de personas que hay en el reparto de tu serie preferida. Es decir, si esa serie tiene 5 actores y actrices en el reparto, el resultado de esta consulta debe ser ‚Äú5‚Äù, no la lista de nombres de esas personas.</li>
    </ul>
  </li>
</ol>

<p>Para hacer este ejercicio, hemos creado una base de datos online a la que puedes acceder con un programa llamado PHPMyAdmin desde la direcci√≥n <a href="https://acceso.donhosting.es/pma/">https://acceso.donhosting.es/pma/</a>. Usa estas credenciales:</p>

<ul>
  <li>Usuario: la primera letra de tu nombre + tu apellido</li>
  <li>Contrase√±a: la primera letra de tu nombre + tu apellido + 2022!</li>
</ul>

<p>Por ejemplo, si te llamas ‚ÄúAna L√≥pez‚Äù, podr√°s entrar con el usuario ‚Äúalopez‚Äù y la contrase√±a ‚Äúalopez2022!‚Äù. Si tu nombre es compuesto, como en ‚ÄúJose Luis Rubio‚Äù, tu cuenta ser√° ‚Äújlrubio‚Äù y tu contrase√±a ‚Äújlrubio2022!‚Äù.</p>

<p>Una vez conectado a MySQL, tendr√°s que seleccionar la base de datos que vas a usar (en el panel de la izquierda). Solo tienes una disponible, as√≠ que no tiene p√©rdida:</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-phpmyadmin-seleccionar-bd.png" alt="Seleccionar la base de datos" /></p>

<p>Ahora escribe tus instrucciones SQL desde la pesta√±a ‚ÄúSQL‚Äù (pulsa ‚ÄúContinuar‚Äù para ejecutar la instrucci√≥n):</p>

<p><img src="/docs/prog-y-3d/_site/assets/images/08-phpmyadmin-ejecutar-sql.png" alt="Ejecutar SQL" /></p>

<p>Para comprobar si tus instrucciones SQL est√°n funcionando:</p>

<ol>
  <li>Aseg√∫rate de que no dan ning√∫n error al ejecutarlas.</li>
  <li>Selecciona una tabla en la lista de tablas y mira en la pesta√±a ‚ÄúEstructura‚Äù a ver si se han creado las tablas como deber√≠an.</li>
  <li>Selecciona una tabla en la lista de tablas y mira en la pesta√±a ‚ÄúExaminar‚Äù a ver si contiene los datos que deber√≠a.</li>
</ol>

<p>No olvides ir copiando tu c√≥digo SQL en alg√∫n editor de texto para poder luego subirme a Moodle el ejercicio completo.</p>
:ET