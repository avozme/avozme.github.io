<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>5.13 Sesiones con Laravel - DWES DOCS</title> <link rel="shortcut icon" href="/docs/dwes/_site/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/dwes/_site/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/dwes/_site/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/dwes/_site/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>5.13 Sesiones con Laravel | DWES DOCS</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="5.13 Sesiones con Laravel" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/docs/dwes/_site/laravel/sesiones.html" /> <meta property="og:url" content="/docs/dwes/_site/laravel/sesiones.html" /> <meta property="og:site_name" content="DWES DOCS" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="5.13 Sesiones con Laravel" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/docs/dwes/_site/laravel/sesiones.html","headline":"5.13 Sesiones con Laravel","description":"Apuntes del módulo de “Desarrollo web en entorno servidor”, de 2º curso del Ciclo Formativo de Grado Superior de “Desarrollo de Aplicaciones Web”, impartido en el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/docs/dwes/_site/" class="site-title lh-tight"> DWES DOCS </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/dwes/_site/" class="nav-list-link">Desarrollo Web en Entorno Servidor</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/dwes/_site/cms/" class="nav-list-link">1 Sistemas gestores de contenido (CMS)</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/dwes/_site/cms/algunas-cosas-que-debes-saber.html" class="nav-list-link">1.1 Algunas cosas que debes saber sobre los CMS</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cms/wordpress.html" class="nav-list-link">1.2 Wordpress</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cms/moodle.html" class="nav-list-link">1.3 Moodle</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cms/prestashop.html" class="nav-list-link">1.4 Prestashop</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/dwes/_site/php/" class="nav-list-link">2 Introducción a PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/dwes/_site/php/programacion-cliente-servidor.html" class="nav-list-link">2.1 Programación cliente-servidor</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/php/caja-de-herramientas.html" class="nav-list-link">2.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/php/sintaxis-de-php.html" class="nav-list-link">2.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/php/interaccion-con-php.html" class="nav-list-link">2.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/php/depuracion-php-xdebug.html" class="nav-list-link">2.4 Depurando el código PHP con xdebug</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/php/ejercicios-propuestos.html" class="nav-list-link">2.6 Ejercicios propuestos</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/php/ejercicios-resueltos.html" class="nav-list-link">2.7 Ejercicios resueltos</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/dwes/_site/cookies-sesiones-seguridad/" class="nav-list-link">3 Cookies, sesiones y seguridad</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/cookies.html" class="nav-list-link">3.1 Cookies</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/sesiones.html" class="nav-list-link">3.2 Sesiones</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/control-de-acceso.html" class="nav-list-link">3.3. Sesiones, cookies y control de acceso</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/tecnicas-de-ataque-frecuentes.html" class="nav-list-link">3.4 Técnicas de ataque frecuentes</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/autenticacion-mediante-acl.html" class="nav-list-link">3.5 Autenticación mediante ACL</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/ejercicios-propuestos.html" class="nav-list-link">3.6 Ejercicios propuestos</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/cookies-sesiones-seguridad/ejercicios-resueltos.html" class="nav-list-link">3.7 Ejercicios resueltos</a> </li></ul></li><li class="nav-list-item "><a href="/docs/dwes/_site/mvc/" class="nav-list-link">4 Arquitectura MVC</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/dwes/_site/laravel/" class="nav-list-link">5 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/que-es-un-framework.html" class="nav-list-link">5.1 Frameworks PHP MVC</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/caracteristicas.html" class="nav-list-link">5.2 Características de Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/instalacion.html" class="nav-list-link">5.3 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/arquitectura-convenciones-configuracion.html" class="nav-list-link">5.4 Arquitectura, convenciones y configuración de Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/artisan.html" class="nav-list-link">5.5 Artisan, la consola que mola</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/hola-mundo-con-laravel.html" class="nav-list-link">5.6 Primeros pasos con Laravel. Hola mundo</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/enrutamiento.html" class="nav-list-link">5.7 Enrutamiento</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/vistas-y-plantillas-con-blade.html" class="nav-list-link">5.8 Vistas y plantillas. Blade</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/controladores.html" class="nav-list-link">5.9 Controladores</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/migraciones.html" class="nav-list-link">5.10 Migraciones</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/eloquent.html" class="nav-list-link">5.11 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/querybuilder.html" class="nav-list-link">5.12 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item active"> <a href="/docs/dwes/_site/laravel/sesiones.html" class="nav-list-link active">5.13 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/helpers.html" class="nav-list-link">5.14 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/flujo-de-trabajo-con-laravel.html" class="nav-list-link">5.15 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/aspectos-avanzados.html" class="nav-list-link">5.16 Aspectos avanzados de Laravel</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/laravel/crud-con-laravel.html" class="nav-list-link">5.17 CRUD desarrollado con Laravel</a> </li></ul></li><li class="nav-list-item "><a href="/docs/dwes/_site/servicios-web/" class="nav-list-link">6 Servicios web</a></li><li class="nav-list-item "><a href="/docs/dwes/_site/ajax/" class="nav-list-link">7 Ajax</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/dwes/_site/otras-tecnologias/" class="nav-list-link">8 Otras tecnologías</a><ul class="nav-list"><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/cgi.html" class="nav-list-link">8.1 CGI</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/perl.html" class="nav-list-link">8.2 Perl</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/python.html" class="nav-list-link">8.3 Python</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/punto-net.html" class="nav-list-link">8.4 .NET</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/jsp.html" class="nav-list-link">8.5 JSP</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/ruby.html" class="nav-list-link">8.6 Ruby</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/nodejs.html" class="nav-list-link">8.7 Node.js</a> </li><li class="nav-list-item "> <a href="/docs/dwes/_site/otros/mas-tecnologias-aun.html" class="nav-list-link">8.8 Más tecnologías aún</a> </li></ul></li><li class="nav-list-item "><a href="/docs/dwes/_site/scv-git/" class="nav-list-link">Apéndice I. Sistemas de control de versiones. Git</a></li></ul></li><li class="nav-list-item"><a href="/docs/dwes/_site/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DWES DOCS" aria-label="Search DWES DOCS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/dwes/_site/">Desarrollo Web en Entorno Servidor</a></li> <li class="breadcrumb-nav-list-item"><a href="/docs/dwes/_site/laravel/">5 Laravel</a></li> <li class="breadcrumb-nav-list-item"><span>5.13 Sesiones con Laravel</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 class="no_toc" id="513-sesiones-con-laravel"> <a href="#513-sesiones-con-laravel" class="anchor-heading" aria-labelledby="513-sesiones-con-laravel"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13. Sesiones con Laravel </h2> <ul id="markdown-toc"> <li><a href="#5131-drivers-de-sesión" id="markdown-toc-5131-drivers-de-sesión">5.13.1. Drivers de sesión</a></li> <li><a href="#5132-persistencia-de-las-variables-de-sesión" id="markdown-toc-5132-persistencia-de-las-variables-de-sesión">5.13.2. Persistencia de las variables de sesión</a></li> <li><a href="#5133-autenticación" id="markdown-toc-5133-autenticación">5.13.3. Autenticación</a></li> <li><a href="#5134-laravel-breeze" id="markdown-toc-5134-laravel-breeze">5.13.4. Laravel Breeze</a></li> <li><a href="#5135-autenticación-y-vistas-cómo-generar-código-dependiendo-del-tipo-de-usuario" id="markdown-toc-5135-autenticación-y-vistas-cómo-generar-código-dependiendo-del-tipo-de-usuario">5.13.5. Autenticación y vistas: cómo generar código dependiendo del tipo de usuario</a></li> <li><a href="#5136-autenticación-y-middlewares-cómo-proteger-los-controladores" id="markdown-toc-5136-autenticación-y-middlewares-cómo-proteger-los-controladores">5.13.6. Autenticación y middlewares: cómo proteger los controladores</a></li> </ul> <p>Como es lógico, Laravel también proporciona su propio sistema de manejo de <strong>variables de sesión</strong>, es decir, variables persistentes en el servidor asociadas a cada cliente.</p> <p>Las variables de sesión de Laravel son mucho más seguras y poderosas que las variables de sesión estándar de PHP. En esta sección vamos a ver cómo funcionan y qué posibilidades nos ofrecen las sesiones en Laravel.</p> <h3 id="5131-drivers-de-sesión"> <a href="#5131-drivers-de-sesión" class="anchor-heading" aria-labelledby="5131-drivers-de-sesión"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13.1. Drivers de sesión </h3> <p>Las sesiones de configuran en <em>/config/sessions.php</em>, y una de las cosas que debes configurar ahí es el <strong>driver</strong> de sesión, es decir, el tipo de manejador que quieres que manipule las sesiones.</p> <ul> <li> <p><strong><em>Files</em></strong>:</p> <p>El driver por defecto es <strong><em>files</em></strong>. Es el más sencillo y funcionará en casi cualquier servidor. Eso significa que Laravel guardará las variables de sesión en un fichero especial en el servidor (que nosotros no tenemos que manejar: Laravel se encargará de todo).</p> </li> <li> <p><strong><em>Memcached</em></strong> y <strong><em>redis</em></strong>:</p> <p>El driver <em>files</em> es más que suficiente para una aplicación en desarrollo, pero para una aplicación en producción, Laravel recomienda usar otros <em>drivers</em> llamados <strong><em>memcached</em></strong> o <strong><em>redis</em></strong> porque son más rápidos. Ambos son <em>daemons</em> del sistema programados para esta tarea. Obviamente, el servidor debe soportarlos para que puedas usarlos.</p> <p>Consulta con tu proveedor o con tu administrador de sistemas la configuración de tu servidor web para saber si puedes usar alguno de estos dos <em>drivers</em>. Si no, tendrás que conformarte con <em>files</em>.</p> </li> <li> <p><strong><em>Database</em></strong>:</p> <p>Si necesitas seguridad adicional, sin duda tu driver es <strong><em>database</em></strong>. Esto almacenará dos copias de cada variable de sesión: una en un fichero y otra en una tabla especial de la base de datos.</p> <p>Si un atacante consiguiera manipular una de las dos variables, Laravel cerrará la sesión automáticamente y el atacante se quedará con un palmo de narices. Eso sí, este sistema es el más lento de todos porque requiere un acceso a la base de datos para cada petición al servidor.</p> </li> </ul> <h3 id="5132-persistencia-de-las-variables-de-sesión"> <a href="#5132-persistencia-de-las-variables-de-sesión" class="anchor-heading" aria-labelledby="5132-persistencia-de-las-variables-de-sesión"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13.2. Persistencia de las variables de sesión </h3> <p>Laravel maneja dos tipos de variable según su persistencia:</p> <ul> <li><strong>Variables flash</strong>: solo duran una petición y luego desaparecen.</li> <li><strong>Variables de sesión convencionales</strong>: existen hasta que las destruimos expresamente.</li> </ul> <h4 id="variables-flash"> <a href="#variables-flash" class="anchor-heading" aria-labelledby="variables-flash"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables flash </h4> <p>Son variables de sesión que solo duran una petición y luego se <em>autodestruyen</em>. Se usan típicamente para enviar un <em>feedback</em> o mensaje de retroalimentación al usuario.</p> <p>Te lo muestro con un ejemplo. Imagina el típico formulario de <em>login</em>. En caso de producirse un error, lo habitual es que la aplicación nos muestre de nuevo ese formulario con un mensaje del tipo de “Usuario no reconocido”.</p> <p>Para lograr eso, haríamos lo siguiente en el controlador. Observa el uso del método <em>with()</em> para crear una variable flash de sesión llamada <em>mensaje</em>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">return</span> <span class="p">(</span><span class="s1">'login/form'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">with</span><span class="p">(</span><span class="s1">'mensaje'</span><span class="p">,</span> <span class="s1">'Usuario no reconocido'</span><span class="p">);</span>
</code></pre></div></div> <p>En la vista, podemos acceder a esa variable flash. Por ejemplo, así:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="k">if</span> <span class="p">(</span><span class="nf">session</span><span class="p">(</span><span class="s1">'mensaje'</span><span class="p">))</span>
        <span class="p">{{</span> <span class="nf">session</span><span class="p">(</span><span class="s1">'mensaje'</span><span class="p">);</span> <span class="p">}}</span>
    <span class="o">@</span><span class="k">endif</span>
</code></pre></div></div> <p>A partir de este momento, la variable flash se destruye y cualquier intento de acceder a ella provocará un error de ejecución.</p> <h4 id="variables-de-sesión-convencionales"> <a href="#variables-de-sesión-convencionales" class="anchor-heading" aria-labelledby="variables-de-sesión-convencionales"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables de sesión convencionales </h4> <p>Las variables de sesión convencionales se manejan con la <strong>clase <em>Session</em></strong>, que tiene un montón de métodos estáticos para crear variables, destruirlas, consultarlas, etc.</p> <p>Los métodos más útiles son:</p> <ul> <li> <p><strong>put()</strong> -&gt; almacena una variable de sesión:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">Session</span><span class="o">::</span><span class="nf">put</span><span class="p">(</span><span class="s1">'nombre-variable'</span><span class="p">,</span> <span class="s1">'valor'</span><span class="p">);</span>
</code></pre></div> </div> </li> <li> <p><strong>push()</strong> -&gt; elimina una variable de sesión:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">Session</span><span class="o">::</span><span class="nf">push</span><span class="p">(</span><span class="s1">'nombre-variable'</span><span class="p">);</span>
</code></pre></div> </div> </li> <li> <p><strong>get()</strong> -&gt; devuelve el valor de una variable de sesión:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$v</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'nombre-variable'</span><span class="p">);</span>
    <span class="nv">$v</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'nombre-variable'</span><span class="p">,</span> <span class="s1">'valor-por-defecto'</span><span class="p">);</span>
</code></pre></div> </div> </li> <li> <p><strong>all()</strong> -&gt; devuelve todas las variables de sesión en un array:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$a</span> <span class="o">=</span> <span class="nc">Session</span><span class="o">::</span><span class="nf">all</span><span class="p">(</span><span class="s1">'nombre-variable'</span><span class="p">,</span> <span class="s1">'valor'</span><span class="p">);</span>
</code></pre></div> </div> </li> <li> <p><strong>flush()</strong> -&gt; elimina todas las variables de sesión:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">Session</span><span class="o">::</span><span class="nb">flush</span><span class="p">();</span>
</code></pre></div> </div> </li> <li> <p><strong>flash()</strong> -&gt; crea manualmente una variable de sesión de tipo flash:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nc">Session</span><span class="o">::</span><span class="nf">flash</span><span class="p">(</span><span class="s1">'nombre-variable'</span><span class="p">,</span> <span class="s1">'valor'</span><span class="p">);</span>
</code></pre></div> </div> </li> </ul> <h3 id="5133-autenticación"> <a href="#5133-autenticación" class="anchor-heading" aria-labelledby="5133-autenticación"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13.3. Autenticación </h3> <p>La autenticación de usuarios, es decir, el sistema de <em>login</em> seguido de la creación de una o varias variables de sesión asociadas al usuario que se acaba de loguear, es un componente habitual de muchas aplicaciones web.</p> <p>Hasta la versión 5, Laravel proporcionaba un sistema de autenticación integrado en su código que se podía añadir a nuestra aplicación con un simple comando de Artisan. Pero a partir de Laravel 6, los desarrolladores decidieron aligerar el núcleo de Laravel lo máximo posible, y sacaron del sistema muchos componentes, incluyendo el sistema de autencicación.</p> <p>Actualmente, Laravel proporciona los denominados <em>Starter Kits</em>, que son componentes que se pueden instalar mediante <em>composer</em> para realizar esas tareas que se extrajeron del núcleo de Laravel.</p> <p>Para la autenticación, Laravel dispone de dos <em>Starter Kits</em>, llamados <strong><em>Breeze</em></strong> y <strong><em>Jetstream</em></strong>. Vamos a ver el primero, que es más sencillo pero suficiente en la mayor parte de las situaciones.</p> <h3 id="5134-laravel-breeze"> <a href="#5134-laravel-breeze" class="anchor-heading" aria-labelledby="5134-laravel-breeze"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13.4. Laravel Breeze </h3> <p><strong><em>Larevel Breeze</em></strong> contiene todo el código necesario para crear un sistema de autenticación completo y seguro capaz, entre otras cosas, de:</p> <ul> <li>Hacer el Login e iniciar la sesión</li> <li>Registrar nuevos usuarios</li> <li>Recuperar contraseñas olvidadas</li> <li>Confirmaar el registro de usuarios mediante email</li> </ul> <p>Para <strong>instalar <em>Laravel Breeze</em></strong>, debes abrir un terminal en tu servidor web y ejecutar estos comandos:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ composer require laravel/breeze --dev
$ php artisan breeze:install
$ npm install
$ npm run dev
$ php artisan migrate
</code></pre></div></div> <p>El primer comando instalará las librerías PHP necesarias para que <em>Laravel Breeze</em> se ejecute. El segundo, añadirá <em>Breeze</em> a tu aplicación, creando automáticamente varios controladores, modelos, vistas y hasta migraciones. Los dos comandos <em>npm</em> sirven para compilar el CSS y el JS de <em>Breeze</em>, de manera que funcione más rápido. Por último, actualizamos las migraciones para que se creen las tablas adicionales que <em>Breeze</em> va a necesitar.</p> <p>Una vez hecho esto, <em>Breeze</em> creará automáticamente varias rutas en un enrutador especial, <em>/routes/auth.php</em>. Entre ellas:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Routes</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/login"</span><span class="p">)</span> <span class="err">→</span> <span class="nc">Para</span> <span class="n">mostrar</span> <span class="n">el</span> <span class="n">formulario</span> <span class="n">de</span> <span class="n">login</span>
<span class="nc">Routes</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s2">"/login"</span><span class="p">)</span> <span class="err">→</span> <span class="nc">Para</span> <span class="n">procesar</span> <span class="n">el</span> <span class="n">formulario</span> <span class="n">de</span> <span class="n">login</span>
<span class="nc">Routes</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s2">"/logout"</span><span class="p">)</span> <span class="err">→</span> <span class="nc">Para</span> <span class="n">cerrar</span> <span class="n">la</span> <span class="n">sesión</span>
<span class="nc">Routes</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/register"</span><span class="p">)</span> <span class="err">→</span> <span class="nc">Para</span> <span class="n">mostrar</span> <span class="n">el</span> <span class="n">fomulario</span> <span class="n">de</span> <span class="n">registro</span>
<span class="nc">Routes</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s2">"/register"</span><span class="p">)</span> <span class="err">→</span> <span class="nc">Para</span> <span class="n">procesar</span> <span class="n">el</span> <span class="n">formulario</span> <span class="n">de</span> <span class="n">registro</span>
</code></pre></div></div> <p>Puedes probarlas escribiéndolas en tu navegador. Comprobarás que funcionan estupendamente.</p> <p>También se crearán varios controladores como <em>LoginController</em> y <em>RegisterContoller</em>. Los puedes encontrar en <em>App/Http/Controllers/Auth</em>.</p> <p>Y, por supuesto, se crean varias vistas, como <em>auth/login.blade.php</em>, <em>register.blade.php</em> y <em>layouts/app.blade.php</em> (la plantilla que usarán <em>login</em> y <em>register</em>).</p> <p>Por último, se crea una vista <em>home</em> de ejemplo (<em>dashboard.blade.php</em>) a la que llegamos después de hacer login. Esa vista <em>home</em> la puedes cambiar en <em>/app/providers/RouteServiceProvider.php</em> para redirigirla a la vista que te interese.</p> <p>¡Y listo! Ya tienes hecho un sistema de login completo y superseguro. Solo te queda adaptar esas vistas y controladores a tus necesidades.</p> <h3 id="5135-autenticación-y-vistas-cómo-generar-código-dependiendo-del-tipo-de-usuario"> <a href="#5135-autenticación-y-vistas-cómo-generar-código-dependiendo-del-tipo-de-usuario" class="anchor-heading" aria-labelledby="5135-autenticación-y-vistas-cómo-generar-código-dependiendo-del-tipo-de-usuario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13.5. Autenticación y vistas: cómo generar código dependiendo del tipo de usuario </h3> <p>En las vistas, tenemos un par de directivas de Blade muy útiles relacionadas con las sesiones: <strong><em>@auth</em></strong> y <strong><em>@guest</em></strong>. Puedes ver cómo funcionan en este ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="o">@</span><span class="n">auth</span>
   <span class="mf">...</span>   <span class="c1">// Este código solo se ejecuta si existe un usuario logueado</span>
   <span class="o">@</span><span class="n">endauth</span>
   <span class="o">@</span><span class="n">guest</span>
   <span class="mf">...</span>   <span class="c1">// Este código solo se ejecuta si NO existe usuario logueado</span>
   <span class="o">@</span><span class="n">endguest</span>
</code></pre></div></div> <p>Además, podemos acceder a los datos del usuario mediante la clase Auth:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nc">Auth</span><span class="o">::</span><span class="nf">user</span><span class="p">()</span> <span class="c1">// Devuelve el usuario actualmente logueado o null si no hay ninguna sesión abierta.</span>
<span class="k">if</span> <span class="p">(</span><span class="nc">Auth</span><span class="o">::</span><span class="nf">check</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// Devuelve true si el usuario actual está logueado.</span>
   <span class="mf">...</span>
<span class="p">}</span>
</code></pre></div></div> <p>(Más métodos de Auth en <a href="https://laravel.com/docs/8.x/authentication">la documentación oficial</a>)</p> <h3 id="5136-autenticación-y-middlewares-cómo-proteger-los-controladores"> <a href="#5136-autenticación-y-middlewares-cómo-proteger-los-controladores" class="anchor-heading" aria-labelledby="5136-autenticación-y-middlewares-cómo-proteger-los-controladores"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.13.6. Autenticación y middlewares: cómo proteger los controladores </h3> <p>Los <strong>middlewares</strong> de Laravel son componentes que capturan y filtran todas las peticiones HTTP que llegan a la aplicación. Literalmente, se ponen <em>en medio</em> de cualquier petición al servidor, y de ahí su nombre. Están ubicados en <em>App/Http/Middleware</em>.</p> <p>Hay dos <em>middlewares</em> importantes relacionados con la autenticación en Laravel: <em>Authenticate</em> (que tiene un alias: <strong><em>auth</em></strong>) y <em>RedirectIfAuthenticated</em> (alias <strong><em>guest</em></strong>). Los alias se definen en <em>App/Http/Kernel.php</em></p> <p>Podemos usar estos <em>middlewares</em> en el constructor de nuestros controladores para protegerlos en todo o en parte. Es decir, para impedir el acceso de usuarios no logueados a ciertos métodos del controlador.</p> <p>Observa este ejemplo para aprender a hacerlo. Ya verás qué fácil y versátil es:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Solo usuarios logueados podrán acceder a cualquier función de este controlador:</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s2">"auth"</span><span class="p">);</span> 
      <span class="c1">// Solo usuarios logueados podrán acceder a los métodos create() y edit():</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s2">"auth"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">only</span><span class="p">(</span><span class="s2">"create"</span><span class="p">,</span> <span class="s2">"edit"</span><span class="p">);</span>
      <span class="c1">// Solo usuarios logueados podrán acceder al controlador excepto a show():</span>
      <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s2">"auth"</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">except</span><span class="p">(</span><span class="s2">"show"</span><span class="p">);</span>
   <span class="p">}</span>
</code></pre></div></div> <p>El <em>middleware auth</em> también puede usarse en el enrutador, para proteger el acceso a una ruta concreta, así:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/ruta-a-proteger'</span><span class="p">,</span> <span class="s1">'Controlador@metodo'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'auth'</span><span class="p">);</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
