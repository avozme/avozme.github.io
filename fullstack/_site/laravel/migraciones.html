<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>2.9 Migraciones - DESARROLLO WEB FULL STACK</title> <link rel="shortcut icon" href="/docs/fullstack/_site/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/fullstack/_site/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/fullstack/_site/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/fullstack/_site/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>2.9 Migraciones | DESARROLLO WEB FULL STACK</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="2.9 Migraciones" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="http://localhost:4000/docs/fullstack/_site/laravel/migraciones.html" /> <meta property="og:url" content="http://localhost:4000/docs/fullstack/_site/laravel/migraciones.html" /> <meta property="og:site_name" content="DESARROLLO WEB FULL STACK" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="2.9 Migraciones" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)","headline":"2.9 Migraciones","url":"http://localhost:4000/docs/fullstack/_site/laravel/migraciones.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/docs/fullstack/_site/" class="site-title lh-tight"> DESARROLLO WEB FULL STACK </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/fullstack/_site/" class="nav-list-link">Desarrollo web full stack</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/fullstack/_site/php/" class="nav-list-link">1 Programación web con PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/frontend-backend-fullstack.html" class="nav-list-link">1.1 Frontend vs backend vs full stack</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/caja-de-herramientas.html" class="nav-list-link">1.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/sintaxis-de-php.html" class="nav-list-link">1.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/interaccion-con-mysql.html" class="nav-list-link">1.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/depuracion-php-xdebug.html" class="nav-list-link">1.5 Depurando el código PHP con xdebug</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/cookies-y-sesiones.html" class="nav-list-link">1.6 Cookies y variables de sesión</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/mvc/" class="nav-list-link">1.7 Arquitectura MVC</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/ejemplos-resueltos.html" class="nav-list-link">1.8 Ejemplos resueltos</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/php/ejercicios-propuestos.html" class="nav-list-link">1.9 Prácticas</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/fullstack/_site/laravel/" class="nav-list-link">2 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/caracteristicas.html" class="nav-list-link">2.1 Características de Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/instalacion.html" class="nav-list-link">2.2 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/configuracion.html" class="nav-list-link">2.3 Configuración de Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/artisan.html" class="nav-list-link">2.4 Artisan</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/hola-mundo-con-laravel.html" class="nav-list-link">2.5 Hola mundo</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/enrutamiento.html" class="nav-list-link">2.6 Enrutamiento</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/vistas-blade.html" class="nav-list-link">2.7 Vistas y plantillas con Blade</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/controladores.html" class="nav-list-link">2.8 Controladores</a> </li><li class="nav-list-item active"> <a href="http://localhost:4000/docs/fullstack/_site/laravel/migraciones.html" class="nav-list-link active">2.9 Migraciones</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/eloquent.html" class="nav-list-link">2.10 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/querybuilder.html" class="nav-list-link">2.11 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/sesiones.html" class="nav-list-link">2.12 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/helpers.html" class="nav-list-link">2.13 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/flujo-de-trabajo-con-laravel.html" class="nav-list-link">2.14 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/aspectos-avanzados.html" class="nav-list-link">2.15 Aspectos avanzados de Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/crud-con-laravel.html" class="nav-list-link">2.16 CRUD desarrollado con Laravel</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/docs/fullstack/_site/laravel/practicas.html" class="nav-list-link">2.17 Prácticas</a> </li></ul></li><li class="nav-list-item "><a href="http://localhost:4000/docs/fullstack/_site/api-rest/" class="nav-list-link">3 Desarrollo de un API REST</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/fullstack/_site/vue-js/" class="nav-list-link">4 Vue.js</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/fullstack/_site/inertia/" class="nav-list-link">5 Intertia.js</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/fullstack/_site/scv-git/" class="nav-list-link">Apéndice 1. Sistemas de control de versiones. Git</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/fullstack/_site/docker/" class="nav-list-link">Apéndice 2. Virtualización con Docker</a></li><li class="nav-list-item "><a href="http://localhost:4000/docs/fullstack/_site/openstack/" class="nav-list-link">Apéndice 3. Despliegue con Openstack</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/docs/fullstack/_site/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DESARROLLO WEB FULL STACK" aria-label="Search DESARROLLO WEB FULL STACK" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/fullstack/_site/">Desarrollo web full stack</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/fullstack/_site/laravel/">2 Laravel</a></li> <li class="breadcrumb-nav-list-item"><span>2.9 Migraciones</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h2 class="no_toc" id="29-migraciones"> <a href="#29-migraciones" class="anchor-heading" aria-labelledby="29-migraciones"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9. Migraciones </h2> <ul id="markdown-toc"> <li><a href="#291-crear-tablas-mediante-las-migraciones" id="markdown-toc-291-crear-tablas-mediante-las-migraciones">2.9.1. Crear tablas mediante las migraciones</a></li> <li><a href="#292-modificar-tablas-mediante-migraciones" id="markdown-toc-292-modificar-tablas-mediante-migraciones">2.9.2. Modificar tablas mediante migraciones</a></li> <li><a href="#293-otras-operaciones-en-las-migraciones" id="markdown-toc-293-otras-operaciones-en-las-migraciones">2.9.3. Otras operaciones en las migraciones</a></li> <li><a href="#294-seeding" id="markdown-toc-294-seeding">2.9.4. Seeding</a></li> <li><a href="#295-faker-rellenar-las-tablas-con-datos-realistas" id="markdown-toc-295-faker-rellenar-las-tablas-con-datos-realistas">2.9.5. Faker: rellenar las tablas con datos realistas</a></li> <li><a href="#296-automatizar-el-seeding" id="markdown-toc-296-automatizar-el-seeding">2.9.6. Automatizar el seeding</a></li> <li><a href="#297-chuleta-de-comandos-habituales" id="markdown-toc-297-chuleta-de-comandos-habituales">2.9.7. Chuleta de comandos habituales</a></li> </ul> <p>Las <strong>migraciones</strong> constituyen una especie de <strong>control de versiones para la base de datos</strong> de la aplicación, puesto que permiten:</p> <ul> <li>Crear y modificar tablas de la BD con independencia del SGBD que estemos usando y sin usar SQL.</li> <li>Controlar la versión de la base de datos, puesto que cada migración es como un <em>commit</em>.</li> <li>Desplegar la base de datos en otros servidores y dejarla exactamente en el estado que se corresponde con el código.</li> </ul> <p>Con las migraciones, por tanto, no solo podrás reconstruir la base de datos en menos de lo que tarda en decirse “Von Neumann” (algo muy práctico cuando estás en fase de desarrollo y detrozas las tablas cada dos por tres), sino que podrás parchearla en producción en un tiempo record y con riesgo cero.</p> <p>(Solo el que ha tenido que parchear la base de datos de una aplicación en producción antes de la existencia de las migraciones sabe la tranquilidad de espíritu que esto produce y la cantidad de problemas embarazosos que te quita de encima).</p> <p>Antes de empezar, recuerda que, para que cualquier operación sobre la base de datos funcione, <strong>debes tener bien configurado el archivo .env</strong>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DB_HOST=localhost
DB_DATABASE=mi-base-de-datos
DB_USERNAME=mi-usuario-de-BD
DB_PASSWORD=mi-password-de-BD
</code></pre></div></div> <h3 id="291-crear-tablas-mediante-las-migraciones"> <a href="#291-crear-tablas-mediante-las-migraciones" class="anchor-heading" aria-labelledby="291-crear-tablas-mediante-las-migraciones"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.1. Crear tablas mediante las migraciones </h3> <p>La primera cosa para las que sirven las migraciones es para <strong>crear las tablas de tu aplicación</strong>. Olvídate de exportar e importar a mano el archivo SQL de tu base de datos. Eso lo hacían los cromañones.</p> <p>Vamos a trabajar con un ejemplo, como siempre. Imagina que tenemos una tabla llamada <em>Clients</em> con los campos típicos: <em>id</em>, <em>name</em>, <em>address</em>, etc.</p> <p>De acuerdo. Creemos, paso a paso, las migraciones de esta tabla:</p> <p><strong>Paso 1</strong>: Inicializar el sistema de migraciones de Laravel (si ya lo hemos hecho antes, nos dará un error al intentar hacerlo otra vez):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan migrate:install
</code></pre></div></div> <p><strong>Paso 2</strong>: Crear la migración para la tabla Clients:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan make:migration create_clients_table
</code></pre></div></div> <p>Esto generará un fichero en la carpeta <em>/database/migrations</em> cuyo nombre contendrá un <em>timestamp</em> o marca de tiempo. Vamos, que contendrá un numerajo con la fecha y hora actual. Algo tan bonito como <em>/database/migrations/20221226072434createclientstable.php</em></p> <p>Si editas ese fichero, verás dos métodos:</p> <ul> <li><strong>up()</strong> → se ejecuta cuando se lanza la migración. Se encarga de crear la tabla en la base de datos.</li> <li><strong>down()</strong> → se ejecuta cuando se cancela la migración. Se encarga de eliminar la tabla de la base de datos.</li> </ul> <p><strong>Paso 3</strong>: Editar el fichero <em>/database/migrations/20221226072434createclientstable.php</em>:</p> <p>En el método <em>up()</em> tienes que indicar las columnas que tendrá la tabla. Por ejemplo:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
    <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
       <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>     <span class="c1">// PRIMARY KEY UNSIGNED BIGINT AUTOINCREMENT</span>
       <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span><span class="mi">75</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">unique</span><span class="p">();</span> <span class="c1">// VARCHAR</span>
       <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'address'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span> <span class="c1">// TEXT</span>
       <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">integer</span><span class="p">(</span><span class="s1">'level'</span><span class="p">);</span>            <span class="c1">// INT</span>
       <span class="nv">$table</span><span class="o">-&gt;</span><span class="nb">date</span><span class="p">(</span><span class="s1">'birth_date'</span><span class="p">);</span>          <span class="c1">// DATE</span>
       <span class="c1">// La siguiente línea crea campos created_at y updated_at</span>
       <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>  
    <span class="p">});</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
    <span class="nc">Schema</span><span class="o">::</span><span class="nf">drop</span><span class="p">(</span><span class="s1">'users'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Paso 4</strong>: Lanzar las migraciones.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan migrate
</code></pre></div></div> <p>Esto creará las tablas que no se hayan creado aún. Es decir, si una migración ya se ha lanzado con anterioridad, no se vuelve a ejecutar para no perder los datos que pudieran existir en esas tablas.</p> <p><strong>Paso 5</strong>: Revertir las migraciones (si es necesario)</p> <p>Si necesitas revertir la última migración, es decir, dehacer el último <em>commit</em>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan migrate:rollback
</code></pre></div></div> <p>O puedes indicar cuántas migraciones quieres deshacer con <em>step = n</em>. Por ejemplo, para deshacer las 3 últimas:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan migrate:rollback --step=3
</code></pre></div></div> <p>Durante el desarrollo, es útil hacer retroceder la BD a su estado original:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan migrate:refresh
</code></pre></div></div> <p>¡Cuidado! Estas acciones son destructivas. Pero, por supuesto, hay una forma de modificar una tabla sin borrarla y volver a crearla. Es lo que vamos a hacer a continuación.</p> <h3 id="292-modificar-tablas-mediante-migraciones"> <a href="#292-modificar-tablas-mediante-migraciones" class="anchor-heading" aria-labelledby="292-modificar-tablas-mediante-migraciones"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.2. Modificar tablas mediante migraciones </h3> <p>Si necesitas <strong>modificar una tabla que ya existe</strong> (por ejemplo, para añadir o eliminar campos), tienes dos opciones:</p> <ol> <li>Modificar la migración original (en la que se crea la tabla) para añadir o eliminar el campo afectado. Esto te obligará a lanzar la migración de nuevo y, por lo tanto, la tabla se reconstruirá y todos los datos que pudiera contener se perderán.</li> <li>Crear una nueva migración en la que únicamente se haga la modificación de la tabla, sin tocar el resto. Esto respetará los datos que la tabla ya pudiera contener.</li> </ol> <p>Como es lógico, la opción 2 será la que preferiremos si la aplicación ya está en producción y necesitamos modificar la estructura de la base de datos. En cambio, durante el desarrollo, puede ser más simple utilizar la opción 1.</p> <p>Supongamos que queremos añadir un campo <em>email</em> a la tabla <em>Clients</em> del apartado anterior. Si optas por la opción 2, es decir, por crear una nueva migración que se encargue de hacer esa modificación en la tabla sin alterar sus datos, la forma de proceder es la siguiente:</p> <p><strong>Paso 1</strong>. Crear la migración:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan make:migration add_email_to_clients --table=clients
</code></pre></div></div> <p>(Nota: puedes asignar el nombre que quieras a las migraciones, pero Laravel aconseja utilizar las convenciones que ves en estos ejemplos para simplificarnos la vida)</p> <p><strong>Paso 2</strong>: Editar la migración <em>/database/migration/add_email_to_clients.php</em> para añadir, en el método <em>up()</em>, el campo nuevo; y, en el método <em>down()</em>, especificaremos qué hay que hacer en caso de que se fuerce un rollback de esta migración:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'clients'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'email'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">after</span><span class="p">(</span><span class="s1">'address'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'clients'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">dropColumn</span><span class="p">(</span><span class="s1">'email'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div> <h3 id="293-otras-operaciones-en-las-migraciones"> <a href="#293-otras-operaciones-en-las-migraciones" class="anchor-heading" aria-labelledby="293-otras-operaciones-en-las-migraciones"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.3. Otras operaciones en las migraciones </h3> <p>Las migraciones pueden usarse para cualquier otra operación sobre la estructura de la base de datos, como:</p> <ul> <li>Cambiar tipos de columnas.</li> <li>Cambiar atributos de columnas (null, unique, default…)</li> <li>Cambiar o asignar claves primarias y ajenas.</li> </ul> <p>Las migraciones construídas de este modo nos permitirán reproducir la base de datos en cualquier servidor o actualizarla en cualquier momento sobre una aplicación en producción sin necesidad de programar parches o exportar la BD a un archivo SQL para importarlo en otro servidor.</p> <p>Como te dije al principio, solo el que ha hecho alguna vez alguna de estas cosas a mano sabe la cantidad de trabajo que las migraciones ahorran en el mantenimiento de una aplicación y la asombrosa cantidad de errores embarazosos que evita.</p> <p>Más info en: <a href="https://laravel.com/docs/migrations">https://laravel.com/docs/migrations</a></p> <h3 id="294-seeding"> <a href="#294-seeding" class="anchor-heading" aria-labelledby="294-seeding"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.4. Seeding </h3> <p>El <strong><em>seeding</em></strong> es una técnica adicional a la de las migraciones que permite <strong>cargar con datos las tablas</strong> de la base de datos.</p> <p>Es muy práctico en estos supuestos:</p> <ul> <li>Si quieres tener un conjunto de <strong>datos de prueba</strong> en tu base de datos de desarrollo, esa que destrozas periódicamente cuando haces pruebas. Con un solo comando, tendrás la base de datos reconstruída después de cada destrozo.</li> <li>Si necesitas cargar algunos datos mínimos en algunas tablas para que la aplicación, una vez desplegada en un servidor de producción, funcione (por ejemplo, para crear un usuario administrador en la tabla <em>Users</em> o para crear algunas entradas en una tabla <em>Options</em>).</li> </ul> <p>Para crear un <em>seeder</em> (por ejemplo, para la tabla <em>users</em>), sigue estos pasos:</p> <p><strong>Paso 1</strong>. Ejecuta el comando:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php artisan make:seeder UsersTableSeeder
</code></pre></div></div> <p><strong>Paso 2</strong>. Edita el archivo <em>/database/seeders/UsersTableSeeder.php</em> y añade algo como esto al método <em>up()</em> (por supuesto, modifica el código para adaptarlo a tu tabla y a tus datos):</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">User</span><span class="o">::</span><span class="nf">truncate</span><span class="p">();</span>  <span class="c1">// Opativo: vacía la tabla antes de rellenarla de nuevo</span>
        <span class="nc">User</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Stephen Falken'</span><span class="p">,</span>
            <span class="s1">'address'</span> <span class="o">=&gt;</span> <span class="s1">'Oregon 97, Goose Island'</span><span class="p">,</span>
            <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'sfalken@norad.com'</span><span class="p">,</span>
            <span class="s1">'birth_date'</span> <span class="o">=&gt;</span> <span class="s1">'1932-09-03'</span><span class="p">,</span>
        <span class="p">]);</span>
        <span class="nc">User</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Jennifer Mack'</span><span class="p">,</span>
            <span class="s1">'address'</span> <span class="o">=&gt;</span> <span class="s1">'Richmond Av 3385, Seattle'</span><span class="p">,</span>
            <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'jenmack876@gmail.com'</span><span class="p">,</span>
            <span class="s1">'birth_date'</span> <span class="o">=&gt;</span> <span class="s1">'1967-01-28'</span><span class="p">,</span>
        <span class="p">]);</span>        
    <span class="p">}</span>
</code></pre></div></div> <p><strong>Paso 3</strong>. Ejecuta este comando para lanzar el <em>seeder</em> y que los datos se carguen en tu tabla:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan db:seed --class=UsersTableSeeder
</code></pre></div></div> <p>Esto cargará solo dos registros en la tabla <em>users</em>. Si quieres más, solo tienes que crear nuevas líneas <em>insert()</em> en el método <em>up()</em>.</p> <h3 id="295-faker-rellenar-las-tablas-con-datos-realistas"> <a href="#295-faker-rellenar-las-tablas-con-datos-realistas" class="anchor-heading" aria-labelledby="295-faker-rellenar-las-tablas-con-datos-realistas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.5. Faker: rellenar las tablas con datos realistas </h3> <p>Con Laravel también podemos rellenar las tablas con datos de prueba o ejemplo <strong>falsos pero que parezcan realistas</strong>, gracias a <strong><em>Faker</em></strong>, una librería externa de PHP que se instala con Laravel, creada precisamente para esto.</p> <p>Lo vemos con un ejemplo. Supongamos que quieres rellenar la tabla <em>user</em> con 100 registros de prueba realistas. Lo único que tienes que hacer es:</p> <p><strong>Paso 1</strong>. Crear el <em>seeder</em> para la tabla <em>users</em> (si no lo habías hecho ya):</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php artisan make:seeder UsersTableSeeder
</code></pre></div></div> <p><strong>Paso 2</strong>. Editar el <em>seeder</em> (<em>/database/seeders/UsersTableSeeder.php</em>) para añadir la creación de datos con <em>Faker</em>. Por ejemplo, para 100 registros:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$faker</span> <span class="o">=</span> <span class="nc">Faker</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'en_US'</span><span class="p">);</span> <span class="c1">// Cambiar por 'es_ES' para español</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">User</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'name'</span>       <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">'address'</span>    <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="n">address</span><span class="p">,</span>
            <span class="s1">'email'</span>      <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="nf">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">safeEmail</span><span class="p">,</span>
            <span class="s1">'birth_date'</span> <span class="o">=&gt;</span> <span class="nv">$faker</span><span class="o">-&gt;</span><span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">,</span> <span class="s1">'2010-01-01'</span><span class="p">),</span> <span class="c1">// genera fechas de nacimiento hasta 2010</span>
            <span class="s1">'created_at'</span> <span class="o">=&gt;</span> <span class="nf">now</span><span class="p">(),</span>
            <span class="s1">'updated_at'</span> <span class="o">=&gt;</span> <span class="nf">now</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div> <p><strong>Paso 3</strong>. No olvides lanzar el seeder:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php artisan db:seed <span class="nt">--class</span><span class="o">=</span>UsersTableSeeder
</code></pre></div></div> <p>Más información sobre Faker en <a href="https://fakerphp.org/">https://fakerphp.org/</a></p> <h3 id="296-automatizar-el-seeding"> <a href="#296-automatizar-el-seeding" class="anchor-heading" aria-labelledby="296-automatizar-el-seeding"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.6. Automatizar el seeding </h3> <p>Lanzar los seeders de uno en uno puede ser muy tedioso. Puedes lanzar varios seeders con un solo comando si haces lo siguiente:</p> <p><strong>Paso 1</strong>. Edita el fichero <em>/database/seeders/DatabaseSeeder.php</em></p> <p><strong>Paso 2</strong>. Añade a la función <em>run()</em> los <em>seeders</em> que quieras ejecutar automáticamente:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">call</span><span class="p">([</span>
         <span class="nc">UsersTableSeeder</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="nc">OtroSeeder</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="n">etc</span>
    <span class="p">)];</span>  
</code></pre></div></div> <p><strong>Paso 3</strong>. ¡Y listo! Al ejecutar el comando <code class="language-plaintext highlighter-rouge">db:seed</code> de Artisan, sin indicar la clase, se lanzarán todos los seeders que hayas añadido a <em>run()</em>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ php artisan db:seed
</code></pre></div></div> <h3 id="297-chuleta-de-comandos-habituales"> <a href="#297-chuleta-de-comandos-habituales" class="anchor-heading" aria-labelledby="297-chuleta-de-comandos-habituales"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.9.7. Chuleta de comandos habituales </h3> <p>Por último, te muestro un resumen con los comandos más útiles sobre migraciones y seeders para que puedas consultarlos cuando lo necesites:</p> <ul> <li> <p>Lanzar todas las migraciones pendientes:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate
</code></pre></div> </div> </li> <li> <p>Crear la migración para crear una tabla:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan make:migration &lt;nombre&gt; --create=&lt;tabla&gt;
</code></pre></div> </div> </li> <li> <p>Crear una migración para modificar una tabla ya existente:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan make:migration &lt;nombre&gt; --table=&lt;tabla&gt;
</code></pre></div> </div> </li> <li> <p>Retroceder un paso en todas las migraciones:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:rollback
</code></pre></div> </div> </li> <li> <p>Retroceder N pasos en todas las migraciones:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:rollback --step=N
</code></pre></div> </div> </li> <li> <p>Deshacer todas las migraciones que se hayan ejecutado hasta ahora (resetear la base de datos):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:reset
</code></pre></div> </div> </li> <li> <p>Resetear la base de datos y volver a reconstruirla lanzando todas las migraciones:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:refresh
</code></pre></div> </div> </li> <li> <p>Resetear la base de datos, reconstruirla y llenarla de datos con los seeders de <em>DatabaseSeeder</em>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:refresh --seed
</code></pre></div> </div> </li> <li> <p>Eliminar todas las tablas y lanzar todas las migraciones de nuevo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:fresh
</code></pre></div> </div> </li> <li> <p>Eliminar todas las tablas y lanzar todas las migraciones y todos los seeders de nuevo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> $ php artisan migrate:fresh --seed
</code></pre></div> </div> </li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
