<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>3 Desarrollo de un API REST - DESARROLLO WEB FULL STACK</title> <link rel="shortcut icon" href="/docs/fullstack/_site/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/fullstack/_site/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/fullstack/_site/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/fullstack/_site/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>3 Desarrollo de un API REST | DESARROLLO WEB FULL STACK</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="3 Desarrollo de un API REST" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="https://iescelia.org/docs/fullstack/_site/api-rest/" /> <meta property="og:url" content="https://iescelia.org/docs/fullstack/_site/api-rest/" /> <meta property="og:site_name" content="DESARROLLO WEB FULL STACK" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="3 Desarrollo de un API REST" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)","headline":"3 Desarrollo de un API REST","url":"https://iescelia.org/docs/fullstack/_site/api-rest/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://iescelia.org/docs/fullstack/_site/" class="site-title lh-tight"> DESARROLLO WEB FULL STACK </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://iescelia.org/docs/fullstack/_site/" class="nav-list-link">Desarrollo web full stack</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://iescelia.org/docs/fullstack/_site/php/" class="nav-list-link">1 Programación web con PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/frontend-backend-fullstack.html" class="nav-list-link">1.1 Frontend vs backend vs full stack</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/caja-de-herramientas.html" class="nav-list-link">1.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/sintaxis-de-php.html" class="nav-list-link">1.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/interaccion-con-mysql.html" class="nav-list-link">1.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/depuracion-php-xdebug.html" class="nav-list-link">1.5 Depurando el código PHP con xdebug</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/cookies-y-sesiones.html" class="nav-list-link">1.6 Cookies y variables de sesión</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/mvc/" class="nav-list-link">1.7 Arquitectura MVC</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/ejemplos-resueltos.html" class="nav-list-link">1.8 Ejemplos resueltos</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/ejercicios-propuestos.html" class="nav-list-link">1.9 Prácticas</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://iescelia.org/docs/fullstack/_site/laravel/" class="nav-list-link">2 Laravel</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/caracteristicas.html" class="nav-list-link">2.1 Características de Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/instalacion.html" class="nav-list-link">2.2 Instalación de Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/configuracion.html" class="nav-list-link">2.3 Configuración de Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/artisan.html" class="nav-list-link">2.4 Artisan</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/hola-mundo-con-laravel.html" class="nav-list-link">2.5 Hola mundo</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/enrutamiento.html" class="nav-list-link">2.6 Enrutamiento</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/vistas-blade.html" class="nav-list-link">2.7 Vistas y plantillas con Blade</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/controladores.html" class="nav-list-link">2.8 Controladores</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/migraciones.html" class="nav-list-link">2.9 Migraciones</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/eloquent.html" class="nav-list-link">2.10 Usando la BD con Eloquent</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/querybuilder.html" class="nav-list-link">2.11 Usando la BD con QueryBuilder</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/sesiones.html" class="nav-list-link">2.12 Sesiones con Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/helpers.html" class="nav-list-link">2.13 Helpers de Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/flujo-de-trabajo-con-laravel.html" class="nav-list-link">2.14 Flujo de trabajo típico con Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/aspectos-avanzados.html" class="nav-list-link">2.15 Aspectos avanzados de Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/crud-con-laravel.html" class="nav-list-link">2.16 CRUD desarrollado con Laravel</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/laravel/practicas.html" class="nav-list-link">2.17 Prácticas</a> </li></ul></li><li class="nav-list-item active"><a href="https://iescelia.org/docs/fullstack/_site/api-rest/" class="nav-list-link active">3 Desarrollo de un API REST</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/vue-js/" class="nav-list-link">4 Vue.js</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/inertia/" class="nav-list-link">5 Intertia.js</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/scv-git/" class="nav-list-link">Apéndice 1. Sistemas de control de versiones. Git</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/docker/" class="nav-list-link">Apéndice 2. Virtualización con Docker</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/openstack/" class="nav-list-link">Apéndice 3. Despliegue con Openstack</a></li></ul></li><li class="nav-list-item"><a href="https://iescelia.org/docs/fullstack/_site/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DESARROLLO WEB FULL STACK" aria-label="Search DESARROLLO WEB FULL STACK" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://iescelia.org/docs/fullstack/_site/">Desarrollo web full stack</a></li> <li class="breadcrumb-nav-list-item"><span>3 Desarrollo de un API REST</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="3-desarrollo-de-un-api-rest-con-laravel"> <a href="#3-desarrollo-de-un-api-rest-con-laravel" class="anchor-heading" aria-labelledby="3-desarrollo-de-un-api-rest-con-laravel"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Desarrollo de un API REST con Laravel </h1> <ul id="markdown-toc"> <li><a href="#31-qué-es-un-servicio-web" id="markdown-toc-31-qué-es-un-servicio-web">3.1. ¿Qué es un servicio web?</a> <ul> <li><a href="#311-una-definición-de-servicio-web" id="markdown-toc-311-una-definición-de-servicio-web">3.1.1. Una definición de servicio web</a></li> <li><a href="#312-diferencias-entre-servicios-web-y-aplicaciones-web" id="markdown-toc-312-diferencias-entre-servicios-web-y-aplicaciones-web">3.1.2. Diferencias entre servicios web y aplicaciones web</a></li> </ul> </li> <li><a href="#32-soap" id="markdown-toc-32-soap">3.2. SOAP</a></li> <li><a href="#33-api-rest" id="markdown-toc-33-api-rest">3.3. API REST</a> <ul> <li><a href="#331-qué-es-un-api-rest" id="markdown-toc-331-qué-es-un-api-rest">3.3.1. ¿Qué es un API REST?</a></li> <li><a href="#332-las-7-operaciones-rest" id="markdown-toc-332-las-7-operaciones-rest">3.3.2. Las 7 operaciones REST</a></li> <li><a href="#333-los-verbos-http-get-post-put-patch-y-delete" id="markdown-toc-333-los-verbos-http-get-post-put-patch-y-delete">3.3.3. Los verbos http: GET, POST, PUT, PATCH y DELETE</a></li> <li><a href="#334-el-problema-de-put-patch-y-delete" id="markdown-toc-334-el-problema-de-put-patch-y-delete">3.3.4. El problema de PUT, PATCH y DELETE</a></li> <li><a href="#335-rest-vs-soap" id="markdown-toc-335-rest-vs-soap">3.3.5. REST vs SOAP</a></li> </ul> </li> <li><a href="#34-implementar-un-api-rest-con-laravel" id="markdown-toc-34-implementar-un-api-rest-con-laravel">3.4. Implementar un API REST con Laravel</a> <ul> <li><a href="#341-tips-importantes-antes-de-empezar" id="markdown-toc-341-tips-importantes-antes-de-empezar">3.4.1. Tips importantes antes de empezar…</a></li> <li><a href="#342-un-ejemplo-completo" id="markdown-toc-342-un-ejemplo-completo">3.4.2. Un ejemplo completo</a></li> </ul> </li> <li><a href="#35-consumir-el-servicio-web-con-postman" id="markdown-toc-35-consumir-el-servicio-web-con-postman">3.5. Consumir el servicio web con Postman</a> <ul> <li><a href="#351-qué-es-postman" id="markdown-toc-351-qué-es-postman">3.5.1. Qué es Postman</a></li> <li><a href="#352-instalación-y-puesta-en-marcha-de-postman" id="markdown-toc-352-instalación-y-puesta-en-marcha-de-postman">3.5.2. Instalación y puesta en marcha de Postman</a></li> <li><a href="#353-cómo-probar-nuestro-api-rest" id="markdown-toc-353-cómo-probar-nuestro-api-rest">3.5.3. Cómo probar nuestro API REST</a></li> <li><a href="#354-archivo-de-colección-json" id="markdown-toc-354-archivo-de-colección-json">3.5.4. Archivo de colección .json</a></li> <li><a href="#355-y-qué-más-puede-hacer-postman" id="markdown-toc-355-y-qué-más-puede-hacer-postman">3.5.5. ¿Y qué más puede hacer Postman?</a></li> </ul> </li> <li><a href="#36-práctica-construir-un-api-rest-sobre-la-tierra-media" id="markdown-toc-36-práctica-construir-un-api-rest-sobre-la-tierra-media">3.6. Práctica: construir un API REST sobre la Tierra Media</a> <ul> <li><a href="#paso-1-crear-la-infraestructura" id="markdown-toc-paso-1-crear-la-infraestructura">Paso 1: crear la infraestructura</a></li> <li><a href="#paso-2-escribir-el-api" id="markdown-toc-paso-2-escribir-el-api">Paso 2: escribir el API</a></li> <li><a href="#paso-3-probar-y-consumir-el-api" id="markdown-toc-paso-3-probar-y-consumir-el-api">Paso 3: probar y consumir el API</a></li> </ul> </li> </ul> <p>Los <strong>servicios web</strong> son un tipo particular de aplicación web: una aplicación pensada no solo para ser usada por usuarios humanos, sino también por otras aplicaciones informáticas.</p> <p>Por esa razón, un servicio web puede que no genere HTML (vistas), sino datos, normalmente codificados como XML o JSON, que serán consumidos por otras aplicaciones informáticas.</p> <p>Hay varios estándares de facto para crear servicios web. El más extendido es <strong>REST</strong>, que es el que vamos a estudiar, pero hay otros como <strong>GraphQL</strong> (en rápido crecimiento, sobre todo en aplicaciones ricas en datos), <strong>gRPC</strong> (muy usado para microservicios con necesidades alto rendimiento) o <strong>SOAP</strong> (más antiguo pero muy común en grandes empresas y organismos como banca, seguros o gobiernos).</p> <p>Nosotros nos centraremos en REST. Una aplicación web que ofrezca en el servidor un interfaz que implemente este estándar se suele denominar <strong>API REST</strong>. En este tema, vamos a aprender a construir una aplicación API REST usando Laravel.</p> <h2 id="31-qué-es-un-servicio-web"> <a href="#31-qué-es-un-servicio-web" class="anchor-heading" aria-labelledby="31-qué-es-un-servicio-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1. ¿Qué es un servicio web? </h2> <h3 id="311-una-definición-de-servicio-web"> <a href="#311-una-definición-de-servicio-web" class="anchor-heading" aria-labelledby="311-una-definición-de-servicio-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1.1. Una definición de servicio web </h3> <p>Un <strong>servicio web</strong> es una aplicación web capaz de <strong>comunicarse e intercambiar información con otra aplicación</strong> (que denominaremos <em>cliente</em>) independientemente de la plataforma en la que cada una se ejecute.</p> <p>Es decir, el servicio web puede estar programado en PHP y correr bajo un sistema operativo GNU/Linux y el cliente puede estar programado con C# y correr bajo un Windows, y deberían ser capaces de comunicarse y trabajar juntas. Pero es importante que quede claro que, en este caso, la aplicación web (servidor) y la aplicación cliente <em>son dos aplicaciones diferentes</em>.</p> <p>Los mensajes que las aplicaciones se intercambian generalmente tienen formato <strong>JSON</strong> o <strong>XML</strong>.</p> <p>Existen dos estándares principales en la industria para implementar servicios web, denominados <strong>SOAP</strong> y <strong>REST</strong>, aunque hay otros en rápido crecimiento como <strong>GraphQL</strong> o <strong>gRPC</strong>. A lo largo el tema, vamos a aprender cómo funcionan los dos primeros.</p> <h3 id="312-diferencias-entre-servicios-web-y-aplicaciones-web"> <a href="#312-diferencias-entre-servicios-web-y-aplicaciones-web" class="anchor-heading" aria-labelledby="312-diferencias-entre-servicios-web-y-aplicaciones-web"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1.2. Diferencias entre servicios web y aplicaciones web </h3> <p>Llegados a este punto, puede que estés pensando: “Vale, pero ¿en qué se diferencia un servicio web de una aplicación web MVC? ¿En una aplicación web no intercambian también el cliente y el servidor información independientemente de la plataforma en la que se ejecuta cada uno?”.</p> <p>Pues sí, pero hay algunas <strong>diferencias entre un <em>servicio web</em> y una <em>aplicación web</em></strong>:</p> <ul> <li><strong>Una aplicación web</strong> está diseñada exclusivamente para que un ser humano interactúe con ella a través de un interfaz HTML.</li> <li><strong>Un servicio web</strong>, en cambio, está pensado para que lo pueda usar otra aplicación informática (el cliente), no necesariamente un ser humano.</li> </ul> <p>Por ese motivo, los servicios web pueden carecer de interfaz de usuario y no producir salidas HTML legibles. Un servicio web puro, de hecho, <strong>no suele tener vistas</strong>, solo salidas XML o JSON pensadas para que los clientes las procesen.</p> <p>Por lo demás, un servicio web puede tener una arquitectura <em>aproximadamente</em> MVC, y digo <em>aproximadamente</em> porque el servicio web, como acabo de contarte, puede carecer de vistas (aunque podría tenerlas). Pero seguirá conservando sus controladores y sus modelos. Los controladores se encargarán de convertir los datos de los modelos a JSON o XML y devolverlos al cliente, sin necesidad de crear vistas.</p> <h2 id="32-soap"> <a href="#32-soap" class="anchor-heading" aria-labelledby="32-soap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2. SOAP </h2> <p><strong>SOAP (Single Object Access Protocol)</strong> es un mecanismo estandarizado para la implementación, descripción y publicación de servicios en red.</p> <p>SOAP establece el modo en el que deben comportarse el cliente y el servidor para hablar entre sí, así como la forma en la que el servidor debe dar a conocer sus servicios.</p> <p>El estándar SOAP fue durante mucho tiempo la forma “oficial” y más extendida de construir servicios web de tipo empresarial, sobre todo en entornos donde la robustez, la estandarización y la compatibilidad con herramientas de integración eran cruciales (por ejemplo, banca, seguros, telecomunicaciones). En la actualidad, sin embargo, pocos servicios se montan como SOAP, y se prefieren casi siempre alternativas más modernas como REST, GraphQL o gRPC.</p> <p>Sin embargo, SOAP no está muerto ni mucho menos: todavía se usa ampliamente en sectores muy regulados y en sistemas antiguos (por ejemplo, servicios de facturación electrónica o sistemas de información gubernamentales).</p> <p><strong>La pila de protocolos de SOAP</strong></p> <p>El estándar <strong>SOAP</strong> define una serie de protocolos de niveles de abstracción crecientes. Esta colección de protocolos suele denominarse <strong>pila de protocolos SOAP</strong>, y son los siguientes:</p> <div class="table-wrapper"><table> <thead> <tr> <th>Nivel de abstracción</th> <th>Protocolo</th> </tr> </thead> <tbody> <tr> <td>Nivel de descubrimiento</td> <td>UDDI</td> </tr> </tbody> <tbody> <tr> <td>Nivel de publicación</td> <td>UDDI</td> </tr> </tbody> <tbody> <tr> <td>Nivel de descripción</td> <td>WSDL</td> </tr> </tbody> <tbody> <tr> <td>Nivel de mensajería</td> <td>SOAP</td> </tr> </tbody> <tbody> <tr> <td>Nivel de red</td> <td>TCP, SMTP, FTP, etc</td> </tr> </tbody> </table></div> <p>Como ves, SOAP solo es uno de los protocolos de la pila, aunque todo el tinglado recibe el nombre “SOAP” por extensión.</p> <div style="background-color: #ddd"><i>En este curso no vamos a ver cómo trabajar con SOAP, sino que simplemente lo mencionamos por su importancia histórica. En su lugar, nos vamos a centrar en el estándar más extendido en la actualidad entre servidores: REST.</i></div> <h2 id="33-api-rest"> <a href="#33-api-rest" class="anchor-heading" aria-labelledby="33-api-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3. API REST </h2> <h3 id="331-qué-es-un-api-rest"> <a href="#331-qué-es-un-api-rest" class="anchor-heading" aria-labelledby="331-qué-es-un-api-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.1. ¿Qué es un API REST? </h3> <p><strong>REST (Representational State Transfer)</strong> es una arquitectura web para intercambiar información entre clientes y servidores de una red; es decir, es una arquitectura para diseñar servicios web.</p> <p>Los términos <strong>REST</strong>, <strong>API REST</strong> y <strong>RESTful</strong> son casi como sinónimos, pero tienen sutiles diferencias:</p> <ul> <li><strong>REST</strong> es una <em>arquitectura</em> para diseñar servicios web.</li> <li><strong>API REST</strong> es un <em>interfaz de programación (API)</em> que sigue los principios REST. Es decir, es un servicio web que ofrece a los clientes una forma de interactuar acorde a la arquitectura REST.</li> <li><strong>RESTful</strong> se refiere a una API que respeta escrupulosamente los principios de diseño REST. Algunas API REST son RESTful, pero otras introducen pequeñas variaciones sobre el estándar REST. Solo las que siguen al 100% los principios de diseño REST son RESTful.</li> </ul> <p>A diferencia de SOAP, <strong>REST está orientado a los datos</strong>, esto es, proporciona siempre los mismos tipos de acceso a los recursos, sin posibilidad de definir nuevas operaciones.</p> <p>Suele decirse, por esa razón, que <em>REST está orientado a los datos</em> mientras que <em>SOAP está orientado a los procesos</em>.</p> <p>Actualmente, gran parte de las APIs, ya sean públicas o privadas, se programan según el diseño REST para que los programadores que las usen sepan qué esperar de la API sin necesidad de consultar farragosas páginas de documentación o de pelearse con el servidor mediante el infalible método de ensayo y error.</p> <h3 id="332-las-7-operaciones-rest"> <a href="#332-las-7-operaciones-rest" class="anchor-heading" aria-labelledby="332-las-7-operaciones-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.2. Las 7 operaciones REST </h3> <p>Un servidor REST debe implementar <strong>siete operaciones de acceso a cada tipo de recurso</strong>.</p> <p>Si no las implementa, ya no es REST. Podrá ser <em>aproximadamente</em> REST, pero no REST.</p> <p>Los nombres de las operaciones, los datos que se esperan que se devuelvan y el verbo http de acceso deben respetarse escrupulosamente.</p> <p>Imagina que estamos programando un servidor REST para acceder, por ejemplo, a un recurso llamado <em>Producto</em> dentro de una aplicación más grande (por ejemplo, una tienda online). En la siguiente tabla tienes las siete operaciones que un servidor REST puede realizar con ese recurso, es decir, con los productos de la base de datos. También te indico qué significa cada operación y un ejemplo típico de la URL que permitirá el acceso a través de https.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Operación</th> <th>Significado</th> <th>Verbo</th> <th>URL típica</th> </tr> </thead> <tbody> <tr> <td>index</td> <td>Mostrar todos los productos</td> <td>GET</td> <td>https://servidor/producto/</td> </tr> <tr> <td>show</td> <td>Mostrar un producto</td> <td>GET</td> <td>https://servidor/producto/id</td> </tr> <tr> <td>create</td> <td>Mostrar formulario de creación de un producto</td> <td>GET</td> <td>https://servidor/producto/create</td> </tr> <tr> <td>store</td> <td>Crear un producto con los datos procedentes de un formulario</td> <td>POST</td> <td>https://servidor/producto/store</td> </tr> <tr> <td>edit</td> <td>Mostrar el formulario de edición de un producto</td> <td>GET</td> <td>https://servidor/producto/edit/id</td> </tr> <tr> <td>update</td> <td>Actualizar el producto con los datos procedentes del formulario</td> <td>PUT o PATCH</td> <td>https://servidor/producto/update/id</td> </tr> <tr> <td>destroy</td> <td>Eliminar un producto</td> <td>DELETE</td> <td>https://servidor/producto/destroy/id</td> </tr> </tbody> </table></div> <p>Hay una excepción a esta regla: las operaciones <em>create</em> y <em>edit</em> podrían no estar disponibles en algunas APIs REST, cuando estas estén diseñadas para que las usen otras aplicaciones y no seres humanos.</p> <p>Soy consciente de que esta tabla necesita algunas explicaciones adicionales, así que vamos a ello.</p> <p>En primer lugar, ¿qué es eso de los <em>verbos</em> que figura en cada petición?</p> <h3 id="333-los-verbos-http-get-post-put-patch-y-delete"> <a href="#333-los-verbos-http-get-post-put-patch-y-delete" class="anchor-heading" aria-labelledby="333-los-verbos-http-get-post-put-patch-y-delete"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.3. Los verbos http: GET, POST, PUT, PATCH y DELETE </h3> <p>El protocolo http define dos tipos de petición al servidor, GET y POST. El estándar REST aumenta estos tipos en otros tres: PUT, PATCH y DELETE.</p> <p>Veamos qué significa exactamente cada uno:</p> <ul> <li><strong>GET</strong> se utiliza para <em>solicitar</em> datos al servidor. Por ejemplo: “Dame toda la información de un producto”.</li> <li><strong>POST</strong> se utiliza para <em>enviar</em> datos al servidor. Por ejemplo: “Aquí tienes toda la información de un producto; anda, almacénalo en tu base de datos”.</li> <li> <p><strong>PUT/PATCH</strong> se utiliza para solicitar al servidor la modificación de datos que ya existen. Por ejemplo: “Este es el nuevo precio de un producto que ya estaba en tu base de datos. Tómalo y actualízalo”.</p> <p>Si se van a actualizar <em>todos</em> los datos de un producto, se utiliza <em>PUT</em>. Si se va a actualizar solo <em>una parte</em> de los datos de un producto, se utiliza <em>PATCH</em>.</p> </li> <li><strong>DELETE</strong> se usa para solicitar la eliminación de datos en el servidor. Por ejemplo: “Elimina este producto”.</li> </ul> <p>Por ese motivo, en algunas URLs de la tabla anterior enviamos un id como parte de la ruta. Ese id indicará al servidor qué producto le estamos pidiendo que nos busque, modifique o elimine.</p> <p>Una moraleja tal vez imprevista de esta tabla es que nunca deberías enviar datos al servidor mediante GET, puesto que GET solo tendría que usarse para <em>obtener</em> datos del servidor.</p> <p>Otra moraleja es que el propio verbo de la petición http ya contiene información sobre lo que se le está pidiendo hacer al servidor. De hecho, en un servidor REST, contiene información fundamental. Por eso es tan importante respetar las convenciones.</p> <p>Si ya has trabajado con HTML antes, seguro que conocías el significado de GET y POST, pero probablemente nunca habías oído hablar de PUT, PATCH y DELETE, ¿verdad?</p> <h3 id="334-el-problema-de-put-patch-y-delete"> <a href="#334-el-problema-de-put-patch-y-delete" class="anchor-heading" aria-labelledby="334-el-problema-de-put-patch-y-delete"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.4. El problema de PUT, PATCH y DELETE </h3> <p>Cuando solicitamos una URL a un servidor sin indicar otra cosa, el protocolo http/https asumirá que se trata de una petición GET.</p> <p>Si en un formulario indicamos que el método de envío de los datos al servidor es POST, los datos que el usuario rellene en ese formulario se enviarán al servidor mediante POST, como parte del paquete http, en una zona especialmente dedicada a empaquetarlos:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'http://servidor/lo-que-sea'</span> <span class="na">method=</span><span class="s">'POST'</span><span class="nt">&gt;</span>
...cuerpo del formulario
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div> <p>Pero <strong>con HTML5 <em>no hay manera de hacer una petición al servidor por PUT, por PATACH o por DELETE</em></strong>.</p> <p>Esto se debe a que la implementación actual de http no contempla los verbos PUT, PATCH ni DELETE. Sin embargo, <strong>en el estándar REST estos verbos son fundamentales</strong>.</p> <p>Como a nosotros nos interesa construir servidores REST con acceso por http, es decir, vía web, aquí tenemos un grave problema.</p> <p>Mientras llega una nueva implementación de http y/o de HTML, <strong>este problema tiene dos soluciones temporales</strong>:</p> <ul> <li>Sustituir las llamadas con PUT, PATCH o DELETE por llamadas POST convencionales. Esto hará que, en la práctica, nuestro servidor deje de ser REST, claro.</li> <li>Parchear las llamadas con PUT, PATCH o DELETE mediante un campo oculto (de tipo <em>hidden</em>) en el formulario. Esta es la forma en la que se realizan las implementaciones REST vía web en la actualidad. Tienes un ejemplo en este formulario:</li> </ul> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'http://servidor/lo-que-sea'</span> <span class="na">method=</span><span class="s">'POST'</span><span class="nt">&gt;</span>
   <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'hidden'</span> <span class="na">name=</span><span class="s">'_method'</span> <span class="na">value=</span><span class="s">'PUT'</span><span class="nt">&gt;</span>
   ...cuerpo del formulario...
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div> <p>Tal vez recuerdes que esto es exactamente lo que hace Laravel para implementar llamadas mediante PUT, PATCH o DELETE. ¿Qué dices? ¿Que no te acuerdas? Entonces quizá sea el momento de que retrocedas y repases un poco el enrutador de Laravel.</p> <h3 id="335-rest-vs-soap"> <a href="#335-rest-vs-soap" class="anchor-heading" aria-labelledby="335-rest-vs-soap"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3.5. REST vs SOAP </h3> <p>Ya sabemos en qué consisten las dos grandes arquitecturas para construir servicios web. Ahora, la pregunta del millón: ¿cuál es mejor de las dos?</p> <p><strong>SOAP es más flexible que REST</strong>: permite definir nuevas operaciones sobre los recursos, mientras que REST está limitado a las 7 operaciones predefinidas.</p> <p><strong>REST es mucho más sencillo de usar e implementar que SOAP</strong>: las operaciones son bien conocidas y no es necesario describirlas (WSDL) ni publicarlas de ningún modo. Para usar un servidor REST, no hay que estudiarse ninguna API ni pelearse con estructuras de datos desconocidas.</p> <p>Por todo ello, para la mayor parte de las aplicaciones REST es más que suficiente, y de ahí su mayor implantación en la actualidad.</p> <h2 id="34-implementar-un-api-rest-con-laravel"> <a href="#34-implementar-un-api-rest-con-laravel" class="anchor-heading" aria-labelledby="34-implementar-un-api-rest-con-laravel"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4. Implementar un API REST con Laravel </h2> <h3 id="341-tips-importantes-antes-de-empezar"> <a href="#341-tips-importantes-antes-de-empezar" class="anchor-heading" aria-labelledby="341-tips-importantes-antes-de-empezar"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4.1. Tips importantes antes de empezar… </h3> <p>Antes de lanzarte a implementar un API REST en Laravel, lee esta sección, por favor.</p> <p>Para implementar un API REST con Laravel debes:</p> <ol> <li> <p><strong>Instalar el complemento para APIs de Laravel</strong>. Esto solo es necesario a partir de Laravel 12 (en versiones anteriores ya venía “de serie”):</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>php artisan <span class="nb">install</span>:api
</code></pre></div> </div> </li> <li> <p><strong>Crear la infraestructura de la base de datos</strong>, como en cualquier aplicación web. La base de datos son los cimientos, así que tendrás que empezar por crear tus migraciones y, opcionalmente, tus <em>seeders</em>.</p> </li> <li> <p><strong>Crear una arquitectura MVC para los recursos/datos que tengas que servir.</strong></p> <p>Con Laravel, esto se consigue con uno de estos comandos:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php artisan make:controller <span class="nt">--resource</span> &lt;nombre-controlador&gt;
<span class="nv">$ </span>php artisan make:controller <span class="nt">--api</span> &lt;nombre-controlador&gt;
</code></pre></div> </div> <ul> <li> <p><strong>resource</strong> creará las 7 rutas REST y los 7 métodos del controlador correspondiente. Está pensado para construir una API RESTful con la que puede interactuar cualquiera, tanto usuarios humanos como otras aplicaciones.</p> </li> <li> <p><strong>api</strong> creará solo 5 de las 7 rutas REST, junto con los 5 métodos del controlador. Está pensado para construir una API REST con la que interactuarán otras aplicaciones, pero no humanos, por lo que no ofrece las operaciones <em>create</em> ni <em>edit</em>, que muestran formularios.</p> </li> </ul> </li> <li> <p><strong>Devolver al cliente los datos formateados como JSON</strong> en lugar de mostrarlos en una vista HTML. Puede usarse también XML, pero JSON es más habitual.</p> <p>Con Laravel, en lugar de hacer <code class="language-plaintext highlighter-rouge">return view()</code> al final de cada método del controlador, usaremos <code class="language-plaintext highlighter-rouge">return response()-&gt;json(&lt;datos&gt;)</code>. Laravel se encargará de enviar ese valor devuelto al cliente.</p> </li> <li> <p><strong>Respetar los nombres de los verbos y de las peticiones HTTP</strong>, puesto que serán los que el cliente utilice. Recuerda que en una API RESTful estos son:</p> <ul> <li> <p>Verbos: <em>GET, POST, PUT, PATCH, DELETE</em>.</p> </li> <li> <p>Peticiones: <em>index (GET), show (GET), create (GET), store (POST), edit (GET), update (PUT/PATCH), destroy (DELETE)</em>.</p> </li> </ul> </li> </ol> <h3 id="342-un-ejemplo-completo"> <a href="#342-un-ejemplo-completo" class="anchor-heading" aria-labelledby="342-un-ejemplo-completo"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4.2. Un ejemplo completo </h3> <p><a href="https://github.com/avozme/compras">(Haz clic aquí para acceder al código fuente completo de este ejemplo)</a></p> <p>Ya estamos en condiciones de construir nuestro primer API REST con Laravel. En este ejemplo, serviremos los siguientes datos:</p> <ul> <li><strong>Productos</strong>: los productos de una tienda online ficticia que constarán de id, nombre del producto, descripción, precio y unidades en stock.</li> <li><strong>Clientes</strong>: los clientes de la tienda online (id, nombre, apellido1, apellido2, domicilio y email).</li> <li><strong>Compran</strong>: la relación N:N entre Productos y Clientes. Añadirá los campos fecha, hora y número de unidades compradas.</li> </ul> <h4 id="migraciones"> <a href="#migraciones" class="anchor-heading" aria-labelledby="migraciones"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Migraciones </h4> <p>Lo primero es crear las migraciones con <code class="language-plaintext highlighter-rouge">php artisan make:migration nombre_migracion.php</code>. Aquí te ofrezco un ejemplo de cómo podrían quedar:</p> <p><strong>Migración de Productos:</strong> <em>database/migrations/&lt;timestamp&gt;_create_productos_table.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'productos'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'nombre'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'descripcion'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">decimal</span><span class="p">(</span><span class="s1">'precio'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">integer</span><span class="p">(</span><span class="s1">'stock'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'productos'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de Clientes:</strong> <em>database/migrations/&lt;timestamp&gt;_create_clientes_table.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'clientes'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'nombre'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'apellido1'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'apellido2'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'domicilio'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'email'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">unique</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'clientes'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de Compras</strong> (pivote con atributos): <em>database/migrations/&lt;timestamp&gt;_create_compras_table.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'compras'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'producto_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'cascade'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'cliente_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'cascade'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nb">date</span><span class="p">(</span><span class="s1">'fecha'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nb">time</span><span class="p">(</span><span class="s1">'hora'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">integer</span><span class="p">(</span><span class="s1">'unidades'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'compras'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="modelos"> <a href="#modelos" class="anchor-heading" aria-labelledby="modelos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Modelos </h4> <p>Lo siguiente sería crear los modelos con <code class="language-plaintext highlighter-rouge">php artisan make:model NombreModelo</code>. Aquí te muestro cómo podrían quedar para que reflejasen las relaciones entre las tablas mediante Eloquent.</p> <p><strong>Modelo de Producto:</strong> <em>app/Models/Producto.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Producto</span> <span class="kd">extends</span> <span class="nc">Model</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'nombre'</span><span class="p">,</span> <span class="s1">'descripcion'</span><span class="p">,</span> <span class="s1">'precio'</span><span class="p">,</span> <span class="s1">'stock'</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">clientes</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsToMany</span><span class="p">(</span><span class="nc">Cliente</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'compras'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">withPivot</span><span class="p">(</span><span class="s1">'fecha'</span><span class="p">,</span> <span class="s1">'hora'</span><span class="p">,</span> <span class="s1">'unidades'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">withTimestamps</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Modelo de Cliente:</strong> <em>app/Models/Cliente.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Cliente</span> <span class="kd">extends</span> <span class="nc">Model</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'nombre'</span><span class="p">,</span> <span class="s1">'apellido1'</span><span class="p">,</span> <span class="s1">'apellido2'</span><span class="p">,</span> <span class="s1">'domicilio'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">productos</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsToMany</span><span class="p">(</span><span class="nc">Producto</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'compras'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">withPivot</span><span class="p">(</span><span class="s1">'fecha'</span><span class="p">,</span> <span class="s1">'hora'</span><span class="p">,</span> <span class="s1">'unidades'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">withTimestamps</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Modelo de Compra</strong> (pivote): <em>app/Models/Compra.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Compra</span> <span class="kd">extends</span> <span class="nc">Model</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'producto_id'</span><span class="p">,</span> <span class="s1">'cliente_id'</span><span class="p">,</span> <span class="s1">'fecha'</span><span class="p">,</span> <span class="s1">'hora'</span><span class="p">,</span> <span class="s1">'unidades'</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">producto</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsTo</span><span class="p">(</span><span class="nc">Producto</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">cliente</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsTo</span><span class="p">(</span><span class="nc">Cliente</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="controladores-restful"> <a href="#controladores-restful" class="anchor-heading" aria-labelledby="controladores-restful"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Controladores RESTful </h4> <p>El siguiente paso es crear los controladores. Los generaremos con estos comandos:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php artisan make:controller ProductoController <span class="nt">--api</span>
<span class="nv">$ </span>php artisan make:controller ClienteController <span class="nt">--api</span>
<span class="nv">$ </span>php artisan make:controller CompraController <span class="nt">--api</span>
</code></pre></div></div> <p>Recuerda que usamos la opción <strong><em>api</em></strong> en lugar de <strong><em>resource</em></strong> para que nos genere 5 métodos REST, no los 7 RESTful, puesto que no necesitaremos los formularios de creación ni de edición (se trata de una API para que la usen otras aplicaciones, no un usuario humano).</p> <p>Por ejemplo, así quedaría el <strong>controlador de Productos:</strong> <em>app/Http/Controllers/ProductoController.php</em></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Models\Producto</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Http\Request</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ProductoController</span> <span class="kd">extends</span> <span class="nc">Controller</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">index</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">(</span><span class="nc">Producto</span><span class="o">::</span><span class="nf">all</span><span class="p">(),</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$producto</span> <span class="o">=</span> <span class="nc">Producto</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">(</span><span class="nv">$producto</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">(</span><span class="nc">Producto</span><span class="o">::</span><span class="nf">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">),</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">update</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$producto</span> <span class="o">=</span> <span class="nc">Producto</span><span class="o">::</span><span class="nf">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="nv">$producto</span><span class="o">-&gt;</span><span class="nf">update</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">(</span><span class="nv">$producto</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Producto</span><span class="o">::</span><span class="nf">destroy</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">204</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Los controladores de clientes (<em>ClienteController</em>) y compras (<em>CompraController</em>) serán parecidos, es decir, un CRUD que devuelve los datos en formato JSON. Como hemos construido las relaciones entre los modelos con Eloquent, no es necesario hacer nada más: Laravel se encargará de buscar todos los datos relacionados entre sí con su “magia” interna.</p> <h4 id="enrutador-rutas-api"> <a href="#enrutador-rutas-api" class="anchor-heading" aria-labelledby="enrutador-rutas-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enrutador (Rutas API) </h4> <p>Como estamos construyendo una API pura, editaremos el enrutador <strong><em>routes/api.php</em></strong> en lugar de <em>routes/web.php</em>.</p> <div style="background-color: #ddd"><strong>¡¡OJO!!</strong> Si trabajas con Laravel 12 o posterior, el archivo *routes/api.php* no existirá. Debes instalar primero el soporte para APIs de Laravel con el comando <i>$ php artisan install:api</i></div> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\ProductoController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\ClienteController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\CompraController</span><span class="p">;</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">apiResource</span><span class="p">(</span><span class="s1">'productos'</span><span class="p">,</span> <span class="nc">ProductoController</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">apiResource</span><span class="p">(</span><span class="s1">'clientes'</span><span class="p">,</span> <span class="nc">ClienteController</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">apiResource</span><span class="p">(</span><span class="s1">'compras'</span><span class="p">,</span> <span class="nc">CompraController</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>
</code></pre></div></div> <p>El enrutador <em>routes/api.php</em> usa el <strong><em>middleware api</em></strong>, que no maneja sesiones, cookies (es decir, que no tiene estado), ni ofrece protección contra el CSRF, por lo que solo se usa cuando no hay interacción directa entre el servidor y un usuario humano. Es decir, solo se usa en APIs puras.</p> <p>El enrutador <em>routes/web.php</em> usa el <strong><em>middleware web</em></strong>, que sí controla el estado (sesiones y cookies) y ofrece protección contra CSRF. Si estás construyendo un API RESTful, que sí puede usarse por un usuario humano (con los métodos <em>create</em> y <em>edit</em>), es mejor enrutar de este modo.</p> <h4 id="ejemplo-de-llamadas-rest"> <a href="#ejemplo-de-llamadas-rest" class="anchor-heading" aria-labelledby="ejemplo-de-llamadas-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejemplo de llamadas REST </h4> <p>Laravel está configurado para <strong>usar el enrutador <em>api.php</em></strong> en lugar de <em>web.php</em> en todas las rutas que empiecen por /api (este comportamiento se puede cambiar, pero no hay necesidad de hacerlo en este ejemplo).</p> <p>Nuestra API, por tanto, responderá con JSON a cualquier solicitud HTTP con el prefijo /api. Por ejemplo:</p> <ul> <li> <p><strong>GET http://servidor/api/productos/1</strong> → solicita los datos del producto con id 1. Recibirá como respuesta un JSON con este aspecto:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"nombre"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Teclado"</span><span class="p">,</span><span class="w"> </span><span class="nl">"descripcion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mecánico"</span><span class="p">,</span><span class="w"> </span><span class="nl">"precio"</span><span class="p">:</span><span class="w"> </span><span class="mf">29.99</span><span class="p">,</span><span class="w"> </span><span class="nl">"stock"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </li> <li> <p><strong>POST http://servidor/api/productos</strong> → en este caso, el servidor esperará recibir en el cuerpo de la petición HTTP los datos del producto que tiene que almacenar.</p> <p>El servidor desempaquetará esos datos y los guardará en la base de datos; y, si todo va bien, responderá con un JSON con los datos del producto que acaba de almacenar (parecido al JSON del ejemplo anterior)</p> <p>En caso de error al insertar el producto, nuestra aplicación no tiene un comportamiento definido, así que devolverá un JSON con el código y el mensaje del error. Se puede mejorar el controlador para que devuelva otra información en caso de que suceda un error.</p> </li> </ul> <h2 id="35-consumir-el-servicio-web-con-postman"> <a href="#35-consumir-el-servicio-web-con-postman" class="anchor-heading" aria-labelledby="35-consumir-el-servicio-web-con-postman"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5. Consumir el servicio web con Postman </h2> <h3 id="351-qué-es-postman"> <a href="#351-qué-es-postman" class="anchor-heading" aria-labelledby="351-qué-es-postman"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.1. Qué es Postman </h3> <p>Postman es una herramienta cliente para APIs muy popular que permite a desarrolladores <strong>probar, documentar y automatizar peticiones a servicios web</strong>. Es gratuita con opciones de pago.</p> <p>Postman se usa para todas estas cosas:</p> <ul> <li><strong>Enviar peticiones HTTP</strong> (GET, POST, PUT, PATCH, DELETE, etc.) hacia tu API y visualizar la respuesta.</li> <li><strong>Configurar headers y parámetros</strong>. Por ejemplo, “Content-Type: application/json”, tokens de autenticación, etc.</li> <li><strong>Enviar cuerpos de petición en JSON</strong> para probar <em>endpoints</em>, es decir, URLs que esperan recibir datos en JSON para funcionar.</li> <li><strong>Visualizar las respuestas del servidor</strong> en formato JSON, XML, texto, etc., junto con el código de estado HTTP.</li> <li><strong>Guardar colecciones de pruebas para reutilizarlas</strong> o compartirlas con tu equipo (muy útil cuando varios desarrolladores trabajan con la misma API).</li> <li><strong>Automatizar pruebas</strong>: puedes escribir scripts en JavaScript dentro de Postman para verificar automáticamente que las respuestas cumplen con lo esperado.</li> <li><strong>Generar documentación</strong> de tu API a partir de las colecciones.</li> </ul> <h3 id="352-instalación-y-puesta-en-marcha-de-postman"> <a href="#352-instalación-y-puesta-en-marcha-de-postman" class="anchor-heading" aria-labelledby="352-instalación-y-puesta-en-marcha-de-postman"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.2. Instalación y puesta en marcha de Postman </h3> <p><strong>Opción 1: Instalar Postman como app de escritorio</strong> (<strong><em>RECOMENDADO</em></strong>)</p> <ul> <li>Visita la web <a href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a>. Si usas Linux, puedes buscar antes en los repositorios oficiales de tu distribución, porque podría incluir Postman.</li> <li>Descarga e instala la versión más adecuada para tu sistema operativo.</li> <li>Inicia sesión (puedes usar Google o GitHub).</li> </ul> <p><strong>Opción 2: Usar Postman en la nube</strong></p> <ul> <li>Accede a: <a href="https://web.postman.com/">https://web.postman.com/</a></li> <li>Inicia sesión y comienza a trabajar directamente en la nube.</li> </ul> <p><strong>Ignorando el asistente de IA</strong></p> <p>En las nuevas versiones de Postman aparece por defecto un <strong>asistente de IA</strong> al lanzar la aplicación. <em>Vamos a ignorar ese asistente para aprender a usar Postman nosotros, no una IA, que para eso estamos aquí</em>.</p> <p>Para ello, puedes escribir algo como “Quiero ir al interfaz clásico de Postman” en el cuadro de diálogo de la IA, o elegir la opción <em>File -&gt; New Postman Window</em>.</p> <p>Entonces obtendrás una pantalla como esta:</p> <p><img src="../assets/images/postman-new-window.jpg" alt="Postman - Nueva ventana" /></p> <h3 id="353-cómo-probar-nuestro-api-rest"> <a href="#353-cómo-probar-nuestro-api-rest" class="anchor-heading" aria-labelledby="353-cómo-probar-nuestro-api-rest"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.3. Cómo probar nuestro API REST </h3> <p>Vamos a ilustrar cómo funciona Postman con un <strong>ejemplo práctico</strong>: configurándolo para probar nuestro API REST de clientes, productos y compras que hemos implementado un poco más arriba.</p> <h4 id="configura-una-colección-en-postman"> <a href="#configura-una-colección-en-postman" class="anchor-heading" aria-labelledby="configura-una-colección-en-postman"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configura una colección en Postman </h4> <p><strong>Una colección es una serie de <em>request</em> o peticiones al servidor agrupados</strong> bajo el mismo nombre. Son como carpetas donde organizar peticiones para poder reutilizarlas más tarde, algo habitual si estás en fase de desarrollo de una API.</p> <p>La colección que nosotros vamos a crear nos permitirá lanzar todas las peticiones para trabajar con Productos, Clientes y Compras.</p> <p>En Postman puedes crear una colección llamada, por ejemplo, <strong>Tienda API</strong>, o bien puedes usar la colección que viene creada por defecto, <strong>MyCollection</strong>.</p> <p><strong>Todo ello se hace en el panel izquierdo de Postman</strong>.</p> <p><img src="../assets/images/postman-crear-coleccion.jpg" alt="Postman - Crear colección" /></p> <h4 id="requests-get"> <a href="#requests-get" class="anchor-heading" aria-labelledby="requests-get"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requests GET </h4> <p>Veamos como hacer un GET con Postman para comprobar si el API responde con los datos correctos.</p> <p>Cada request tendrá la URL base de tu API. En todos los ejemplos vamos a suponer que es <em>https://servidor/api</em>, pero, lógicamente, tendrás que cambiarla por la tuya.</p> <p>Pues bien: para hacer un <strong>GET /productos</strong> y guardar el request en nuestra colección solo tenemos que:</p> <ol> <li>Hacer clic en los tres puntos junto al nombre de la colección y pulsar en <em>“Add request”</em>.</li> <li>Escribir el <em>endpoint</em> o ruta <strong><em>https://servidor/api/productos</em></strong> en el cuadro de búsqueda.</li> <li>Asegurarnos de tener seleccionado el <strong>verbo GET</strong>.</li> <li>Pulsar el <strong>botón “Send”</strong>.</li> </ol> <p>El servidor nos debería devolver todos los productos empaquetados en un JSON:</p> <p><img src="../assets/images/postman-request-get.jpg" alt="Postman - Request GET" /></p> <h4 id="requests-post-con-datos"> <a href="#requests-post-con-datos" class="anchor-heading" aria-labelledby="requests-post-con-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requests POST con datos </h4> <p>Si hacemos una petición como <strong>POST /productos</strong>, el estándar REST indica que estamos tratando de enviar los datos de un producto al servidor para que este lo almacene en la base de datos.</p> <p>Por lo tanto, esta petición debe llevar los datos del producto empaquetados como JSON en el cuerpo (<em>body</em>) de la propia petición HTTP.</p> <p>Esto se logra así en Postman:</p> <ol> <li><strong>Crear una nueva <em>request</em></strong> en tu colección (haz clic en los 3 puntos junto al nombre de la colección y elige <em>“Add request”</em>).</li> <li><strong>Escribir el <em>endpoint</em></strong> o ruta <strong><em>https://servidor/api/productos</em></strong> en el cuadro de búsqueda.</li> <li>Asegurarnos de tener seleccionado el <strong>verbo POST</strong>.</li> <li>En el panel de la <em>request</em>, seleccionar la <strong>pestaña “Body”</strong>.</li> <li><strong>Seleccionar “raw” y “JSON”</strong> en los desplegables, pues vamos a enviar los datos como JSON en texto plano (raw).</li> <li> <p><strong>Escribir el objeto JSON</strong> que deseamos enviar al servidor. Por ejemplo:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"nombre"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ratón inalámbrico"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"descripcion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mouse óptico con USB"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"precio"</span><span class="p">:</span><span class="w"> </span><span class="mf">25.90</span><span class="p">,</span><span class="w">
   </span><span class="nl">"stock"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> </li> <li>Pulsar el <strong>botón “Send”</strong>.</li> </ol> <p>El servidor responderá con un estado 200 (si todo va bien) o con un error (estados 401, 403, 404, 500 o cualquier otro). Además, puede enviarnos datos adicionales, como el id del recurso que acaba de crear o incluso un JSON con todos los datos del recurso que acaba de crear, como ocurre en el siguiente pantallazo:</p> <p><img src="../assets/images/postman-request-post.jpg" alt="Postman - Request POST" /></p> <h4 id="requests-put-patch-o-delete"> <a href="#requests-put-patch-o-delete" class="anchor-heading" aria-labelledby="requests-put-patch-o-delete"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requests PUT, PATCH o DELETE </h4> <p>Del mismo modo que con POST podemos enviar <em>requests</em> con los verbos PUT, PATCH o DELETE, puesto que en el selector del método de envío encontraremos todos esos verbos.</p> <h3 id="354-archivo-de-colección-json"> <a href="#354-archivo-de-colección-json" class="anchor-heading" aria-labelledby="354-archivo-de-colección-json"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.4. Archivo de colección .json </h3> <p>Probablemente una de las formas más útiles de usar Postman como <strong>herramienta de testeo de un API</strong> es disponer de un archivo .json con todos los datos para lanzar los tests.</p> <p>Esto te permite preparar la batería de pruebas de una sola vez y utilizarla todas las veces que lo necesites. También es fácil hacer pequeños retoques en las pruebas y volver a cargar el .json en Postman.</p> <p>Para usar Postman de este modo, debes:</p> <ol> <li> <p><strong>Crear tu archivo .json con la colección de tests</strong>. No suele ser buena idea escribirlo a mano. Para esto puedes apoyarte en una IA como ChatGPT o la propia IA que viene integrada con Postman, a la que puedes pedir algo como esto: <em>“Genera un archivo .json con una colección para Postman con la que probar la siguiente una API REST basada en las siguientes tablas”</em>. Y, a continuación, detalla la estructura de tu base de datos.</p> </li> <li> <p><strong>Importa tu archivo .json con la opción <em>“Import”</em> de Postman</strong>. Se importará como una nueva colección. Si la colección ya existiera y te quedan dos con el mismo nombre, puedes borrar la que te sobre.</p> </li> </ol> <p>Y listo: solo con esto ya tendrás todos los <em>endpoints</em> listos para probar.</p> <p><img src="../assets/images/postman-coleccion-json.jpg" alt="Postman - Importar json en colección" /></p> <h3 id="355-y-qué-más-puede-hacer-postman"> <a href="#355-y-qué-más-puede-hacer-postman" class="anchor-heading" aria-labelledby="355-y-qué-más-puede-hacer-postman"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5.5. ¿Y qué más puede hacer Postman? </h3> <p>Postman es mucho más que una herramienta para probar endpoints; es una <strong>plataforma completa de colaboración y automatización para APIs</strong>.</p> <p>Nosotros no vamos a ver mucho más en esta introducción, pero si quieres profundizar en ello, aquí tienes algunos de los trucos de magia que Postman puede realizar para ti:</p> <ul> <li> <p><strong>Automatización de pruebas</strong>: puedes escribir sripts en Javascript para validar las respuestas de forma automática o ejecutar múltiples peticiones en secuencia, así como ejecutar código antes y después de lanzar las peticiones.</p> </li> <li> <p><strong>Documentación de API</strong>: Postman no solo puede generar automáticamente documentación de la API a partir de la colección, sino que también puede publicarla online y mantenerla actualizada.</p> </li> <li> <p><strong>Monitoreo</strong>: con Postman se puede monitorear el estado de una API de forma automática a intervalos regulares y hacer que nos avise de cualquier mal funcionamiento.</p> </li> <li> <p><strong>Simulación de servidores</strong>: Postman puede simular servidores inexistentes para pruebas más complejas.</p> </li> <li> <p><strong>Trabajo en equipo</strong>: Puedes integrar Postman con GitHub, GitLab, Jenkins, etc.</p> </li> <li> <p><strong>Autenticación</strong>: también puedes gestionar la autenticación por múltiples medios en aquellas APIs que la exijan antes de responder a <em>requests</em>.</p> </li> </ul> <h2 id="36-práctica-construir-un-api-rest-sobre-la-tierra-media"> <a href="#36-práctica-construir-un-api-rest-sobre-la-tierra-media" class="anchor-heading" aria-labelledby="36-práctica-construir-un-api-rest-sobre-la-tierra-media"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.6. Práctica: construir un API REST sobre la Tierra Media </h2> <p>En esta práctica vamos a crear una base de datos con información sobre la <strong>Tierra Media</strong> (el universo ficticio de Tolkien). Posteriormente escribiremos una API REST con Laravel que acceda a esos datos y probaremos a consumirlos con Postman.</p> <div style="background-color: #ddd; font-size: 80%"><i> Por si hay alguien que no sepa de qué va esto, digamos que la Tierra Media es un universo de ficción creado por el escritor británico J. R. R. Tokien en sus obras "El hobbit" y "El señor de los anillos".<br /><br /> La Tierra Media o Middle Earth cuenta con una detallada geografía inventada (con reinos, regiones y accidentes geográficos de todo tipo) y está poblado varias razas de criaturas como hombres, elfos, enanos, hobbits u orcos. Existen muchos personajes con nombre propio y multitud de objetos importantes que intervienen en las historias de Tolkien. <br /><br />Por supuesto, no es necesario que conozcas este universo ni a sus personajes para realizar este ejercicio, aunque probablemente es más divertido si los conoces.</i></div> <h3 id="paso-1-crear-la-infraestructura"> <a href="#paso-1-crear-la-infraestructura" class="anchor-heading" aria-labelledby="paso-1-crear-la-infraestructura"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 1: crear la infraestructura </h3> <h4 id="tablas-de-la-base-de-datos"> <a href="#tablas-de-la-base-de-datos" class="anchor-heading" aria-labelledby="tablas-de-la-base-de-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Tablas de la base de datos </h4> <p>Basaremos nuestra API en la siguiente base de datos (respeta escrupulosamente los nombres de las tablas y las columnas para evitar posteriores conflictos).</p> <p><strong>TABLAS MAESTRAS</strong>:</p> <ul> <li><strong>realms</strong> (reinos): id, name (Rohan, Gondor, Mordor, etc.), ruler (nombre del rey o líder), alignment (Bien / Mal / Neutral), id_region (clave ajena)</li> <li><strong>heroes</strong>: id, name, race (humano, elfo, enano, hobbit, orco…), rank (capitán, explorador, etc.), realm_id (clave ajena), alive (boolean)</li> <li><strong>creatures</strong> (criaturas): id, name, species (trol, huargo, araña gigante, nazgûl…), threat_level (nivel de amenaza, de 1 a 10), id_region (clave ajena)</li> <li><strong>artifacts</strong> (artefactos u objetos): id, name, type (espada, anillo, gema, libro…), origin_realm_id (clave ajena), power_level (1–100), description</li> <li><strong>region</strong>: id, name</li> </ul> <p><strong>TABLAS PIVOTE</strong> (relaciones N:N):</p> <ul> <li><strong>artifact_hero</strong>: relación N:N entre <em>heroe</em> y <em>artifact</em> (hero_id, mission_id)</li> </ul> <h4 id="migraciones-1"> <a href="#migraciones-1" class="anchor-heading" aria-labelledby="migraciones-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Migraciones </h4> <p><strong>Migración de la tabla <em>regions</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'regions'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'regions'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de la tabla <em>realms</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'realms'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'ruler'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'alignment'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'region_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">(</span><span class="s1">'regions'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'realms'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de la tabla <em>heroes</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'heroes'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'race'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'rank'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'realm_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">(</span><span class="s1">'realms'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">boolean</span><span class="p">(</span><span class="s1">'alive'</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">default</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'heroes'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de la tabla <em>creatures</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'creatures'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'species'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedTinyInteger</span><span class="p">(</span><span class="s1">'threat_level'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'region_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">(</span><span class="s1">'regions'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'creatures'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de la tabla <em>artifacts</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'artifacts'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'type'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'origin_realm_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">(</span><span class="s1">'realms'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedTinyInteger</span><span class="p">(</span><span class="s1">'power_level'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'description'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'artifacts'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p><strong>Migración de la tabla pivote <em>artifact_hero</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nc">Migration</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'artifact_hero'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'artifact_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">(</span><span class="s1">'artifacts'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreignId</span><span class="p">(</span><span class="s1">'hero_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">constrained</span><span class="p">(</span><span class="s1">'heroes'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'artifact_hero'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="seeders"> <a href="#seeders" class="anchor-heading" aria-labelledby="seeders"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Seeders </h4> <p>Te dejo aquí algunos Seeders por si quieres rellenar tus tablas con algunos datos de prueba. Por supuesto, si lo prefieres, puedes inventarte tus propios datos o utilizar <em>Faker</em> para que sea Laravel quien se los invente.</p> <p><strong>Seeder de la tabla <em>regions</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">RegionsSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'regions'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">([</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Eriador'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Rhovanion'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Mordor'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Gondor'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Rohan'</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Seeder de la tabla <em>realms</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">RealmsSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'realms'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">([</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Gondor'</span><span class="p">,</span> <span class="s1">'ruler'</span> <span class="o">=&gt;</span> <span class="s1">'Aragorn'</span><span class="p">,</span> <span class="s1">'alignment'</span> <span class="o">=&gt;</span> <span class="s1">'Bien'</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Rohan'</span><span class="p">,</span> <span class="s1">'ruler'</span> <span class="o">=&gt;</span> <span class="s1">'Éomer'</span><span class="p">,</span> <span class="s1">'alignment'</span> <span class="o">=&gt;</span> <span class="s1">'Bien'</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Mordor'</span><span class="p">,</span> <span class="s1">'ruler'</span> <span class="o">=&gt;</span> <span class="s1">'Sauron'</span><span class="p">,</span> <span class="s1">'alignment'</span> <span class="o">=&gt;</span> <span class="s1">'Mal'</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Erebor'</span><span class="p">,</span> <span class="s1">'ruler'</span> <span class="o">=&gt;</span> <span class="s1">'Thorin'</span><span class="p">,</span> <span class="s1">'alignment'</span> <span class="o">=&gt;</span> <span class="s1">'Bien'</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Seeder de la tabla <em>heroes</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">HeroesSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'heroes'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">([</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Aragorn'</span><span class="p">,</span> <span class="s1">'race'</span> <span class="o">=&gt;</span> <span class="s1">'Humano'</span><span class="p">,</span> <span class="s1">'rank'</span> <span class="o">=&gt;</span> <span class="s1">'Rey'</span><span class="p">,</span> <span class="s1">'realm_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'alive'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Legolas'</span><span class="p">,</span> <span class="s1">'race'</span> <span class="o">=&gt;</span> <span class="s1">'Elfo'</span><span class="p">,</span> <span class="s1">'rank'</span> <span class="o">=&gt;</span> <span class="s1">'Arquero'</span><span class="p">,</span> <span class="s1">'realm_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'alive'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Gimli'</span><span class="p">,</span> <span class="s1">'race'</span> <span class="o">=&gt;</span> <span class="s1">'Enano'</span><span class="p">,</span> <span class="s1">'rank'</span> <span class="o">=&gt;</span> <span class="s1">'Guerrero'</span><span class="p">,</span> <span class="s1">'realm_id'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">'alive'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Frodo'</span><span class="p">,</span> <span class="s1">'race'</span> <span class="o">=&gt;</span> <span class="s1">'Hobbit'</span><span class="p">,</span> <span class="s1">'rank'</span> <span class="o">=&gt;</span> <span class="s1">'Portador'</span><span class="p">,</span> <span class="s1">'realm_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'alive'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Seeder de la tabla <em>creatures</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CreaturesSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'creatures'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">([</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Balrog'</span><span class="p">,</span> <span class="s1">'species'</span> <span class="o">=&gt;</span> <span class="s1">'Demonio'</span><span class="p">,</span> <span class="s1">'threat_level'</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Nazgûl'</span><span class="p">,</span> <span class="s1">'species'</span> <span class="o">=&gt;</span> <span class="s1">'Espectro'</span><span class="p">,</span> <span class="s1">'threat_level'</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Warg'</span><span class="p">,</span> <span class="s1">'species'</span> <span class="o">=&gt;</span> <span class="s1">'Lobo'</span><span class="p">,</span> <span class="s1">'threat_level'</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Troll'</span><span class="p">,</span> <span class="s1">'species'</span> <span class="o">=&gt;</span> <span class="s1">'Troll'</span><span class="p">,</span> <span class="s1">'threat_level'</span> <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">'region_id'</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Seeder de la tabla <em>artifacts</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ArtifactsSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'artifacts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">([</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Anillo Único'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'Anillo'</span><span class="p">,</span> <span class="s1">'origin_realm_id'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'power_level'</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Poder absoluto de Sauron'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Andúril'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'Espada'</span><span class="p">,</span> <span class="s1">'origin_realm_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'power_level'</span> <span class="o">=&gt;</span> <span class="mi">85</span><span class="p">,</span> <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Espada de Aragorn'</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Arco de Legolas'</span><span class="p">,</span> <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'Arco'</span><span class="p">,</span> <span class="s1">'origin_realm_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'power_level'</span> <span class="o">=&gt;</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Arco del príncipe elfo'</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><strong>Seeder de la tabla pivote <em>artifact_hero</em></strong></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="kn">use</span> <span class="no">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ArtifactHeroSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="no">DB</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'artifact_hero'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">insert</span><span class="p">([</span>
            <span class="p">[</span><span class="s1">'artifact_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'hero_id'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">],</span> <span class="c1">// Frodo lleva el Anillo Único</span>
            <span class="p">[</span><span class="s1">'artifact_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'hero_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">],</span> <span class="c1">// Aragorn lleva la espada Andúril</span>
            <span class="p">[</span><span class="s1">'artifact_id'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'hero_id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span> <span class="c1">// Legolas lleva el "Arco de Legolas" (claro)</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="paso-2-escribir-el-api"> <a href="#paso-2-escribir-el-api" class="anchor-heading" aria-labelledby="paso-2-escribir-el-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 2: escribir el API </h3> <p><strong>Crea con Laravel un API REST</strong> para acceder a los datos de las tablas anteriores. Los <strong><em>endpoints</em></strong> a los que debería responder este API son estos:</p> <p><strong>Regiones (regions)</strong></p> <ul> <li>GET /regions –&gt; Listar todas las regiones</li> <li>GET /regions/{id} –&gt; Obtener los datos de una región concreta</li> <li>POST /regions –&gt; Crear una nueva región</li> <li>PUT /regions/{id} –&gt; Actualizar una región existente</li> <li>DELETE /regions/{id} –&gt; Eliminar una región</li> </ul> <p><strong>Reinos (realms)</strong></p> <ul> <li>GET /realms –&gt; Listar todos los reinos</li> <li>GET /realms/{id} –&gt; Mostrar detalles de un reino, incluyendo región, héroes y artefactos</li> <li>POST /realms –&gt; Crear un nuevo reino</li> <li>PUT /realms/{id} –&gt; Actualizar un reino existente</li> <li>DELETE /realms/{id} –&gt; Eliminar un reino</li> </ul> <p><strong>Héroes (heroes)</strong></p> <ul> <li>GET /heroes –&gt; Listar todos los héroes</li> <li>GET /heroes/{id} –&gt; Mostrar detalles de un héroe, incluyendo reino y artefactos</li> <li>POST /heroes –&gt; Crear un nuevo héroe</li> <li>PUT /heroes/{id} –&gt; Actualizar un héroe existente</li> <li>DELETE /heroes/{id} –&gt; Eliminar un héroe</li> </ul> <p><strong>Criaturas (creatures)</strong></p> <ul> <li>GET /creatures –&gt; Listar todas las criaturas</li> <li>GET /creatures/{id} –&gt; Mostrar detalles de una criatura, incluyendo región</li> <li>POST /creatures –&gt; Crear una nueva criatura</li> <li>PUT /creatures/{id} –&gt; Actualizar una criatura existente</li> <li>DELETE /creatures/{id} –&gt; Eliminar una criatura</li> </ul> <p><strong>Artefactos (artifacts)</strong></p> <ul> <li>GET /artifacts –&gt; Listar todos los artefactos</li> <li>GET /artifacts/{id} –&gt; Mostrar detalles de un artefacto, incluyendo reino y héroes que lo poseen</li> <li>POST /artifacts –&gt; Crear un nuevo artefacto</li> <li>PUT /artifacts/{id} –&gt; Actualizar un artefacto existente</li> <li>DELETE /artifacts/{id} –&gt; Eliminar un artefacto</li> </ul> <p><strong>Asignación de artefactos a héroes (artifact_hero)</strong></p> <ul> <li>POST /artifact-hero –&gt; Asignar un artefacto a un héroe (insert en pivot)</li> <li>DELETE /artifact-hero –&gt; Retirar un artefacto de un héroe</li> <li>GET /heroes/{id}/artifacts –&gt; Listar todos los artefactos de un héroe</li> <li>GET /artifacts/{id}/heroes –&gt; Listar todos los héroes que poseen un artefacto</li> </ul> <p><strong>Endpoints adicionales (opcionales)</strong></p> <ul> <li>/realms/{id}/heroes –&gt; listar héroes de un reino específico</li> <li>/regions/{id}/creatures –&gt; listar criaturas de una región específica</li> <li>/heroes/alive –&gt; listar héroes vivos</li> <li>/creatures/dangerous?level=8 –&gt; listar criaturas con amenaza alta</li> <li>/artifacts/top –&gt; listar artefactos con power_level mayor a 90</li> </ul> <h3 id="paso-3-probar-y-consumir-el-api"> <a href="#paso-3-probar-y-consumir-el-api" class="anchor-heading" aria-labelledby="paso-3-probar-y-consumir-el-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 3: probar y consumir el API </h3> <p>Vamos a terminar comprobando si el API que hemos construido realmente funciona.</p> <ol> <li><strong>Prueba algunos de los endpoints</strong> anteriores creando <em>manualmente</em> algunas peticiones en una colección de Postman.</li> <li><strong>Prueba todos los endpoints</strong>: <ul> <li>Genera, con ayuda de ChatGPT u otra IA generativa, un archivo .json para probar <em>todos</em> los endpoints anteriores.</li> <li>Importa el .json en Postman.</li> <li>Lanza todos los <em>requests</em> para comprobar si tu API funciona con todas las peticiones.</li> </ul> </li> </ol> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
