<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Apéndice 2. Virtualización con Docker - DESARROLLO WEB FULL STACK</title> <link rel="shortcut icon" href="/docs/fullstack/_site/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/fullstack/_site/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/fullstack/_site/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/fullstack/_site/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Apéndice 2. Virtualización con Docker | DESARROLLO WEB FULL STACK</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Apéndice 2. Virtualización con Docker" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="https://iescelia.org/docs/fullstack/_site/docker/" /> <meta property="og:url" content="https://iescelia.org/docs/fullstack/_site/docker/" /> <meta property="og:site_name" content="DESARROLLO WEB FULL STACK" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Apéndice 2. Virtualización con Docker" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Apuntes del módulo optativo de “Desarrollo web full stack”, de 2º curso del Ciclo Formativo de Grado Superior de Desarrollo de Aplicaciones Web/Multiplataforma impartido en el IES Celia Viñas de Almería (España)","headline":"Apéndice 2. Virtualización con Docker","url":"https://iescelia.org/docs/fullstack/_site/docker/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://iescelia.org/docs/fullstack/_site/" class="site-title lh-tight"> DESARROLLO WEB FULL STACK </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://iescelia.org/docs/fullstack/_site/" class="nav-list-link">Desarrollo web full stack</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://iescelia.org/docs/fullstack/_site/php/" class="nav-list-link">1 Programación web con PHP</a><ul class="nav-list"><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/frontend-backend-fullstack.html" class="nav-list-link">1.1 Frontend vs backend vs full stack</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/caja-de-herramientas.html" class="nav-list-link">1.2 Caja de herramientas</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/sintaxis-de-php.html" class="nav-list-link">1.3 Sintaxis de PHP</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/interaccion-con-mysql.html" class="nav-list-link">1.4 Interacción con la base de datos</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/depuracion-php-xdebug.html" class="nav-list-link">1.5 Depurando el código PHP con xdebug</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/cookies-y-sesiones.html" class="nav-list-link">1.6 Cookies y variables de sesión</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/mvc/" class="nav-list-link">1.7 Arquitectura MVC</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/ejercicios-resueltos.html" class="nav-list-link">1.8 Ejercicios resueltos</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/ejercicios-propuestos.html" class="nav-list-link">1.9 Ejercicios propuestos</a> </li><li class="nav-list-item "> <a href="https://iescelia.org/docs/fullstack/_site/php/practica.html" class="nav-list-link">1.10 Práctica final</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://iescelia.org/docs/fullstack/_site/laravel/" class="nav-list-link">2 Laravel</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/api-rest/" class="nav-list-link">3 Desarrollo de un API REST</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/vue-js/" class="nav-list-link">4 Vue.js</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/inertia/" class="nav-list-link">5 Intertia.js</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/scv-git/" class="nav-list-link">Apéndice 1. Sistemas de control de versiones. Git</a></li><li class="nav-list-item active"><a href="https://iescelia.org/docs/fullstack/_site/docker/" class="nav-list-link active">Apéndice 2. Virtualización con Docker</a></li><li class="nav-list-item "><a href="https://iescelia.org/docs/fullstack/_site/openstack/" class="nav-list-link">Apéndice 3. Despliegue con Openstack</a></li></ul></li><li class="nav-list-item"><a href="https://iescelia.org/docs/fullstack/_site/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DESARROLLO WEB FULL STACK" aria-label="Search DESARROLLO WEB FULL STACK" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://iescelia.org/docs/fullstack/_site/">Desarrollo web full stack</a></li> <li class="breadcrumb-nav-list-item"><span>Apéndice 2. Virtualización con Docker</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="apéndice-2-virtualización-con-docker"> <a href="#apéndice-2-virtualización-con-docker" class="anchor-heading" aria-labelledby="apéndice-2-virtualización-con-docker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Apéndice 2. Virtualización con Docker </h1> <ul id="markdown-toc"> <li><a href="#a21-qué-es-docker" id="markdown-toc-a21-qué-es-docker">A2.1. ¿Qué es Docker?</a></li> <li><a href="#a22-comandos-usuales-de-docker" id="markdown-toc-a22-comandos-usuales-de-docker">A2.2. Comandos usuales de Docker</a></li> <li><a href="#a23-persistencia-de-datos" id="markdown-toc-a23-persistencia-de-datos">A2.3. Persistencia de datos</a></li> <li><a href="#a24-montando-con-docker-un-servidor-web-con-persistencia-de-datos" id="markdown-toc-a24-montando-con-docker-un-servidor-web-con-persistencia-de-datos">A2.4. Montando con Docker un servidor web con persistencia de datos</a> <ul> <li><a href="#paso-1-crear-docker-composeyml" id="markdown-toc-paso-1-crear-docker-composeyml">Paso 1. Crear ./docker-compose.yml</a></li> <li><a href="#paso-2-crear-apache-customhttpdconf" id="markdown-toc-paso-2-crear-apache-customhttpdconf">Paso 2. Crear ./apache-custom/httpd.conf</a></li> <li><a href="#paso-3-crear-apache-custommyappconf" id="markdown-toc-paso-3-crear-apache-custommyappconf">Paso 3. Crear ./apache-custom/myapp.conf</a></li> <li><a href="#paso-4-crear-el-archivo-customini" id="markdown-toc-paso-4-crear-el-archivo-customini">Paso 4. Crear el archivo custom.ini</a></li> <li><a href="#paso-5-crear-un-dockerfile-personalizado-para-php" id="markdown-toc-paso-5-crear-un-dockerfile-personalizado-para-php">Paso 5. Crear un Dockerfile personalizado para PHP</a></li> <li><a href="#paso-6-levantar-los-contenedores-con-docker-compose-up" id="markdown-toc-paso-6-levantar-los-contenedores-con-docker-compose-up">Paso 6. Levantar los contenedores con docker-compose up</a></li> <li><a href="#paso-7-probar-los-contenedores" id="markdown-toc-paso-7-probar-los-contenedores">Paso 7. Probar los contenedores</a></li> <li><a href="#paso-8-detener-los-contenedores" id="markdown-toc-paso-8-detener-los-contenedores">Paso 8. Detener los contenedores</a></li> </ul> </li> </ul> <h2 id="a21-qué-es-docker"> <a href="#a21-qué-es-docker" class="anchor-heading" aria-labelledby="a21-qué-es-docker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A2.1. ¿Qué es Docker? </h2> <p><strong>Docker</strong> es una herramienta de virtualización basada en <em>contenedores</em>.</p> <p>Un <strong>contenedor</strong> es un paquete de software completamente independiente del sistema donde se ejecuta. Recibe ese nombre por los contenedores que se utilizan en el transporte marítimo, que tienen unas medidas y una forma estandarizada y que aislan por completo la carga que llevan dentro del exterior.</p> <p>Un contenedor Docker hace lo mismo, pero con un conjunto de software: lo aisla por completo del exterior. El software que hay dentro del contenedor se puede ejecutar en cualquier máquina gracias al <em>runtime</em> de Docker, que se comporta como un mini-sistema operativo virtualizado que corre sobre la máquina anfitrión.</p> <p>Un contenedor puede contener cualquier cosa. Por ejemplo, Apache. De ese modo, podemos ejecutar Apache en cualquier máquina (siempre que tenga previamente instalado Docker) sin necesidad de instalarlo realmente, con todo lo que ello conlleva de configuración de la máquina, consumo de recursos, etc. El contenedor Docker puede ponerse en marcha cuando queramos y detenerse en cualquier momento, sin dejar ningún rastro en la máquina anfitriona.</p> <p>En definitiva, puedes usar y/o testear <em>cualquier</em> programa sin tener que instalarlo realmente en tu máquina.</p> <p>Los contenedores Docker vienen empaquetados en <strong>imágenes</strong>, a partir de los cuales pueden lanzarse todos los contenedores que necesitemos. Es decir, las imágenes con como las <em>clases</em> en programación orientada a objetos, y los contenedores son como los objetos que se instancian a partir de esas clases.</p> <p>Cada cual puede construir las imágenes que necesite o usar imágenes ya hechas, con todo lo necesario en su interior para ejecutar cualquier software sin necesidad de instalarlo ni configurarlo. Hay repositorios públicos de imágenes, como <strong>DockerHub</strong>, donde uno puede encontrar imágenes de prácticamente cualquier cosa.</p> <h2 id="a22-comandos-usuales-de-docker"> <a href="#a22-comandos-usuales-de-docker" class="anchor-heading" aria-labelledby="a22-comandos-usuales-de-docker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A2.2. Comandos usuales de Docker </h2> <p>Aunque Docker puede usarse desde un interfaz gráfico (como <strong>Docker Desktop</strong>), lo habitual es hacerlo desde la línea de comandos.</p> <p>Esto no es un manual de Docker, pero sí vamos a enumerar aquí los comandos principales que nos serán útiles como desarrolladores web para que puedas usarlos como referencia rápida cuando tengas que trabajar con Docker.</p> <ul> <li><code class="language-plaintext highlighter-rouge">docker run [nombre-imagen]</code> - Lanza un contenedor a partir de la imagen especificada. Si la imagen no está descargada en el ordenador, la buscará en el repositorio configurado (por defecto, <em>DockerHub</em>).</li> <li><code class="language-plaintext highlighter-rouge">docker ps</code> - Muestra un listado con los contenedores que hay actualmente en el sistema. Un contenedor no tiene por qué estar necesariamente corriendo, sino que existen otros estados (detenido, preparado, finalizado, etc). Con <code class="language-plaintext highlighter-rouge">docker ps -a</code> podemos ver todos los contenedores, también los detenidos.</li> <li><code class="language-plaintext highlighter-rouge">docker stop [id-del-contenedor]</code> - Detiene un contenedor. Su id puede obtenerse con <code class="language-plaintext highlighter-rouge">docker ps</code>.</li> <li><code class="language-plaintext highlighter-rouge">docker start [id-del-contenedor]</code> - Reanuda un contenedor.</li> <li><code class="language-plaintext highlighter-rouge">docker exec -it [id-del-contenedor] bash</code> - Abrir un terminal en el contenedor.</li> <li><code class="language-plaintext highlighter-rouge">docker-compose up -d</code> - Inicia todos los contenedores especificados en el archivo <em>docker-compose.yml</em> del directorio actual. Necesitas tener instalado, además de Docker, el programa <em>docker-compose</em>.</li> <li><code class="language-plaintext highlighter-rouge">docker-compose down</code> - Detiene todos los contenedores especificados en el archivo <em>docker-compose.yml</em> del directorio actual.</li> </ul> <h2 id="a23-persistencia-de-datos"> <a href="#a23-persistencia-de-datos" class="anchor-heading" aria-labelledby="a23-persistencia-de-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A2.3. Persistencia de datos </h2> <p>Cualquier cosa que guardes en un contenedor de Docker se perderá cuando el contenedor se detenga. Por ejemplo, si estás haciendo una aplicación web que usa una base de datos MySQL, y tu servidor MySQL está en un contenedor Docker, toda la información de esa base de datos se perderá cada vez que destruyas el contenedor.</p> <p>Es posible evitar eso usando la persistencia de datos. Consiste en pedirle a Docker que guarde datos <em>fuera</em> del contenedor, para que estos no se pierdan al reiniciarlo o eliminarlo. Por ejemplo, los datos de la base de datos.</p> <p>La persistencia se puede habilitar con <strong>docker run</strong>. Por ejemplo:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run -d --name mysql-container -e MYSQL_ROOT_PASSWORD=clave123 -v mysql-data:/var/lib/mysql mysql:latest
</code></pre></div></div> <p>La persistencia se habilita con <em>-v mysql-data:/var/lib/mysql</em>, que crea (o usa) un volumen llamado <em>mysql-data</em> y lo monta en la ruta <em>/var/lib/mysql</em> de la máquina real, que es donde MySQL suele guardar los datos.</p> <p>Personalmente, encuentro más sencillo hacerlo todo a través de <strong>docker-compose</strong>. Por ejemplo, mira este archivo de configuración docker-compose.yml:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">mysql</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">mysql-container</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mysql-data:/var/lib/mysql</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3306:3306"</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">mysql-data</span><span class="pi">:</span>
</code></pre></div></div> <p>Con este archivo de configuración se lanzará un contenedor de <em>mysql</em> en cuanto tecleemos <em>docker-compose up</em>. Observa estas dos líneas:</p> <ul> <li>La línea <em>volumes</em> dentro del servicio <em>mysql</em> monta el volumen virtual <em>mysql-data</em> en <em>/var/lib/mysql</em>, el lugar de la máquina real donde MySQL suele guardar los datos.</li> <li>La línea <em>volumes</em> al final del archivo declara el volumen llamado <em>mysql-data</em>, que Docker creará si no existe.</li> </ul> <p>Así, los datos persisten en <em>/var/lib/mysql</em> aunque detengas o elimines el contenedor.</p> <h2 id="a24-montando-con-docker-un-servidor-web-con-persistencia-de-datos"> <a href="#a24-montando-con-docker-un-servidor-web-con-persistencia-de-datos" class="anchor-heading" aria-labelledby="a24-montando-con-docker-un-servidor-web-con-persistencia-de-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A2.4. Montando con Docker un servidor web con persistencia de datos </h2> <p>En esta sección vamos a mostrar cómo montar un servidor web con imágenes Docker y levantarlo o apagarlo con docker-compose.</p> <p>Usaremos las imágenes oficiales de cada desarrollador, y necesitaremos poner en marcha <strong>cuatro contenedores</strong> simultáneamente, por lo que será mucho más cómodo hacerlo con docker-compose para poder levantarlas todas a la vez y no de una en una:</p> <ol> <li><strong>Servidor Apache</strong></li> <li><strong>Intérprete PHP</strong></li> <li><strong>Servidor MariaDB</strong></li> <li><strong>PHPMyAdmin</strong></li> </ol> <p>Además, necesitamos que los datos de MariaDB sean persistentes, es decir, que no se pierdan cuando detengamos los contenedores.</p> <p>Para lograr todo esto, sigue estos pasos:</p> <h3 id="paso-1-crear-docker-composeyml"> <a href="#paso-1-crear-docker-composeyml" class="anchor-heading" aria-labelledby="paso-1-crear-docker-composeyml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 1. Crear ./docker-compose.yml </h3> <p>Crea un archivo <strong><em>docker-compose.yml</em></strong> en tu directorio de trabajo con este contenido exacto, para trabajar con las imágenes oficiales de nuestros cuatro servicios:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">php</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">php:8.2-fpm</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./app:/app</span>
      <span class="pi">-</span> <span class="s">./custom.ini:/usr/local/etc/php/conf.d/custom.ini</span>

  <span class="na">apache</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">httpd:2.4</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./app:/app</span>
      <span class="pi">-</span> <span class="s">./apache-custom/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro</span>
      <span class="pi">-</span> <span class="s">./apache-custom/myapp.conf:/usr/local/apache2/conf/extra/myapp.conf:ro</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">php</span>

  <span class="na">mariadb</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mariadb:10.6</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="m">1234</span>
      <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">pruebas</span>
      <span class="na">MYSQL_USER</span><span class="pi">:</span> <span class="s">user</span>
      <span class="na">MYSQL_PASSWORD</span><span class="pi">:</span> <span class="m">1234</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mariadb_data:/var/lib/mysql</span>

  <span class="na">phpmyadmin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">phpmyadmin/phpmyadmin</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8000:80"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">PMA_HOST</span><span class="pi">:</span> <span class="s">mariadb</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mariadb</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">mariadb_data</span><span class="pi">:</span>
</code></pre></div></div> <h3 id="paso-2-crear-apache-customhttpdconf"> <a href="#paso-2-crear-apache-customhttpdconf" class="anchor-heading" aria-labelledby="paso-2-crear-apache-customhttpdconf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 2. Crear ./apache-custom/httpd.conf </h3> <p>Por defecto, la imagen oficial de Apache no interpreta el código PHP, sino que lo sirve en texto plano, como si fuera HTML.</p> <p>Para reconfigurar esa imagen sin tener que meter mano al Dockerfile (algo que aprenderás a hacer en otros módulos) tienes que:</p> <ol> <li>Crear el directorio <strong><em>apache-custom</em></strong> en tu carpeta de trabajo.</li> <li>Crear el archivo <strong><em>httpd.conf</em></strong> dentro de <em>apache-custom</em> con este contenido:</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># httpd.conf mínimo preparado para usar Apache httpd:2.4 + PHP-FPM

ServerRoot "/usr/local/apache2"

# Puerto en el que Apache escuchará dentro del contenedor
Listen 80

# Módulos esenciales
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule env_module modules/mod_env.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule alias_module modules/mod_alias.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule headers_module modules/mod_headers.so

# Módulos necesarios para proxying a PHP-FPM
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so

# Información del servidor
ServerAdmin you@example.com
ServerName localhost:80

# Archivos de tipos mime
TypesConfig conf/mime.types

# Logs: enviar a stdout/stderr para que docker-compose logs funcione bien
ErrorLog /proc/self/fd/2
CustomLog /proc/self/fd/1 common

# Seguridad por defecto
&lt;Directory /&gt;
    AllowOverride none
    Require all denied
&lt;/Directory&gt;

# DocumentRoot por defecto
DocumentRoot "/usr/local/apache2/htdocs"
&lt;Directory "/usr/local/apache2/htdocs"&gt;
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
&lt;/Directory&gt;

# Índices (queremos que index.php tenga preferencia sobre index.html)
&lt;IfModule dir_module&gt;
    DirectoryIndex index.php index.html
&lt;/IfModule&gt;

# Incluimos el virtualhost personalizado que defines en apache-custom/myapp.conf
Include conf/extra/myapp.conf

# Fin del archivo
</code></pre></div></div> <h3 id="paso-3-crear-apache-custommyappconf"> <a href="#paso-3-crear-apache-custommyappconf" class="anchor-heading" aria-labelledby="paso-3-crear-apache-custommyappconf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 3. Crear ./apache-custom/myapp.conf </h3> <p>En este archivo de configuración adicional redirigiremos todas las peticiones de archivos .php hacia el contenedor con el intérprete PHP. El resto de archivos serán servidos por Apache.</p> <p>Crea el archivo <strong><em>myapp.conf</em></strong> dentro del directorio <em>apache-custom</em> con este contenido:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
    DocumentRoot "/app"

    &lt;Directory "/app"&gt;
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php
    &lt;/Directory&gt;

    # Enviar todas las peticiones a .php al FPM del contenedor `php`
    ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://php:9000/app/$1
&lt;/VirtualHost&gt;
</code></pre></div></div> <h3 id="paso-4-crear-el-archivo-customini"> <a href="#paso-4-crear-el-archivo-customini" class="anchor-heading" aria-labelledby="paso-4-crear-el-archivo-customini"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 4. Crear el archivo custom.ini </h3> <p>Este archivo contiene las <strong>opciones de configuración adicionales para PHP</strong>.</p> <p>PHP se configura dentro del contenedor correspondiente, en un archivo llamado <em>php.ini</em>. Podemos agregar configuraciones adicionales sin necesidad de tocar el contenedor con un archivo de configuración adicional que mapearemos al interior del contenedor.</p> <p>Crea un archivo llamado <strong><em>custom.ini</em></strong> en tu directorio de trabajo con este contenido:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>display_errors = On
error_reporting = E_ALL
opcache.enable = 0
extension=pdo
extension=pdo_mysql
</code></pre></div></div> <p>Esto habilitará la extensión PDO para MySQL y las opciones de depuración de errores. En un entorno de producción, estas opciones se cambiarían, claro.</p> <p>Si necesitas configuraciones adicionales para PHP (como incrementar el tamaño máximo de archivos subidos al servidor o el tiempo de procesamiento de un script), puedes hacerlo en este custom.ini y volver a levantar el servidor.</p> <h3 id="paso-5-crear-un-dockerfile-personalizado-para-php"> <a href="#paso-5-crear-un-dockerfile-personalizado-para-php" class="anchor-heading" aria-labelledby="paso-5-crear-un-dockerfile-personalizado-para-php"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 5. Crear un Dockerfile personalizado para PHP </h3> <p>La extensión PDO para MySQL no viene instalada por defecto en la imagen oficial de PHP-FPM. Debemos modificar la imagen para poder usar esta extensión.</p> <p>Lo más adecuado para ello es crear un archivo <strong><em>Dockerfile</em></strong> con este contenido:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 1. Base PHP-FPM oficial
FROM php:8.2-fpm

# 2. Instalar dependencias necesarias para pdo_mysql
RUN apt-get update &amp;&amp; apt-get install -y \
        default-mysql-client \
        libzip-dev \
        unzip \
    &amp;&amp; docker-php-ext-install pdo pdo_mysql \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# 3. Copiar el código PHP al contenedor
COPY app/ /var/www/html/

# 4. Copiar el custom.ini
COPY custom.ini /usr/local/etc/php/conf.d/custom.ini

# 5. Establecer el directorio de trabajo
WORKDIR /var/www/html

# 6. Opcional: exponer puerto (necesario para acceder desde localhost)
EXPOSE 9000
</code></pre></div></div> <p>Después de esto, reconstruye el contenedor ejecutando este comando en el directorio donde tengas el Dockerfile:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker build -t mi-php-pdo .
</code></pre></div></div> <h3 id="paso-6-levantar-los-contenedores-con-docker-compose-up"> <a href="#paso-6-levantar-los-contenedores-con-docker-compose-up" class="anchor-heading" aria-labelledby="paso-6-levantar-los-contenedores-con-docker-compose-up"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 6. Levantar los contenedores con docker-compose up </h3> <p>Ya podemos <strong>poner en marcha los cuatro contenedores</strong> tecleando (en el directorio de trabajo):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up --build
</code></pre></div></div> <p>O bien, si no hemos tocado la configuración de los contenedores recientemente:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up
</code></pre></div></div> <p>También podemos lanzarlo en segundo plano, para que la consola no se quede bloqueada:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up -d
</code></pre></div></div> <h3 id="paso-7-probar-los-contenedores"> <a href="#paso-7-probar-los-contenedores" class="anchor-heading" aria-labelledby="paso-7-probar-los-contenedores"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 7. Probar los contenedores </h3> <p>Si todo ha ido bien, deberías tener estos servicios activos:</p> <ul> <li><strong>http://localhost:8080</strong> -&gt; Aquí debería estar escuchando Apache/PHP. Si pones un archivo .php en la carpeta ./app de tu proyecto, tendría que verse el resultado.</li> <li><strong>http://localhost:8000</strong> -&gt; Aquí debería estar escuchando PHPMyAdmin. El usuario y contraseña de la base de datos están en el docker-compose.yml (los puedes cambiar allí si no te gustan).</li> </ul> <h3 id="paso-8-detener-los-contenedores"> <a href="#paso-8-detener-los-contenedores" class="anchor-heading" aria-labelledby="paso-8-detener-los-contenedores"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Paso 8. Detener los contenedores </h3> <p>Para detener los contenedores, tan solo teclea:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose down
</code></pre></div></div> <p>O bien pulsa <strong>CTRL + C</strong> si inciaste docker-compose en segundo plano (con la opción -d).</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
