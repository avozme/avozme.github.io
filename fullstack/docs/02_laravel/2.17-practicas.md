---
layout: page
title: 2.17 Prácticas
permalink: /laravel/practicas.html
nav_order: 17
has_children: false
parent: 2 Laravel
grand_parent: Desarrollo web full stack
---

## 2.17. Prácticas
{: .no_toc }

En esta colección de actividades prácticas vamos a montar, poco a poco, una pequeña aplicación web que funcionará en el backend mediante generación de vistas. Puedes usar el código de [gestión de productos](https://github.com/avozme/productos.git) como base para orientarte.

La aplicación será un fragmento de un **blog**, es decir, permitirá **publicar artículos y mostrarlos**. Al finalizar, habrás creado una aplicación sencilla pero funcional con un potente y seguro sistema de autenticación integrado.

- TOC
{:toc}

### Actividad 1. Preparar el entorno

* **Objetivo**: Familiarizarse con los directorios de Laravel y preparar la aplicación.
* **Tareas**:
    1. Instala Laravel con docker/sail. [Más info aquí](../laravel/instalacion.html#22-instalaci%C3%B3n-de-laravel) (con Composer o Sail).
    2. Configura el archivo .env. [Más info aquí](../laravel/configuracion.html#233-variables-de-entorno-el-archivo-env).

        Trabajaremos con estas **tablas en la base de datos** (usa los tipos de datos que te parezcan más razonables para cada campo):
        * *Tabla users*: id, username, email, password, role
        * *Tabla articles*: id, title, body, date, user_id

    3. Lanza el servidor con `$ ./vendor/bin/sail up -d` o `$ php artisan serve` y comprueba que Laravel responde.
    4. Explora la estructura de directorios. [Más info aquí](../laravel/configuracion.html#231-estructura-de-directorios).
* **Resultado**: Instalación limpia de Laravel funcionando y lista para desarrollar sobre ella.

### Actividad 2: Primer “Hola Mundo”
* **Objetivo**: Crear rutas, controladores y vistas básicas con Blade.
* **Tareas**:
    1. Crea ruta simple en `routes/web.php` que devuelva un mensaje “Hola, mundo”. [Más info aquí](../laravel/hola-mundo-con-laravel.html#soluci%C3%B3n-1-saludar-en-el-enrutador).
    2. Crea un controlador HolaController con métodos *index()* y *show($nombre)* que hagan el saludo desde el propio controlador. El método *show($nombre)* debe incluir en el saludo el nombre de la persona que recibe como parámetro. [Más info aquí](../laravel/hola-mundo-con-laravel.html#soluci%C3%B3n-2-saludar-en-un-controlador).
    3. Crea una vista Blade llamada `hola.blade.php` para mostrar los saludos. [Más info aquí](../laravel/hola-mundo-con-laravel.html#soluci%C3%B3n-3-saludar-en-una-vista).
    4. Prueba la URL `http://servidor/hola` en el navegador con parámetro y sin parámetro. Asegúrate que funciona según lo esperado en ambos casos.
* **Resultado**: Construcción del primer controlador y vista funcional con Blade, con paso de parámetros en la URL.

### Actividad 3: Plantillas y Blade
* **Objetivo**: Aprender el uso de layouts, secciones y condicionales en Blade.
* **Tareas**:
    1. **Crea una nueva entrada en el enrutador** y el controlador anteriores que renderice una vista llamada *$articles*. Esta vista debe recibir tres datos ([más info aquí](../laravel/vistas-blade.html#274-c%C3%B3mo-pasar-variables-a-las-vistas)): 
    
        * `$id`: El id del usuario autor de los artículos
        * `$username`: el nombre de ese usuario
        * `$articles`: un array con los títulos de los artículos. 
        
        Puedes asignar, de momento, **valores fijos** a esas variables antes de pasárselas a la vista. Más adelante las traeremos de la base de datos.
    2. **Crea el master layout** en `views/layouts/master.blade.php` con las secciones title, sidebar y content. [Más info aquí](../laravel/vistas-blade.html#272-master-layout).
    3. **Crea una vista heredada del master layout** llamada `views/articles/page.blade.php`. [Más info aquí](../laravel/vistas-blade.html#273-vistas-que-heredan-del-master-layout). 
    
        La vista recibirá tres datos: `$id` (el id de un autor), `$username` (el nombre del autor) y `$articles` (un array con los títulos de los artículos que ha escrito ese autor). El la vista debes mostrar el id y el username en una salida HTML (la lista de títulos la usaremos enseguida).

    4. **Crea salida HTML dinámica y condicional** (usando `@if`, `@else` y `@endif`), de manera que solo muestre la lista de títulos si contiene datos. Si la lista está vacía, la vista mostrará el texto "No existen artículos". [Más info aquí](../laravel/vistas-blade.html#276-condiciones-en-las-vistas).
    5. **Usa un bucle `@foreach`** para recorrer el array con los títulos de los artículos y mostrarlo en la salida HTML. [Más info aquí](../laravel/vistas-blade.html#277-bucles-en-las-vistas).
* **Resultado**: Construcción de vistas con Blade consistentes, reutilizables y dinámicas.

### Actividad 4: Migraciones y Eloquent
* **Objetivo**: Crear la base de datos, las migraciones y los modelos, así como algunas consultas de prueba.
* **Tareas**:
    1. **Crea los modelos** `User` y `Article`. Ten en cuenta que, en versiones recientes de Laravel, el modelo `User` ya existirá y solo tienes que revisarlo por si necesitas añadir algún campo adicional. [Más info aquí](../laravel/eloquent.html#2102-c%C3%B3mo-puedo-usar-eloquent-en-mi-aplicaci%C3%B3n).
    2. **Crea las migraciones** para las tablas `users` y `articles`, si es que aún no las has creado. [Más info aquí](../laravel/migraciones.html#291-crear-tablas-mediante-las-migraciones).
    3. **Crea *seeders* para ambas tablas**. Rellena las tablas con unos cuantos datos ficticios pero realistas generados con ***Faker***. [Más info sobre los seeders aquí](../laravel/migraciones.html#294-seeding) y [más info sobe Faker aquí](../laravel/migraciones.html#295-faker-rellenar-las-tablas-con-datos-realistas).
    4. **Lanza las migraciones y los seeders** con `$ ./vendor/bin/sail artisan migrate:fresh --seed`.
    5. **Haz algunas consultas básicas de prueba** con Eloquent (`all()`, `find()`, `where()`, `save()`...). Para comprobar que funcionan, puedes crear una ruta en `routes/web.php` y un método en el controlador `app/Http/Controllers/ArticlesController.php` desde el que lanzar las consultas y mostrar los resultados. No hace falta que crees vistas para estos resultados, porque solo es una prueba que no estará en la versión final. [Más info aquí](../laravel/eloquent.html#2104-consultas-con-eloquent).
* **Resultado**: BD preparada y Eloquent funcionando.

### Actividad 5: Mostrar todos los artículos
* **Objetivo**: Crear una vista con todos los artículos
* **Tareas**:
    1. **Crea la ruta *articles* en el enrutador** `routes/web.php` que ejecute el método  `index()` del controlador de artículos (`ArticleController`).
    2. **Crea el método `index()` del controlador de artículos**. Debe recuperar con Eloquent todos los artículos de la base de datos y pasárselos a la vista `views/articles/index.blade.php`
    3. **Crea la vista** `views/articles/index.blade.php`, que recibirá la lista de artículos y los mostrará. Solo debe aparecer el título del artículo y la fecha. Puedes usar la misma vista de la [aplicación de gestión](https://github.com/avozme/productos) de productos para inspirarte.
* **Resultado**: Vista principal de artículos preparada

### Actividad 6: Mostrar un artículo

* **Objetivo**: Mostrar la información completa de un artículo al hacer clic en su título desde la lista general.
* **Tareas:**
    1. **Crea la ruta *articles/{id}* en el enrutador** `routes/web.php`. Ponle un nombre a la ruta: `->name('articles.show')`.
    2. **Añade el método `show($id)` al controlador de artículos**. Este método debe buscar el artículo $id con Eloquent y pasarlo a la vista `articles/show.blade.php` que vamos a crear enseguida.
    3. **Crea vista `articles/show.blade.php`** que muestre título, contenido, autor y fecha del artículo que se le ha pasado desde el controlador.
    4. **Modifica la vista `articles/index.blade.php`** que hicimos en el ejercicio anterior para que el título de cada artículo sea un link a la ruta de que has creado en este ejercicio. 
    
        Usa para ello `href = route('articles.show', $article->id)` en lugar de escribir la ruta a mano con `href = 'articles/$article->id'`. 
    
        Aunque ambas soluciones funcionarán, usar *route()* es mejor porque permite en el futuro cambiar los endpoints sin tener que modificar el código de la aplicación. 

* **Resultado**: Navegación completa entre el listado de artículos y la vista de detalle de cada uno.

### Actividad 7: Alta de nuevos artículos

* **Objetivo**: Crear nuevos artículos desde la aplicación, con mensajes de realimentación al usuario.
* **Tareas**:
    1. **Crea las nuevas rutas** en `routes/web.php`: *articles/create* (GET) y *articles* (POST). Asígnales un nombre con `->name()`: *articles.create* y *articles.store*.
    2. **Añade al controlador de artículos** estos dos métodos:
        * `create()` para mostrar el formulario (vista `views/articles/create.blade.php`).
        * `store()` para validar los datos del formulario (*title, body, date*, etc), guardar el artículo en la BD con Eloquent y redirigir a la lista de artículos con un mensaje de éxito o de error. Por el momento, que todos los artículos se guarden con el *user_id = 1*.
    3. **Crea vista `views/articles/create.blade.php`** con un formulario que incluya los campos de título, contenido y fecha. *Opcionalmente, muestra posibles errores de validación*.
    4. **Añade un enlace “Nuevo artículo”** en la vista *views/articles/index.blade.php* que lleve al formulario de creación que acabas de crear.
* **Resultado**: La aplicación permite ahora añadir artículos nuevos a la base de datos.

### Actividad 8: Borrado de artículos

* **Objetivo**: Añadir la posibilidad de borrar artículos, con confirmación y mensaje de éxito o error.
* **Tareas**:
    1. **Añade la ruta `DELETE /articles/{id}`** en `routes/web.php` con el nombre `articles.destroy`.
    2. **Crea método** `destroy($id)` en el controlador de artículos. Debe buscar el artículo, eliminarlo con Eloquent y redirigir a la lista de artículos con un mensaje de confirmación o de error en el borrado.
    3. **Añade a cada fila el botón "Eliminar"** en la vista `views/articles/index.blade.php`. Cada artículo debe tener su propio formulario HTML con method="POST" con un botón que envíe los campos `@method('DELETE')` y `@csrf`, para que el enrutador capture esa ruta. No dudes en inspirarte en la [aplicación de gestión de productos](https://github.com/avozme/productos) para inspirarte.
    4. **Muestra un mensaje de *feedback*** en la vista de lista de artículos (algo como "borrado con éxito" o "error al borrar") tras efectuar el borrado.
* **Resultado**: La aplicación puede ahora eliminar artículos.

### Actividad 9: Autenticación con Breeze

* **Objetivo**: Crear el login/logout y el alta de usuarios.
* **Tareas**:
    1. **Instala Laravel Breeze** para añadir un sistema de autenticación a tu aplicación. [Más info aquí](../laravel/sesiones.html#2124-laravel-breeze).
    2. **Prueba el registro de usuarios y el login/logout**.
    3. **Usa `@auth` y `@guest` en las vistas** que tienes construidas hasta ahora para mostrar contenido condicional: los usuarios autenticados verán su nombre y los enlaces para "Añadir" y "Borrar" artículos. Los usuarios no autenticados no verán esos enlaces. [Más info aquí](../laravel/sesiones.html#2124-laravel-breeze) .
    4. **Protege el controlador de artículos** para que solo los usuarios autenticados puedan acceder a los métodos que alteran la información (como `store()` y `destroy()`). Comprueba que funciona. [Más info aquí](../laravel/sesiones.html#2126-autenticaci%C3%B3n-y-middlewares-c%C3%B3mo-proteger-los-controladores) 
* **Resultado**: Sistema de login/registro funcional integrado en la aplicación.

### Actividad 10: Pulido final
* **Objetivo**: Consolidar la aplicación y probar el flujo completo.
* **Tareas**:
    1. Modifica la aplicación para que, al crear un artículo, se guarde el id del usuario autenticado (hasta ahora, todos los artículos se estaban guardando con *user_id = 1*).
    2. Revisa todos los formularios, mensajes al usuario y rutas en busca de posibles errores.
    3. Cambia la página de inicio (dashboard) para que, tras el login, vayamos al listado de artículos. Solo deben aparecer los artículos del usuario autenticado en ese momento.
    4. Añade la posibilidad de que un usuario autenticado modifique sus artículos, pero no los de los demás. Intenta reutilizar para ello la vista de añadir nuevos artículos en lugar de crear una nueva.
    5. Añade un poco de CSS  para hacer más atractivas las vistas. [Más info aquí](../laravel/vistas-blade.html#2712-a%C3%B1adir-css-y-javascript-a-nuestras-vistas).
    
* **Resultado**: Aplicación funcional de ejemplo, lista para extender con nuevas funcionalidades.
