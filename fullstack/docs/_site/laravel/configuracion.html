<h2 class="no_toc" id="23-arquitectura-convenciones-y-configuración-de-laravel">2.3. Arquitectura, convenciones y configuración de Laravel</h2>

<ul id="markdown-toc">
  <li><a href="#231-estructura-de-directorios" id="markdown-toc-231-estructura-de-directorios">2.3.1. Estructura de directorios</a></li>
  <li><a href="#232-convenciones-en-laravel" id="markdown-toc-232-convenciones-en-laravel">2.3.2. Convenciones en Laravel</a></li>
  <li><a href="#233-variables-de-entorno-el-archivo-env" id="markdown-toc-233-variables-de-entorno-el-archivo-env">2.3.3. Variables de entorno. El archivo .env</a></li>
</ul>

<p>Como cualquier framework, Laravel sigue una serie de <strong>convenciones</strong> para los identificadores, la estructura de directorios de la aplicación y la configuración.</p>

<p>Aunque no es imprescindible seguir esas convenciones, y puede resultar un poco enojoso las primeras veces (en plan: ¿pero por qué tengo que llamar a esa clase así, si quiero llamarla de otro modo?), a la larga el uso de convenciones ahorra muchísimo tiempo de desarrollo y, sobre todo, de depuración. ¿Cuántas veces no has estado depurando un error consistente en haber olvidado que el nombre de una tabla de la base de datos lo habías escrito en plural y no en singular, o al revés?</p>

<p><strong>“Convención sobre configuración”</strong> es un lema de muchos frameworks. Quiere decir que, si seguimos las convenciones del framework, tanto si nos gustan como si no, nos ahorraremos mucho tiempo de discusión sobre la configuración y muchos quebraderos de cabeza posteriormente.</p>

<h3 id="231-estructura-de-directorios">2.3.1. Estructura de directorios</h3>

<p>Después de una instalación limpia de Laravel, nos encotraremos con una estructura típica de directorios que hay que respetar.</p>

<p>Los más importantes (al menos, para empezar) son estos:</p>

<ul>
  <li>
    <p><strong>composer.json</strong>: información para <em>composer</em> (ya sabes, el gestor de dependencias PHP). Sirve para instalar todas las librerías que Laravel necesita para funcionar. Imprescindible para desplegar la aplicación en otro servidor.</p>
  </li>
  <li>
    <p><strong>/app</strong>: el código de nuestra aplicación. Aquí están los <strong>modelos</strong>.</p>

    <ul>
      <li><strong>/app/Http</strong>: peticiones HTTP, incluyendo los <strong>controladores</strong>.</li>
    </ul>
  </li>
  <li>
    <p><strong>/bootstrap</strong>: contiene el archivo <em>app.php</em>, punto de arranque de Laravel, y los archivos de cache. En general, no hay que tocar nada aquí.</p>
  </li>
  <li>
    <p><strong>/config</strong>: archivos de configuración de la aplicación.</p>
  </li>
  <li>
    <p><strong>/database</strong>: migraciones y <em>seeders</em> de la base de datos. Las migraciones son muy importantes y les dedicaremos un apartado más adelante.</p>
  </li>
  <li>
    <p><strong>/public</strong>: directorio de acceso público. Puedes crear aquí dentro carpetas para colocar <em>assets</em>: imágenes, scripts JS o archivos CSS que no te importe que sean accesibles libremente vía web.</p>
  </li>
  <li>
    <p><strong>/resources</strong>: Aquí dentro están las <strong>vistas</strong>. También el resto de <em>assets</em> (imágenes, css, js). A diferencia del directorio public, los archivos JS o CSS coloquemos aquí estarán precompilados y no serán accesibles vía web.</p>
  </li>
  <li>
    <p><strong>/routes</strong>: aquí están los archivos de enrutamiento. Hay archivos separados para en enrutamiento web, para el enrutamiento vía API, para el enrutamiento para consola, etc.</p>
  </li>
  <li>
    <p><strong>/storage</strong>: aquí Laravel guarda su memoria caché, información sobre las sesiones, vistas compiladas… No debes tocar esta carpeta para nada.</p>
  </li>
  <li>
    <p><strong>/vendors</strong>: librerías. Es <strong>importante</strong> añadir esta carpeta a <em>.gitignore</em> si vas a construir un repositorio git para tu aplicación Laravel, porque /vendors puede ocupar bastante espacio y no tiene sentido incluirla en tu proyecto.</p>

    <p>Cuando vayas a desplegar esta aplicación Laravel en otro servidor, basta con clonar el repositorio y ejecutar <code class="language-plaintext highlighter-rouge">composer update</code>. Eso <em>rellenará</em> la carpeta /vendor con las librerías adecuadas para ese servidor.</p>
  </li>
</ul>

<h3 id="232-convenciones-en-laravel">2.3.2. Convenciones en Laravel</h3>

<p>Laravel tiene un montón de convenciones que persiguen hacer más sencilla la configuración de la aplicación y evitar errores tontos que pueden consumir mucho tiempo de depuración.</p>

<p>Aunque la mayoría de estas convenciones no son obligatorias, es recomendable respetarlas para ahorrarte quebraderos de cabeza posteriores.</p>

<ul>
  <li>
    <p>En primer lugar, usa solo <strong>identificadores en inglés</strong>. Mejor <em>User</em> que <em>Usuario</em>. Así, de paso, practicas un poco el idioma universal de la informática.</p>
  </li>
  <li>
    <p><strong>Modelos</strong>: Los nombres de los modelos deben ser iguales a los de las tablas de la base de datos, pero en singular, en CamelCase y con mayúscula.</p>

    <p>Ejemplo: <em>RegisteredUser</em></p>
  </li>
  <li>
    <p><strong>Controladores</strong>: Llámalos como los modelos, pero añadiendo la palabra “controller”.</p>

    <p>Ejempo: <em>RegisteredUserController</em></p>
  </li>
  <li>
    <p><strong>Métodos</strong>: Se nombran en camelCase, empezando con minúscula (también llamado PascalCase).</p>

    <p>Ejemplo: <em>RegisteredUser::getAll()</em></p>
  </li>
  <li>
    <p><strong>Atributos</strong>: Se nombran en en snake_case y empezando con minúscula.</p>

    <p>Ejemplo: <em>RegisteredUser::first_name</em></p>
  </li>
  <li>
    <p><strong>Variables</strong>: Los identificadores deben ir en camelCase y empezando con minúscula. En plural si se trata de una colección y en singular si es un objeto individual o una variable simple.</p>

    <p>Ejemplos: <em>bannedUsers</em> (colección, en plural), <em>articleContent</em> (objeto individual, en sigular)</p>
  </li>
  <li>
    <p><strong>Tablas</strong>: Se nombran en plural y en snake_case.</p>

    <p>Ejemplo: registered_users.</p>
  </li>
  <li>
    <p><strong>Columnas de las tablas</strong>: Se nombran en snake_case, sin referencia al nombre de la tabla.</p>

    <p>Ejemplo: first_name</p>

    <ul>
      <li>
        <p><strong>Clave primaria</strong>: La llamaremos <em>id</em>. Siempre. No le des más vueltas. <em>id</em> y punto. El tipo: integer y <em>auto-increment</em>.</p>
      </li>
      <li>
        <p><strong>Claves ajenas</strong>: Se forman con el nombre de la tabla ajena en singular más la palabra <em>id</em>. Ejemplo: <em>article_id</em></p>
      </li>
      <li>
        <p><strong>Timestamps</strong>: Laravel siempre crea marcas de tiempo para todo. Y siempre se llaman <em>created_at</em> y <em>updated_at</em>, de tipo <em>datetime</em>. Acostúmbrate a tenerlas en todas tus tablas.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Tablas pivote</strong>: Son esas tablas horribles formadas como resultado de una relación N:N entre dos tablas maestras. Se nombran en snake_case, en plural y orden alfabético. Ejemplo: <em>articles_users</em> será el pivote entre las tablas <em>articles</em> y <em>users</em>.</p>
  </li>
</ul>

<h3 id="233-variables-de-entorno-el-archivo-env">2.3.3. Variables de entorno. El archivo .env</h3>

<p>En el directorio raíz de toda aplicación hecha con Laravel existe un archivo muy especial llamado <strong>.env</strong>. Ojo, porque en los sistemas tipo Linux, todos los archivos cuyo nombre empieza por un punto están <strong>ocultos</strong>. Debes buscar la opción para mostrar los archivos ocultos de tu navegador de archivos si quieres verlo.</p>

<blockquote>
  <blockquote>
    <p><em>NOTA: Una instalación limpia de Laravel no tendrá archivo .env, sino un .env.example que puedes renombrar y usar como base para construir tu propio .env</em></p>
  </blockquote>
</blockquote>

<p>El archivo <strong>.env</strong> contiene todas las variables de entorno que configuran la aplicación, como:</p>

<ul>
  <li>
    <p><strong>APP_ENV</strong>: En esta variable se indica si la aplicación está en desarrollo o en producción</p>
  </li>
  <li>
    <p><strong>APP_DEBUG</strong>: ¿Queremos mostrar los errores para depuración? Se pone a <em>true</em> durante el desarrollo y se cambia a <em>false</em> al pasar a producción.</p>
  </li>
  <li>
    <p><strong>APP_URL</strong>: La URL base de la aplicación. Hay que modificarla cuando movemos la aplicación a otro servidor.</p>
  </li>
  <li>
    <p><strong>DB_CONNECTION, DB_HOST, DB_USERNAME</strong>, etc. Es decir, la configuración de la conexión a la base de datos.</p>
  </li>
</ul>

<div style="color: red">
Cuidado: <i>el archivo .env NO debe sincronizarse con git</i> (o con el control de versiones que usemos) porque contiene información sensible. Asegúrate de incluirlo en tu .gitignore. Consulta la sección sobre Git de este mismo manual si no sabes como hacerlo.
</div>

<p>Si cambias el contenido del archivo .env, posiblemente necesites limpiar la cache de configuración de Laravel para que el servidor asuma esos cambios:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php artisan config:clear
</code></pre></div></div>

<p>Una vez creado nuestro archivo .env, podemos usar las variables definidas en él en cualquier otra parte de la aplicación. Por ejemplo, si necesitamos acceder al nombre del host de la base de datos podemos hacer:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$host</span> <span class="o">=</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'DB_HOST'</span><span class="p">,</span> <span class="s1">'localhost'</span><span class="p">);</span>
</code></pre></div></div>

<p>El primer parámetro de <em>env()</em> es la variable de entorno que queremos consultar y el segundo (optativo) es el valor por defecto en caso de que la variable no exista.</p>
