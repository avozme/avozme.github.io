I"2à<h2 class="no_toc" id="58-vistas-y-plantillas-blade">5.8. Vistas y plantillas. Blade</h2>

<ul id="markdown-toc">
  <li><a href="#581-master-layout" id="markdown-toc-581-master-layout">5.8.1. Master layout</a></li>
  <li><a href="#582-vistas-que-heredan-del-master-layout" id="markdown-toc-582-vistas-que-heredan-del-master-layout">5.8.2. Vistas que heredan del master layout</a></li>
  <li><a href="#583-c√≥mo-pasar-variables-a-las-vistas" id="markdown-toc-583-c√≥mo-pasar-variables-a-las-vistas">5.8.3. C√≥mo pasar variables a las vistas</a></li>
  <li><a href="#584-c√≥mo-usar-las-variables-en-las-vistas" id="markdown-toc-584-c√≥mo-usar-las-variables-en-las-vistas">5.8.4. C√≥mo usar las variables en las vistas</a></li>
  <li><a href="#585-condiciones-en-las-vistas" id="markdown-toc-585-condiciones-en-las-vistas">5.8.5. Condiciones en las vistas</a></li>
  <li><a href="#586-bucles-en-las-vistas" id="markdown-toc-586-bucles-en-las-vistas">5.8.6. Bucles en las vistas</a></li>
  <li><a href="#587-invocaci√≥n-de-funciones-php" id="markdown-toc-587-invocaci√≥n-de-funciones-php">5.8.7. Invocaci√≥n de funciones PHP</a></li>
  <li><a href="#588-otras-directivas-blade" id="markdown-toc-588-otras-directivas-blade">5.8.8. Otras directivas Blade</a></li>
  <li><a href="#589-tratamiento-de-formularios-con-blade" id="markdown-toc-589-tratamiento-de-formularios-con-blade">5.8.9. Tratamiento de formularios con Blade</a></li>
  <li><a href="#5810-validaci√≥n-de-formularios-con-blade" id="markdown-toc-5810-validaci√≥n-de-formularios-con-blade">5.8.10. Validaci√≥n de formularios con Blade</a></li>
  <li><a href="#5811-a√±adir-css-y-javascript-a-nuestras-vistas" id="markdown-toc-5811-a√±adir-css-y-javascript-a-nuestras-vistas">5.8.11. A√±adir CSS y Javascript a nuestras vistas</a></li>
  <li><a href="#5812-vistas-de-error-personalizadas" id="markdown-toc-5812-vistas-de-error-personalizadas">5.8.12. Vistas de error personalizadas</a></li>
</ul>

<p><strong>Blade es un poderoso y sencillo sub-lenguaje</strong> que nos permitir√° <strong>generar plantillas de vistas</strong> para minimizar el c√≥digo que necesitaremos para nuestras vistas.</p>

<p>Las plantillas Blade admiten condiciones y bucles para operar con las variables PHP, de modo que la misma plantilla se comporta de forma diferente con diferentes conjuntos de datos. ¬°Y se acab√≥ la pesadilla de abrir y cerrar comillas en las instrucciones <code class="language-plaintext highlighter-rouge">echo</code>!</p>

<p>Con Blade, tampoco ser√° necesario abrir y cerrar php (<code class="language-plaintext highlighter-rouge">&lt;?php ... ?&gt;</code>) para operar con las variables del servidor y generar la salida.</p>

<p>El c√≥digo escrito con Blade no solo es m√°s limpio y f√°cil de depurar que con PHP b√°sico, sino tambi√©n m√°s seguro, porque Blade impide cualquier ataque con XSS.</p>

<p>Pero es no es todo. Adem√°s, unas plantillas pueden heredar de otras para reutilizar mejor el c√≥digo.</p>

<p>As√≠ que Blade tiene un mont√≥n de ventajas y ning√∫n inconveniente. Bueno, s√≠ que tiene un inconveniente: que tienes que aprender a usarlo. Pero es tan sencillo que, cuando hayas trabajado con Blade un par de semanas, te preguntar√°s c√≥mo hab√≠as podido sobrevivir hasta ahora sin √©l.</p>

<h3 id="581-master-layout">5.8.1. Master layout</h3>

<p><strong><em>Layout</em></strong> es una forma gen√©rica de referirse al dise√±o de capas del interfaz de usuario de una aplicaci√≥n. Es decir, el <em>layout</em> de una aplicaci√≥n es el dise√±o de los elementos de su interfaz de usuario.</p>

<p><img src="/docs/dwes/_site/assets/images/07-ejemplos-de-layout.png" alt="Ejemplos de layout" />
<em>(Ejemplos de layout adaptados a diferentes tama√±os de pantalla. Imagen tomada de <a href="https://www.seobility.net/en/wiki/Media_Queries">Seobility.net</a> y publicada con licencia <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>)</em></p>

<p>El <strong><em>master layout</em></strong> es el dise√±o maestro del que derivan todas las vistas. Las aplicaciones web suelen tener un <em>master layout</em> muy definido, y todas las vistas de la aplicaci√≥n lo respetan.</p>

<p>Ese <em>master layout</em> suele almacenarse, por convenio, en un archivo llamado <em>/resources/views/layouts/master.blade.php</em></p>

<p>Vamos a construir un <em>master layout</em> de ejemplo. Ser√° muy simple, pero m√°s adelante puedes complicarlo todo lo que quieras, y cada modificaci√≥n afectar√° autom√°ticamente a todas las vistas de tu aplicaci√≥n.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;html&gt;</span>
     <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>@yield('Titulo')<span class="nt">&lt;/title&gt;</span>
     <span class="nt">&lt;/head&gt;</span>
     <span class="nt">&lt;body&gt;</span>
        @section('sidebar')
            Este es mi master sidebar.
        @show

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
            @yield('content')
        <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Aqu√≠ nos encontramos con varias <strong>directivas</strong> importantes de Blade:</p>

<ul>
  <li><strong>@yield(‚ÄòTitulo‚Äô)</strong> ‚Äì&gt; Esto define una secci√≥n llamada ‚ÄòT√≠tulo‚Äô, que en el master layout est√° vac√≠a. Las vistas que hereden del master layout tendr√°n que definir cu√°l es el valor de ‚ÄòT√≠tulo‚Äô, y ese valor aparecer√° escrito aqu√≠.</li>
  <li><strong>@section(‚Äòsidebar‚Äô)</strong> ‚Äì&gt; Esto define una secci√≥n llamada ‚Äòsidebar‚Äô que NO est√° vac√≠a (contiene el texto ‚ÄúEste es mi master sidebar‚Äù, pero podr√≠a contener cualquier otra cosa). Las vistas que hereden del master layout podr√°n A√ëADIR contenido a esta secci√≥n.</li>
  <li><strong>@show</strong> ‚Äì&gt; Hace que el contenido de la secci√≥n se muestre en ese punto del documento.</li>
  <li><strong>@yield(‚Äòcontent‚Äô)</strong> ‚Äì&gt; De nuevo, una secci√≥n que est√° vac√≠a en el master layout y cuyo contenido tendr√° que definirse en las vistas que hereden de esta.</li>
</ul>

<h3 id="582-vistas-que-heredan-del-master-layout">5.8.2. Vistas que heredan del master layout</h3>

<p>Despu√©s de crear nuestro <em>master layout</em>, lo siguiente es empezar a construir vistas que lo utilicen.</p>

<p>Es decir, que <strong>hereden</strong> de √©l todos sus componentes y a√±adan nuevos elementos, respetando la configuraci√≥n b√°sica establecida por el <em>master layout</em>.</p>

<p>El aspecto de una vista que herede del <em>master layout</em> de nuestro ejemplo anterior deber√≠a ser este:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@extends('master')

@section('title', 'Titulo de la p√°gina')

@section('sidebar')
    <span class="nt">&lt;p&gt;</span>Esto se a√±adir√° al master sidebar.<span class="nt">&lt;/p&gt;</span>
@endsection

@section('content')
    <span class="nt">&lt;p&gt;</span>Aqu√≠ va el contenido de mi p√°gina.<span class="nt">&lt;/p&gt;</span>
@endsection
</code></pre></div></div>

<p>De nuevo tenemos varias <em>directivas</em> de Blade muy importantes:</p>

<ul>
  <li><strong>@extends(‚Äòmaster‚Äô)</strong> ‚Äì&gt; Esto indica que esta vista hereda del master layout.</li>
  <li><strong>@section(‚Äòtitle, ‚ÄòT√≠tulo de la p√°gina‚Äô)</strong> ‚Äì&gt; Aqu√≠ se define el contenido de la secci√≥n ‚ÄòT√≠tulo‚Äô que en el master layout estaba vac√≠a.</li>
  <li><strong>@section(‚Äòsidebar‚Äô)</strong> ‚Äì&gt; Aqu√≠ a√±ade contenido a la secci√≥n ‚Äòsidebar‚Äô, que en el master layout no estaba vac√≠a.</li>
  <li><strong>@ensection</strong> ‚Äì&gt; Se emplea cuando el contenido de una secci√≥n ocupa varias l√≠neas de c√≥digo y no es posible escribirlo dentro de la propia directiva.</li>
</ul>

<h3 id="583-c√≥mo-pasar-variables-a-las-vistas">5.8.3. C√≥mo pasar variables a las vistas</h3>

<p>Las <strong>variables</strong> a las vistas deben enviarse <strong>empaquetadas en un array</strong>.</p>

<p>Hay varias formas de lograr esto, todas ellas correctas. Puedes emplear la que te resulte m√°s c√≥moda o m√°s elegante:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Forma 1: crear el array antes de llamar a la vista</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">'variable1'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'valor'</span><span class="p">;</span>
<span class="nv">$data</span><span class="p">[</span><span class="s1">'variable2'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'valor'</span><span class="p">;</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'vista'</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

<span class="c1">// Forma 2: crear un array con el constructor array()</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'vista'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'variable1'</span><span class="o">=&gt;</span><span class="s1">'valor'</span><span class="p">,</span> <span class="s1">'variable2'</span><span class="o">=&gt;</span><span class="s1">'valor'</span><span class="p">));</span>

<span class="c1">// Forma 3: crear un array con corchetes [] </span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'vista'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'variable1'</span><span class="o">=&gt;</span><span class="s1">'valor'</span><span class="p">,</span> <span class="s1">'variable2'</span><span class="o">=&gt;</span><span class="s1">'valor'</span><span class="p">]);</span>

<span class="c1">// Forma 4: usar el m√©todo with()</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'vista'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">with</span><span class="p">([</span><span class="s1">'variable1'</span><span class="o">=&gt;</span><span class="s1">'valor'</span><span class="p">,</span> <span class="s1">'variable2'</span><span class="o">=&gt;</span><span class="s1">'valor'</span><span class="p">]);</span>

<span class="c1">// Forma 5: usar la funci√≥n compact()</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'vista'</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">'variable1'</span><span class="p">,</span> <span class="s1">'variable2'</span><span class="p">));</span>
</code></pre></div></div>

<h3 id="584-c√≥mo-usar-las-variables-en-las-vistas">5.8.4. C√≥mo usar las variables en las vistas</h3>

<p>Vale, ya hemos enviado algunas variables a las vistas. Ahora, ¬øc√≥mo las usamos?</p>

<p>La vista no recibe el array con las variables, sino <strong>las variables ya extra√≠das del array</strong>. Esto significa que, si le pasas a una vista un par de variables como <code class="language-plaintext highlighter-rouge">['variable1'=&gt;'valor', 'variable2'=&gt;'valor']</code>, en la vista existir√°n dos variables llamadas <em>$variable1</em> y <em>$variable2</em>, y no encontrar√°s ni rastro del array que las conten√≠a.</p>

<p>Ve√°moslo con un ejemplo. Supongamos que tenemos este m√©todo en un controlador:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">show</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'page'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Manolo Escobar'</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>En la vista <em>/resources/views/page.blade.php</em> tendr√°s disponible una variable <em>$name</em>, y la puedes usar de este modo:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@extends('layouts.master')
   @section('title', 'Page Title')
   @section('sidebar')
      <span class="nt">&lt;p&gt;</span>Esto se a√±adir√° al sidebar del master layout.<span class="nt">&lt;/p&gt;</span>
   @endsection

   @section('content')
     <span class="nt">&lt;h2&gt;</span>{{$name}}<span class="nt">&lt;/h2&gt;</span>   
     <span class="nt">&lt;p&gt;</span>Este es el contenido de mi p√°gina.<span class="nt">&lt;/p&gt;</span>
   @endsection
</code></pre></div></div>

<p>Observa que hemos respetado el <em>master layout</em> de ejemplo que creamos m√°s arriba. Observa tambi√©n c√≥mo se hace el <em>echo</em> de la variable: nada de abrir y cerrar PHP (<code class="language-plaintext highlighter-rouge">&lt;?php ... ?&gt;</code>) ni de abrir y cerrar comillas: simplemente, se encierra la variable entre llaves dobles (<code class="language-plaintext highlighter-rouge">{{$variable}}</code>), y Laravel se encargar√° de traducir eso al <em>echo</em> correspondiente.</p>

<p>La vista queda de ese modo mucho m√°s limpia y, por lo tanto, es m√°s f√°cil de escribir, leer y depurar.</p>

<h3 id="585-condiciones-en-las-vistas">5.8.5. Condiciones en las vistas</h3>

<p>Blade admite <strong>expresiones condicionales</strong> para modificar el aspecto de una vista dependiendo del valor de una variable o del estado de la aplicaci√≥n.</p>

<p>Por supuesto, eso tambi√©n puede hacerse sin Blade: solo hay que usar un <em>if</em> de PHP. Pero con Blade es m√°s f√°cil y limpio porque, nuevamente, no tendremos que andar abriendo y cerrando PHP ni pele√°ndonos con las comillas del <em>echo</em>.</p>

<p>En el siguiente ejemplo, el contenido de la vista depende de la variable <em>$day</em> enviada desde el controlador. Observa como el <em>if</em> de PHP se sustituye por la directiva <em>@if</em> de Blade.</p>

<p>Controlador:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">show</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'page'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Manolo'</span><span class="p">,</span><span class="s1">'day'</span> <span class="o">=&gt;</span> <span class="s1">'Viernes'</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Vista <em>/resources/views/page.blade.php</em>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@extends('layouts.master')
   @section('title', 'Page Title')
   @section('sidebar')
      <span class="nt">&lt;p&gt;</span>Esto se a√±adir√° al sidebar del master layout.<span class="nt">&lt;/p&gt;</span>
   @endsection

   @section('content')
     <span class="nt">&lt;h2&gt;</span>{{$name}}<span class="nt">&lt;/h2&gt;</span>    
      <span class="nt">&lt;p&gt;</span>Este es el contenido de mi p√°gina.<span class="nt">&lt;/p&gt;</span>
      @if ($day == 'Viernes')
          <span class="nt">&lt;p&gt;</span>Hoy me roban el carro<span class="nt">&lt;/p&gt;</span>
      @else
          <span class="nt">&lt;p&gt;</span>Hoy me dedico a cantar<span class="nt">&lt;/p&gt;</span>
      @endif
   @endsection
</code></pre></div></div>

<h3 id="586-bucles-en-las-vistas">5.8.6. Bucles en las vistas</h3>

<p>Igual que existen condiciones, Blade tambi√©n permite hacer <strong>bucles</strong> para simplificar la generaci√≥n de visas.</p>

<p>Por ejemplo, en la siguiente vista recorremos un array llamado <em>$bebidas</em> y mostramos su contenido.</p>

<p>Controlador:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">show</span><span class="p">()</span> <span class="p">{</span>
   <span class="nv">$bebidas</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Cerveza'</span><span class="p">,</span><span class="s1">'Agua'</span><span class="p">,</span><span class="s1">'Zumo'</span><span class="p">);</span>
   <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'page'</span><span class="p">,</span><span class="k">array</span><span class="p">(</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'Manolo'</span><span class="p">,</span><span class="s1">'day'</span> <span class="o">=&gt;</span> <span class="s1">'Lunes'</span><span class="p">,</span>
                            <span class="s1">'bebidas'</span> <span class="o">=&gt;</span> <span class="nv">$bebidas</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Vista <em>/resources/views/page.blade.php</em>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@extends('layouts.master')
   @section('title', 'Page Title')
   @section('sidebar')
      <span class="nt">&lt;p&gt;</span>Esto se a√±adir√° al sidebar del master layout.<span class="nt">&lt;/p&gt;</span>
   @endsection

   @section('content')
     <span class="nt">&lt;h2&gt;</span>{{$name}}<span class="nt">&lt;/h2&gt;</span>    
      <span class="nt">&lt;p&gt;</span>Este es el contenido de mi p√°gina.<span class="nt">&lt;/p&gt;</span>
      @if ($day == 'Viernes')
          <span class="nt">&lt;p&gt;</span>Hoy me roban el carro<span class="nt">&lt;/p&gt;</span>
      @else
          <span class="nt">&lt;p&gt;</span>Hoy me dedico a cantar<span class="nt">&lt;/p&gt;</span>
      @endif
      <span class="nt">&lt;h2&gt;</span>Estas son las bebidas disponibles:<span class="nt">&lt;/h2&gt;</span>
      @foreach ($bebidas as $bebida)
         {{$bebida}} <span class="nt">&lt;br&gt;</span>
      @endforeach
   @endsection
</code></pre></div></div>

<p>Observa que, nuevamente, esto mismo podr√≠a hacerse con PHP cl√°sico, pero con Blade el c√≥digo queda mucho m√°s limpio y resulta menos propenso a errores.</p>

<h3 id="587-invocaci√≥n-de-funciones-php">5.8.7. Invocaci√≥n de funciones PHP</h3>

<p>Desde una vista Blade se puede <strong>invocar cualquier funci√≥n de PHP</strong> sin necesidad de abrirlo y cerrarlo (ya sabes: nada de <code class="language-plaintext highlighter-rouge">&lt;?php ... ?&gt;</code> en las vistas).</p>

<p>Por ejemplo, si necesitamos usar la funci√≥n <em>date()</em>, la invocamos as√≠:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h2&gt;</span>Ejemplo de llamada a funci√≥n est√°ndar de PHP<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;p&gt;</span>La fecha del servidor es: {{date(' D M, Y')}}<span class="nt">&lt;/p&gt;</span>
</code></pre></div></div>

<p>Esto no solo es m√°s limpio, sino tambi√©n m√°s seguro, porque Blade filtra posibles ataques por XSS.</p>

<p>(Por cierto: si alguna vez necesitas saltarte la protecci√≥n contra XSS, puedes usar {!! ‚Ä¶ !!} en lugar de  {{ ‚Ä¶ }}).</p>

<h3 id="588-otras-directivas-blade">5.8.8. Otras directivas Blade</h3>

<p>Blade dispone de multitud de directivas para hacer pr√°cticamente cualquier cosa en la vista sin tener que recurrir a PHP. En esta lista mostramos solo las directivas m√°s habituales.</p>

<ul>
  <li><strong>@section</strong> ‚Üí Marca el inicio de una secci√≥n de contenido.</li>
  <li><strong>@endsection</strong> ‚Üí Marca el final de una secci√≥n.</li>
  <li><strong>@show</strong> ‚Üí Marca el final de una secci√≥n y la muestra.</li>
  <li><strong>@yield(‚Äòsection‚Äô)</strong> ‚Üí Muestra el contenido de una secci√≥n (si existe, claro).</li>
  <li><strong>@extends(‚Äòview‚Äô)</strong> ‚Üí Hereda de una plantilla padre.</li>
  <li><strong>@parent</strong> ‚Üí Muestra el contenido de la secci√≥n del mismo nombre en la plantilla padre.</li>
  <li><strong>@include(‚Äòview‚Äô)</strong> ‚Üí Incluye una subvista.</li>
  <li><strong>@if - @else - @endif</strong> ‚Üí Condicional.</li>
  <li><strong>@for - @endfor</strong> ‚Üí Bucle for cl√°sico.</li>
  <li><strong>@foreach - @endforeach</strong> ‚Üí Buche foreach.</li>
  <li><strong>@forelse - @empty - @endforelse</strong> ‚Üí Como foreach, pero con tratamiento de arrays que vienen vac√≠os.</li>
  <li><strong>@break - @continue</strong> ‚Üí Para usar en los bucles.</li>
  <li><strong>@switch - @case - @break</strong> ‚Üí Condicional m√∫ltiple.</li>
  <li><strong>@isset($variable) - @endisset</strong> ‚Üí Comprueba si la variable existe.</li>
  <li><strong>@auth - @endauth</strong> ‚Üí La secci√≥n solo se muestra si hay un usuario autenticado en la aplicaci√≥n.</li>
  <li><strong>@php - @endphp</strong> ‚Üí Para a√±adir c√≥digo PHP plano. Usar con moderaci√≥n.</li>
  <li><strong>{{- Comment -}}</strong> ‚Üí Comentarios (no ser√°n renderizados).</li>
  <li><strong>{{ $variable }}</strong> ‚Üí Equivalente a echo $variable, pero no es necesario abrir y cerrar PHP, y nos protegemos contra inyecci√≥n de JS.</li>
  <li><strong>{{ $variable ?? texto-por-defecto }}</strong> ‚Üí Como el anterior, pero chequea si la variable existe. Si existe, muestra su valor. Si no, muestra 
texto-por-defecto.</li>
  <li><strong>$loop</strong> ‚Üí  Es una variable muy √∫til para usar en y/o depurar un foreach. Nos dice si estamos en el primer elemento, en el √∫ltimo, cu√°ntos loops llevamos, etc.</li>
</ul>

<h3 id="589-tratamiento-de-formularios-con-blade">5.8.9. Tratamiento de formularios con Blade</h3>

<p>Blade tambi√©n facilita un mont√≥n el <strong>tratamiento de los formularios</strong>. Y, por supuesto, filtra por nosotros cualquier c√≥digo malicioso que traten de colarnos a trav√©s de ellos.</p>

<p>Vamos a verlo con un ejemplo.</p>

<p>Imaginemos una vista con este formulario (f√≠jate c√≥mo indicamos la ruta en el <em>action</em>):</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"{{ route('mi-ruta') }}"</span><span class="nt">&gt;</span>
      @csrf   <span class="c">&lt;!-- Para evitar ataques CSRF --&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span><span class="nt">&gt;&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"asunto"</span><span class="nt">&gt;&lt;br&gt;</span>
      <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"contenido"</span><span class="nt">&gt;&lt;/textarea&gt;&lt;br&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Enviar<span class="nt">&lt;/button&gt;</span>
   <span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>Recuerda que los m√©todos PUT, PATCH y DELETE no existen a√∫n en HTML y que Laravel los simula con un campo oculto en el formulario que se crea con la directiva <strong>@method(‚ÄòPUT‚Äô)</strong> (o PATCH o DELETE). En este formulario no la hemos usado porque se env√≠a por POST.</p>

<p>Lo que s√≠ hemos usado es la directiva <strong>@csrf</strong>. Todos los formularios deber√≠an llevarla. Impide los ataques por CSRF, incrustado un token aleatorio en el formulario que Laravel se encargar√° de comprobar cuando los datos del formulario regresen al servidor. No te preocupes si no entiendes bien como funciona, por Laravel se encarga de hacerlo todo. T√∫ solo tienes que colocar la directiva @csrf en todos tus formularios.</p>

<p>En el enrutador, definiremos la ruta ‚Äúmi-ruta‚Äù del action del formulario:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Route</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s1">'mi-ruta'</span><span class="p">,</span> <span class="s1">'MiControlador@store'</span><span class="p">);</span>
</code></pre></div></div>

<p>Y, en el controlador, creamos el m√©todo <em>store()</em>. Observa c√≥mo recuperamos los datos del formulario a trav√©s de la variable $r:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$r</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s2">"email"</span><span class="p">);</span>
      <span class="nv">$asunto</span> <span class="o">=</span> <span class="nv">$r</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s2">"asunto"</span><span class="p">);</span>
      <span class="mf">...</span><span class="n">etc</span><span class="mf">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Esta es una forma alternativa para el controlador:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$email</span> <span class="o">=</span> <span class="nf">request</span><span class="p">(</span><span class="s2">"email"</span><span class="p">);</span>
    <span class="nv">$asunto</span> <span class="o">=</span> <span class="nf">request</span><span class="p">(</span><span class="s2">"asunto"</span><span class="p">);</span>
    <span class="mf">...</span><span class="n">etc</span><span class="mf">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="5810-validaci√≥n-de-formularios-con-blade">5.8.10. Validaci√≥n de formularios con Blade</h3>

<p>Otra cosa que Blade facilita much√≠simo es la <strong>validaci√≥n de formularios en el lado del servidor</strong>.</p>

<div style="font-size: 80%; margin-left: 5%; margin-right: 5%; background: #eee; color: #666">
<p>Aqu√≠ toca hacer un par√©ntesis para responder a esta pregunta: ¬ød√≥nde deber√≠an validarse los formularios? ¬øEn el cliente (con HTML y Javascript) o en el servidor (con PHP y Laravel)?</p>

<p>La respuesta es: en los dos sitios. Sobre todo si es un formulario con informaci√≥n sensible.</p>

<p>La validaci√≥n en el cliente es m√°s sencilla de hacer. Comprobar que un campo de texto de un formulario no se env√≠a vac√≠o, por ejemplo, es algo trivial con HTML. Y con Javascript es solo un poquito m√°s complicado.</p>

<p>Hacer esas comprobaciones en el servidor resulta m√°s trabajoso: hay que recibir el formulario, comprobar los valores de los campos y, si hay un error, tenemos que volver a enviar el formulario, pero respetando los datos que el usuario ya hubiera tecleado, todo ello junto con un mensaje informando del error.</p>

<p>S√≠, en el servidor es m√°s complicado. Pero tambi√©n m√°s seguro. Las validaciones en el cliente pueden desactivarse (puedo usar un navegador antiguo para evitar las comprobaciones por HTML, y puedo deshabilitar temporalmente el motor de Javascript), as√≠ que son una primera barrera defensiva muy convieniente pero poco segura.</p>

<p>Las comprobaciones en el servidor son imposibles de saltar para un atacante. As√≠ que deber√≠amos hacer los dos conjuntos de comprobaciones en todos nuestros formularios.</p>

<p>Y aqu√≠ es donde Laravel nos ayuda.</p>
</div>

<p>Vamos a retomar <strong>la vista</strong> del ejemplo anterior y a modificar el formulario para que se valide en el servidor. Tendr√≠amos que a√±adirle algunas cositas:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"{{ route('mi-ruta') }}"</span><span class="nt">&gt;</span>
      @if ($errors-&gt;any()) 
         @foreach ($errors-&gt;all() as $error)
             {{ $error }}<span class="nt">&lt;br&gt;</span>
         @endforeach
      @endif
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span><span class="nt">&gt;&lt;br&gt;</span>
      ...resto del formulario igual... 
   <span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>F√≠jate en c√≥mo mostramos los errores -si los hay- con un bucle. El objeto <em>$errors</em> (disponible en todas las vistas) tiene muchos m√°s m√©todos √∫tiles que puedes consultar en la documentaci√≥n de Laravel.</p>

<p>Y el <strong>controlador</strong> quedar√≠a as√≠. Observa c√≥mo definimos varias <strong>reglas de validaci√≥n</strong> para campos del formulario:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">request</span><span class="o">-&gt;</span><span class="nf">validate</span><span class="p">([</span>
         <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'required|email'</span><span class="p">,</span>
         <span class="s1">'asunto'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span>
      <span class="p">]);</span>
      <span class="c1">// A partir de aqu√≠, se procesa el formulario igual que antes</span>
</code></pre></div></div>

<p>Puedes consultar todas las reglas de validaci√≥n admitidas en <a href="https://laravel.com/docs/validation">https://laravel.com/docs/validation</a>.</p>

<p>Cuando vuelve a cargarse el formulario que conten√≠a un error, suele ser apropiado hacerlo con los datos que el usuario ya hab√≠a tecleado. A esto se le llama <strong>‚Äúrepopular‚Äù el formulario</strong>, y con Blade se hace as√≠ (observa el atributo <em>value</em> del campo <em>email</em>):</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"{{ route('mi-ruta') }}"</span><span class="nt">&gt;</span>
      @if ($errors-&gt;any()) 
         @foreach ($errors-&gt;all() as $error)
              {{ $error }}<span class="nt">&lt;br&gt;</span>
         @endforeach
      @endif
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"{{ old('email') }}"</span><span class="nt">&gt;&lt;br&gt;</span>
      ...resto del formulario igual... 
   <span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<h3 id="5811-a√±adir-css-y-javascript-a-nuestras-vistas">5.8.11. A√±adir CSS y Javascript a nuestras vistas</h3>

<p>Laravel ya trae dos archivos (<em>app.css</em> y <em>app.js</em>) basados en <strong>Boostrap</strong> para empezar a trabajar. Para usarlos, basta con a√±adir esto a la cabecera de nuestras vistas:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"/css/app.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/app.js"</span> <span class="na">defer</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p>Si queremos <strong>a√±adir reglas CSS</strong>, <em>NO debemos editar /public/app.css</em>, porque es un CSS compilado y minimizado con <strong><em>SASS</em></strong>. Lo correcto para a√±adir nuestro CSS a ese archivo es:</p>

<ol>
  <li>Editar <em>/resources/sass/app.css</em></li>
  <li>Recompilar este archivo con <em>SASS</em> (o con <em>less</em> o con <em>stylus</em>)</li>
</ol>

<p>La recompilaci√≥n se hace con este comando</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ npm run dev
</code></pre></div></div>

<p>O tambi√©n con:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ yarn dev
</code></pre></div></div>

<p>Si no tienes ni idea de lo que estamos hablando con esto de <em>less</em>, <em>SASS</em> y dem√°s zarandajas, tienes dos opciones: o te empapas un poco de ello antes de continuar (lamentablemente, en este manual no tenemos espacio para verlo TODO), o te olvidas de ellos y colocas tu CSS y tu Javascript en un directorio p√∫bico sin compilar ni nada.</p>

<p>Para lograr esto √∫ltimo, simplemente, guarda tu CSS y tu Javascript en el <strong>directorio /public</strong> de Laravel. En ese caso, los archivos no estar√≠an optimizados (tendr√≠amos que optimizarlos a mano, si queremos) y ser√≠an accesibles de forma p√∫blica. Pero es una soluci√≥n lo suficientemente buena para empezar.</p>

<p>Un consejo: si vas a colocar tu CSS y tu Javascript en /public, al menos crea subcarpetas para organizarlo un poco. Por ejemplo, /public/css y /public/js.</p>

<h3 id="5812-vistas-de-error-personalizadas">5.8.12. Vistas de error personalizadas</h3>

<p>Por √∫ltimo, te menciono un peque√±o truco para darle a tu aplicaci√≥n un toque m√°s profesional: <strong>personalizar las vistas de error</strong>.</p>

<p>Simplemente, crea una carpeta <em>/resources/views/errors</em>. Todas las vistas que metas ah√≠ dentro se considerar√°n pantallas de error.</p>

<p>Ahora solo tienes que ponerles los nombres adecuados.</p>

<p>Por ejemplo, si creas un archivo llamado <em>/resources/views/errors/404.blade.php</em>, esa vista se mostrar√° cada vez que ocurra un error 404 (p√°gina no encontrada). F√°cil, ¬øno?</p>

:ET