<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>8. El lenguaje SQL - PROG Y 3D</title> <link rel="shortcut icon" href="/docs/prog-y-3d/_site/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/prog-y-3d/_site/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/prog-y-3d/_site/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/prog-y-3d/_site/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>El lenguaje SQL | PROG Y 3D</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="El lenguaje SQL" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Apuntes de la asignatura “Introducción a la programación y al diseño 3D”, optativa de 2º curso de bachillerato ofertada por el IES Celia Viñas de Almería (España)" /> <meta property="og:description" content="Apuntes de la asignatura “Introducción a la programación y al diseño 3D”, optativa de 2º curso de bachillerato ofertada por el IES Celia Viñas de Almería (España)" /> <link rel="canonical" href="/docs/prog-y-3d/_site/lenguaje-sql/" /> <meta property="og:url" content="/docs/prog-y-3d/_site/lenguaje-sql/" /> <meta property="og:site_name" content="PROG Y 3D" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="El lenguaje SQL" /> <script type="application/ld+json"> {"@type":"WebPage","url":"/docs/prog-y-3d/_site/lenguaje-sql/","headline":"El lenguaje SQL","description":"Apuntes de la asignatura “Introducción a la programación y al diseño 3D”, optativa de 2º curso de bachillerato ofertada por el IES Celia Viñas de Almería (España)","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/docs/prog-y-3d/_site/" class="site-title lh-tight"> PROG Y 3D </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/" class="nav-list-link">Introd. a la prog. y al diseño 3D</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/presentacion/" class="nav-list-link">0. Presentación de la asignatura</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/pensamiento-computacional/" class="nav-list-link">1. Pensamiento computacional</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/representacion-de-la-informacion/" class="nav-list-link">2. Representación de la información</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/introduccion-a-la-programacion/" class="nav-list-link">3. Introducción a la programación</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/estructuras-de-datos/" class="nav-list-link">4. Estructuras de datos. Subalgoritmos</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/javascript/" class="nav-list-link">5. Lenguaje Javascript</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/orientacion-a-objetos/" class="nav-list-link">6. Orientación a objetos</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/bases-de-datos/" class="nav-list-link">7. Bases de datos</a><ul class="nav-list"></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/lenguaje-sql/" class="nav-list-link active">8. El lenguaje SQL</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/seguridad-y-privacidad/" class="nav-list-link">9. Seguridad y privacidad</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/tecnologias-de-impresion-3d/" class="nav-list-link">10. Tecnologías de impresión 3D</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/prog-y-3d/_site/modelado-e-impresion-3d/" class="nav-list-link">11. Modelado e impresión 3D</a><ul class="nav-list"></ul></li></ul></li><li class="nav-list-item"><a href="/docs/prog-y-3d/_site/about/" class="nav-list-link">About</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search PROG Y 3D" aria-label="Search PROG Y 3D" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/prog-y-3d/_site/">Introd. a la prog. y al diseño 3D</a></li> <li class="breadcrumb-nav-list-item"><span>8. El lenguaje SQL</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="8-el-lenguaje-sql"> <a href="#8-el-lenguaje-sql" class="anchor-heading" aria-labelledby="8-el-lenguaje-sql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. El lenguaje SQL </h1> <ul id="markdown-toc"> <li><a href="#81-introducción-a-sql" id="markdown-toc-81-introducción-a-sql">8.1. Introducción a SQL</a> <ul> <li><a href="#811-breve-historia-de-sql" id="markdown-toc-811-breve-historia-de-sql">8.1.1. Breve historia de SQL</a></li> <li><a href="#812-dialectos-de-sql" id="markdown-toc-812-dialectos-de-sql">8.1.2. Dialectos de SQL</a></li> <li><a href="#813-sql-un-lenguaje-para-todo" id="markdown-toc-813-sql-un-lenguaje-para-todo">8.1.3. SQL, un lenguaje para todo</a></li> </ul> </li> <li><a href="#82-creando-la-estructura-lenguaje-de-definición-de-datos" id="markdown-toc-82-creando-la-estructura-lenguaje-de-definición-de-datos">8.2. Creando la estructura: lenguaje de definición de datos</a> <ul> <li><a href="#821-creación-de-tablas-create-table" id="markdown-toc-821-creación-de-tablas-create-table">8.2.1. Creación de tablas: CREATE TABLE</a></li> <li><a href="#822-modificación-de-tablas-alter-table" id="markdown-toc-822-modificación-de-tablas-alter-table">8.2.2. Modificación de tablas: ALTER TABLE</a></li> <li><a href="#823-borrado-de-tablas-drop-table" id="markdown-toc-823-borrado-de-tablas-drop-table">8.2.3. Borrado de tablas: DROP TABLE</a></li> <li><a href="#824-algunas-consideraciones-sobre-la-integridad-referencial" id="markdown-toc-824-algunas-consideraciones-sobre-la-integridad-referencial">8.2.4. Algunas consideraciones sobre la integridad referencial</a></li> </ul> </li> <li><a href="#83-usando-los-datos-lenguaje-de-manipulación-de-datos" id="markdown-toc-83-usando-los-datos-lenguaje-de-manipulación-de-datos">8.3. Usando los datos: lenguaje de manipulación de datos</a> <ul> <li><a href="#831-inserción-de-datos-insert" id="markdown-toc-831-inserción-de-datos-insert">8.3.1. Inserción de datos: INSERT</a></li> <li><a href="#832-modificación-de-datos-update" id="markdown-toc-832-modificación-de-datos-update">8.3.2. Modificación de datos: UPDATE</a></li> <li><a href="#833-borrado-de-datos-delete" id="markdown-toc-833-borrado-de-datos-delete">8.3.3. Borrado de datos: DELETE</a></li> </ul> </li> <li><a href="#84-consultas-las-instrucción-select" id="markdown-toc-84-consultas-las-instrucción-select">8.4. Consultas. Las instrucción SELECT</a> <ul> <li><a href="#841-seleccionar-columnas-de-una-tabla" id="markdown-toc-841-seleccionar-columnas-de-una-tabla">8.4.1. Seleccionar columnas de una tabla</a></li> <li><a href="#842-filtrar-resultados-la-cláusula-where" id="markdown-toc-842-filtrar-resultados-la-cláusula-where">8.4.2. Filtrar resultados: la cláusula WHERE</a></li> <li><a href="#843-búsquedas-aproximadas-con-caracteres-comodín" id="markdown-toc-843-búsquedas-aproximadas-con-caracteres-comodín">8.4.3. Búsquedas aproximadas con caracteres comodín</a></li> <li><a href="#844-ordenar-resultados-con-order-by" id="markdown-toc-844-ordenar-resultados-con-order-by">8.4.4. Ordenar resultados con ORDER BY</a></li> <li><a href="#845-agrupar-resultados-con-distinct" id="markdown-toc-845-agrupar-resultados-con-distinct">8.4.5. Agrupar resultados con DISTINCT</a></li> <li><a href="#846-funciones-de-agregado-y-group-by" id="markdown-toc-846-funciones-de-agregado-y-group-by">8.4.6. Funciones de agregado y GROUP BY</a></li> <li><a href="#847-obtener-resultados-de-varias-tablas-join" id="markdown-toc-847-obtener-resultados-de-varias-tablas-join">8.4.7. Obtener resultados de varias tablas: JOIN</a></li> <li><a href="#848-sql-avanzado-introducción-a-las-subconsultas" id="markdown-toc-848-sql-avanzado-introducción-a-las-subconsultas">8.4.8. SQL avanzado: introducción a las subconsultas</a></li> <li><a href="#849-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas" id="markdown-toc-849-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas">8.4.9. Otras cuestiones avanzadas: alias y combinaciones de consultas</a></li> </ul> </li> <li><a href="#85-y-cómo-puedo-probar-todo-esto" id="markdown-toc-85-y-cómo-puedo-probar-todo-esto">8.5. ¿Y cómo puedo probar todo esto?</a></li> <li><a href="#86-ejercicios-propuestos" id="markdown-toc-86-ejercicios-propuestos">8.6. Ejercicios propuestos</a></li> <li><a href="#87-ejercicios-resueltos" id="markdown-toc-87-ejercicios-resueltos">8.7. Ejercicios resueltos</a></li> </ul> <p>Ya sabemos cómo crear bases de datos para nuestros programas a partir del mundo real: diseñamos un diagrama entidad-relación, lo refinamos, lo pasamos a tablas relacionales y, por último, revisamos esas tablas hasta que queden normalizadas.</p> <p>Sí, lo sé: es un proceso largo y aburrido, pero la base de datos es el cimiento de muchas aplicaciones. Por ejemplo, la inmensa mayoría de las aplicaciones web están basadas en una base de datos. Equivócate en el diseño de esa base de datos, y el resto de la aplicación jamás funcionará bien, por mucho empeño que pongas en el proceso de implementación.</p> <p>Así que vale la pena dedicar un tiempo al diseño de la base de datos.</p> <p>¿Y luego qué?</p> <p>Bien, luego tienes que <strong>acceder a esa base de datos para operar con ella</strong>: insertar datos, modificarlos, borrarlos y, lo más habitual de todo, buscar información y recuperarla para que tu programa (aplicación web o lo que sea) la use.</p> <p>Para hacer todo eso existe un lenguaje estandarizado que soportan la mayoría de las bases de datos relaciones. Puede que tu nombre te suene: se llama <strong>SQL</strong>, y vamos a dedicar todo este capítulo a aprenderlo</p> <h2 id="81-introducción-a-sql"> <a href="#81-introducción-a-sql" class="anchor-heading" aria-labelledby="81-introducción-a-sql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.1. Introducción a SQL </h2> <h3 id="811-breve-historia-de-sql"> <a href="#811-breve-historia-de-sql" class="anchor-heading" aria-labelledby="811-breve-historia-de-sql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.1.1. Breve historia de SQL </h3> <p><strong>SQL (Structured Query Language)</strong> es un lenguaje bastante antiguo en términos informáticos, porque su origen se remonta a 1970:</p> <ul> <li>1970: Edgar Frank Codd propone el modelo relacional y un <strong>lenguaje de acceso al mismo</strong> basado en el <strong>álgebra relacional</strong>.</li> <li>1977: IBM crea el lenguaje <strong>SEQUEL</strong>, basado en la teoría de Codd, para un SGBD experimental.</li> <li>1979: Oracle utiliza un derivado de SEQUEL por primera vez en un producto comercial. Se cambió su nombre a SQL (Structured Query Language) porque SEQUEL ya estaba registrado como marca comercial.</li> <li>1980: IBM lanza varios gestores de bases de datos, entre ellos el exitoso <strong>DB2</strong>, basados en SQL.</li> <li>Década de 1980: SQL tiene un éxito espectacular y cada fabricante de bases de datos utiliza su propio dialecto. Se hace patente la necesidad de una estandarización.</li> <li>1986: Nace <strong>SQL-86</strong>, el primer estándar del lenguaje. Fue publicado por ANSI. ISO lo confirmó en 1987, por lo que a veces se denomina SQL-87.</li> </ul> <p>A partir de entonces, SQL se ha convertido en el lenguaje universal para acceso a bases de datos relacionales y su estándar ha sido revisado continuamente, dando lugar a diferentes versiones: SQL-89, SQL-92, SQL-99, SQL-2003, etc. La revisión más reciente, en el momento de escribir estas líneas, es SQL-2016.</p> <h3 id="812-dialectos-de-sql"> <a href="#812-dialectos-de-sql" class="anchor-heading" aria-labelledby="812-dialectos-de-sql"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.1.2. Dialectos de SQL </h3> <p>A pesar de que SQL se estandarizó hace mucho tiempo, los SGBD comerciales respetan solo aproximadamente ese estándar.</p> <p>Es decir, todos incluyen mejoras y añadidos sobre SQL para tratar de superar a los competidores. Estos añadidos son incompatibles entre diferentes SGBD.</p> <p>Por ese motivo, podemos hablar de <strong><em>dialectos</em> de SQL</strong>.</p> <p>Si queremos que nuestra base de datos sea portable, hay intentar respetar al máximo el estándar SQL.</p> <h3 id="813-sql-un-lenguaje-para-todo"> <a href="#813-sql-un-lenguaje-para-todo" class="anchor-heading" aria-labelledby="813-sql-un-lenguaje-para-todo"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.1.3. SQL, un lenguaje para todo </h3> <p>Como vimos en el capítulo anterior, los SGBD relacionales tienen varios lenguajes incorporados:</p> <ul> <li><strong>Lenguaje de definición de datos (DDL)</strong>: nos permite crear la representación lógica de los datos y sus relaciones.</li> <li><strong>Lenguaje de control de datos (DCL)</strong>: sirve para gestionar los permisos de acceso.</li> <li><strong>Lenguaje de control de transacciones (TCL)</strong>: se utiliza para asegurar la integridad de los datos.</li> <li><strong>Lenguaje de manipulación de datos (DML)</strong>: nos permite insertar datos, borrarlos, modificarlos, etc.</li> </ul> <p>Una de las grandes bazas de SQL es que él solito se las apaña para hacer todas estas cosas.</p> <p>Otro aspecto increíble de SQL es que <strong>no es un lenguaje imperativo</strong>, es decir, no tienes que indicarle cómo hacer las cosas escribiendo algoritmos tradicionales. Más bien, a SQL le dices <em>el resultado que quieres obtener</em> y él se encarga de generar un algoritmo para obtenerlo de forma totalmente transparente.</p> <h2 id="82-creando-la-estructura-lenguaje-de-definición-de-datos"> <a href="#82-creando-la-estructura-lenguaje-de-definición-de-datos" class="anchor-heading" aria-labelledby="82-creando-la-estructura-lenguaje-de-definición-de-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.2. Creando la estructura: lenguaje de definición de datos </h2> <p>El <strong>DDL o lenguaje de definición de datos</strong> es un lenguaje pensado para crar la estructura lógica de la base de datos.</p> <p>Dicho en otras palabras, el DDL nos permite <strong>crear las tablas, modificarlas y borrarlas</strong>.</p> <p>SQL, como hemos dicho, incluye instrucciones para implemental el DDL. En concreto, las instrucciones más importantes del DDL de SQL son estas tres:</p> <ul> <li><strong>CREATE TABLE</strong>: para crear tablas.</li> <li><strong>ALTER TABLE</strong>: para modificar una tabla existente.</li> <li><strong>DROP TABLE</strong>: para eliminar tablas.</li> </ul> <p>Escribiremos, a partir de ahora, las palabras reservadas de SQL en MAYÚSCULA por convenio y para distinguirlas del resto. Realmente, SQL no distingue mayúsculas de minúsculas, así que puedes escribirlas como prefieras.</p> <h3 id="821-creación-de-tablas-create-table"> <a href="#821-creación-de-tablas-create-table" class="anchor-heading" aria-labelledby="821-creación-de-tablas-create-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.2.1. Creación de tablas: CREATE TABLE </h3> <p>La instrucción <strong>CREATE TABLE</strong> sirve para <strong>crear tablas</strong> en la base de datos. Tiene muchísimas posibilidades. No es mi intención mostrártelas todas, porque para eso necesitarías un curso de SQL avanzado. Pero, a través de algunos ejemplos, aprenderás a usarla a un nivel básico enseguida.</p> <p>La <strong>sintaxis básica</strong> (que admite montones de añadidos, pero que raramente usarás, al menos al principio) es esta:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">nombre_de_tabla</span> <span class="p">(</span>
    <span class="n">columna1</span> <span class="n">tipo</span><span class="p">,</span>
    <span class="n">columna2</span> <span class="n">tipo</span><span class="p">,</span>
    <span class="n">columna3</span> <span class="n">tipo</span><span class="p">,</span>
    <span class="n">etc</span><span class="p">.</span>
<span class="p">);</span>
</code></pre></div></div> <p>Por ejemplo, así se <strong>crea una tabla</strong> de <em>clientes</em>:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div> <p>SQL maneja multitud de <strong>tipos de datos</strong>, pero por ahora basta con que conozcas estos:</p> <ul> <li><strong>INTEGER</strong> = números enteros. Hay varios subtipos, como BIGINT (entero enorme), SMALLINT (entero pequeño), etc. Se diferencian entre sí por el número más grande que son capaces de almacenar. La mayoría de las veces, INTEGER es más que suficiente.</li> <li><strong>VARCHAR</strong> = cadenas de caracteres (se indica la longitud máxima entre paréntesis).</li> <li><strong>CHAR</strong> = cadenas de caracteres. Se diferencia de VARCHAR en que, si no se usan todos los caracteres, se rellenan con espacios. Con los VARCHAR no sucede eso: los caracteres que no se usan, simplemente, no existen. Ante la duda, usa siempre VARCHAR en lugar de CHAR.</li> <li><strong>DECIMAL</strong> = números reales (se indica entre paréntesis la cantidad de cifras antes y después de la coma decimal)</li> <li><strong>DATE</strong> = fechas.</li> <li><strong>TIME</strong> = horas.</li> <li><strong>DATETIME</strong> = fecha y hora.</li> <li><strong>BLOB</strong> = información binaria así, en general. Los campos BLOB pueden usarse para guardar imágenes, archivos ejecutables, secuencias de vídeo o de audio…</li> <li><strong>TEXT</strong> = información de texto de grandes dimensiones, que no nos quepa dentro de un VARCHAR o un CHAR.</li> </ul> <p>Ahora vamos a utilizar <strong>algunos modificadores</strong> en la tabla <em>clientes</em>:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="k">COLLATE</span> <span class="n">utf8</span><span class="o">-</span><span class="n">spanish</span><span class="o">-</span><span class="n">ci</span><span class="p">;</span>
</code></pre></div></div> <p>Fíjate en que hemos añadido algunas cosas a algunas columnas:</p> <ul> <li><strong>NOT NULL</strong> significa que ese campo no puede quedarse en blanco, es decir, que todos los clientes deben tener obligatoriamente un valor asignado en ese campo.</li> <li><strong>UNIQUE</strong> significa que el valor de ese campo no puede repetirse, esto es, que debe ser diferente en todos los clientes de la tabla.</li> <li><strong>AUTO_INCREMENT</strong> hace que la base de datos, cada vez que se inserta un registro, asigne a este campo el número entero inmediatamente superior al que se asignó al último registro insertado. Solo funciona con campos de tipo INTEGER. Suele utilizarse en el campo ID de las tablas para no tener que ocuparnos de insertar nosotros un número manualmente.</li> <li><strong>PRIMARY KEY</strong> especifica cual es la clave primaria de la tabla. Pueden ponerse varios campos, separados por comas. Lo lógico es que la clave sea NOT NULL y UNIQUE al mismo tiempo.</li> </ul> <p>También hemos añadido algunos modificadores que afectan a toda la tabla, no solo a algunos campos:</p> <ul> <li><strong>CHARACTER SET</strong> indica la condificación de caracteres que va a usarse en la tabla.</li> <li><strong>COLLATE</strong> indica cómo van a ordenarse los caracteres en la tabla. Por ejemplo, usando utf8-spanish-ci nos aseguramos de que la Ñ va entre la N y la P. Si usásemos otras colaciones, la Ñ se ordenaría después de la Z.</li> </ul> <p>Los modificadores que se pueden emplear con un CREATE TABLE son muy numerosos, pero la mayoría se usan con muy poca frecuencia. Los principales son los que hemos visto en este ejemplo.</p> <p>Otro modificadorde uso frecuente es el que se emplea para la creación de <strong>claves ajenas</strong>. Obsérvalo en este otro ejemplo:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
   <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
   <span class="n">id_ciudad</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
   <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_ciudad</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">ciudades</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf</span><span class="o">-</span><span class="mi">8</span> <span class="k">COLLATE</span> <span class="n">utf8</span><span class="o">-</span><span class="n">spanish</span><span class="o">-</span><span class="n">ci</span><span class="p">;</span>
</code></pre></div></div> <p>Hemos añadido el campo <em>id_ciudad</em> que, obviamente, es una clave ajena que pertenece a la tabla <em>ciudades</em>. Pues bien, para informar a la base de datos que ese campo, en efecto, es una clave ajena, hay que usar FOREIGN KEY, indicándole la tabla (<em>ciudades</em>) y el campo (<em>id</em>) al que está enlazada nuestra clave ajena.</p> <p>Por último, debes saber que tanto a restricción de clave primaria como a las restricciones de claves ajenas puede <strong>asignárseles un nombre</strong>. Esto es importante si luego queremos modificar esas claves sin necesidad de borrar toda la tabla (con la consiguiente pérdida de datos) para volver a crearla. Se hace así:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clientes</span> <span class="p">(</span>
   <span class="p">...</span>
   <span class="k">CONSTRAINT</span> <span class="n">pk_clientes</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
   <span class="k">CONSTRAINT</span> <span class="n">fk_clientes_ciudades</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_ciudad</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">ciudades</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div> <p>Como ves, basta con añadir <strong>CONSTRAINT nombre</strong> a la restricción de clave primaria o de clave ajena. Esto asigna un nombre a esa restricción para poder referirnos a él más adelante (ver ALTER TABLE).</p> <p>El nombre para las restricciones de clave primaria suele empezar por las letras <em>pk_</em> (de “primary key”) y el de las restricciones de clave ajena por <em>fk_</em> (de “foreign key”), pero esto solo es una convención que no tienes por qué respetar.</p> <h3 id="822-modificación-de-tablas-alter-table"> <a href="#822-modificación-de-tablas-alter-table" class="anchor-heading" aria-labelledby="822-modificación-de-tablas-alter-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.2.2. Modificación de tablas: ALTER TABLE </h3> <p>La <strong>modificación de la estructura de una tabla</strong> que ya existe se hace con la instrucción <strong>ALTER TABLE</strong>.</p> <p>Vamos a ver cómo trabaja esta instrucción con unos ejemplos basado en la tabla <em>clientes</em> del apartado anterior. De nuevo, ALTER TABLE tiene muchísimas opciones, pero las que te voy a mostrar en estos ejemplos cubren el 99% de los usos habituales.</p> <p>En primer lugar, si queremos <strong>añadir un campo</strong> (o varios) a una tabla ya existente, haremos esto:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">clientes</span>
    <span class="k">ADD</span> <span class="n">telefono</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div></div> <p>También podemos <strong>eliminar un campo</strong> (o columna) existente (cuidado: todos los datos de ese campo se perderán):</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">clientes</span>
    <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">email</span><span class="p">;</span>
</code></pre></div></div> <p>Podemos, asimismo, <strong>renombrar campos</strong>:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">clientes</span>
    <span class="k">RENAME</span> <span class="k">COLUMN</span> <span class="n">email</span> <span class="k">TO</span> <span class="n">correo_electronico</span><span class="p">;</span>
</code></pre></div></div> <p>O podemos <strong>modificar campos</strong>, cambiando su tipo o sus restricciones (¡Ojo! Esto puede afectar a los datos que haya almacenados en ese campo, si la tabla ya tiene datos, puesto que el SGBD intentará convertirlos de un tipo de dato a otro. Si no lo consigue, la instrucción fallará):</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="n">telefono</span> <span class="nb">INTEGER</span><span class="p">;</span>
</code></pre></div></div> <p>Por último, con ALTER TABLE se pueden <strong>crear o borrar las restricciones</strong> de la tabla, tales como claves primarias o claves ajenas.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">pk_clientes</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</code></pre></div></div> <p>Para borrar una restricción, tendremos que haberles asignado un nombre al crear la tabla. Así:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">pk_clientes</span><span class="p">;</span>
</code></pre></div></div> <h3 id="823-borrado-de-tablas-drop-table"> <a href="#823-borrado-de-tablas-drop-table" class="anchor-heading" aria-labelledby="823-borrado-de-tablas-drop-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.2.3. Borrado de tablas: DROP TABLE </h3> <p>El <strong>borrado de tablas</strong> se hace en sql con la instrucción <strong>DROP TABLE</strong>. Es muy fácil de usar, puesto que solo hay que indicar el nombre de la tabla que queremos borrar.</p> <p>¡Mucho cuidado! Esta acción es destructiva y perderás todos los datos que hubiera almacenados en esa tabla.</p> <p>Por ejemplo, para borrar la tabla <em>clientes</em> de los ejemplos anteriores, escribiríamos esto:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">clientes</span><span class="p">;</span>
</code></pre></div></div> <h3 id="824-algunas-consideraciones-sobre-la-integridad-referencial"> <a href="#824-algunas-consideraciones-sobre-la-integridad-referencial" class="anchor-heading" aria-labelledby="824-algunas-consideraciones-sobre-la-integridad-referencial"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.2.4. Algunas consideraciones sobre la integridad referencial </h3> <p>La <strong>integridad referencial</strong> es un mecanismo de seguridad de las bases de datos que asegura que la información entre las claves ajenas y las claves primarias a las que hacen referencia permanezca siempre bien sincronizada.</p> <p>Enseguida pondremos un ejemplo en el que lo entenderás muy bien. Ahora lo importante es que quede claro esto: perder esa sincronización entre clave ajena y clave primaria (es decir, romper la integridad referencial) es equivalente a perder datos. Y, si una base de datos va por ahí perdiendo datos, ¿para qué narices sirve?</p> <h4 id="entendiendo-qué-es-la-integridad-referencial"> <a href="#entendiendo-qué-es-la-integridad-referencial" class="anchor-heading" aria-labelledby="entendiendo-qué-es-la-integridad-referencial"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entendiendo qué es la integridad referencial </h4> <p>En el siguiente ejemplo se ve muy bien en qué consiste la <strong>pérdida de integridad referencial</strong> y los problemas de pérdida de datos que causa.</p> <p>Imaginemos dos tablas de una base de datos más grande (por ejemplo, de una biblioteca): la tabla <strong><em>libros</em></strong> contiene información sobre los libros (<em>cod_libro</em> y <em>título</em>, entre otros campos), mientras que la tabla <strong><em>autores</em></strong> contiene información sobre los autores de los libros (<em>cod_autor</em> y <em>nombre</em>, entre otros campos).</p> <p>La tabla <em>libros</em> tiene una clave ajena, <em>cod_autor</em>, que es un campo que en realidad pertenece a la tabla <em>autores</em> pero que expandimos hasta <em>libros</em> para implementar la relación 1:N entre ambas entidades. ¡Repasa el capítulo anterior, sobre diseño de bases de datos, si no sabes de lo que estamos hablando!</p> <p>(En realidad, la relación entre <em>libros</em> y <em>autores</em> es N:N, porque un libro puede ser escrito por muchos autores y cada autor puede escribir muchos libros, pero aquí la consideramos una 1:N para simplificar el ejemplo)</p> <p>Este es el aspecto que podrían tener esas dos tablas o, al menos, un fragmento de ellas:</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial.png" alt="Ejemplo de integridad referencial" /></p> <p>No hay que se un lince para darse cuenta de que todos los códigos de autor que aparecen en la tabla <em>libros</em> se corresponden con autores que <strong>realmente existen</strong> en la tabla <em>autores</em>.</p> <p>¿Pero qué pasaría si, por cualquier razón, un código de autor inexistente acabase por error en la tabla de <em>libros</em>? Entonces tendríamos algo como esto:</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-rota.png" alt="Ejemplo de integridad referencial rota" /></p> <p>Ahí lo tenemos: el libro 484 (“Ana Karenina”) está asociado al autor 32, que <em>no existe en la tabla de autores</em>. ¿El resultado? <strong>Hemos perdido información</strong>. Ya no hay manera de saber quién escribió ese libro. Es lo mismo que si hubiésemos borrado un registro, o parte de un registro, de una tabla, aunque en realidad nadie ha borrado nada.</p> <p>Te puedes estar diciendo: “Sí, claro, ¿pero quién va a ser tan idiota de escribir un código que no existe en el campo <em>cod_autor</em>?”</p> <p>Hay cientos de razones por las que el código equivocado puede acabar asignado a una clave ajena: puede tratarse de un error de programación en la aplicación cliente, puede haber un fallo de comunicaciones, puede ocurrir un problema de concurrencia, puede que alguien elimine, a propósito o sin querer, un autor que ya tenía libros asignados.</p> <p>Y sí, también hay gente idiota en el mundo, esto es incuestionable. Y algunos podrían acabar usando nuestra base de datos.</p> <p>Como el problema de la integridad referencial es tan frecuente y potencialmente devastador, <strong>las bases de datos se autoprotegen e impiden que la integridad referencial pueda violarse</strong>.</p> <p>El efecto colateral de esta obsesión por la protección de los datos es que <em>no podrás insertar los datos en cualquier orden</em>. En el ejemplo anterior, tendrás que insertar primero al autor del libro en la tabla <em>autores</em> y luego al libro en la tabla <em>libros</em>, y no al revés, porque en tal caso estarías violando la integridad referencial.</p> <h4 id="borrado-en-cascada"> <a href="#borrado-en-cascada" class="anchor-heading" aria-labelledby="borrado-en-cascada"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Borrado en cascada </h4> <p>El <strong>borrado en cascada</strong> es una de las formas que tiene la base de datos de proteger la integridad referencial.</p> <p>Uno de los errores más frecuentes que provoca la violación de la integridad referencial es el borrado de un registro de una tabla que está referenciado en otra tabla como clave ajena.</p> <p>Para entenderlo mejor, vamos a volver sobre nuestro ejemplo de la tabla <strong><em>libros</em></strong> y la tabla <strong><em>autores</em></strong>. Supongamos que vamos a borrar un autor (el que tiene código 4):</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-borrado-1.png" alt="Ejemplo de integridad referencial - Borrado" /></p> <p>El resultado de borrar ese registro es que se rompe la integridad referencial, porque el libro 485 hará referencia a un autor que ya no existe:</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-borrado-2.png" alt="Ejemplo de integridad referencial - Borrado" /></p> <p>La base de datos impedirá este borrado para no violar la integridad referencial. Pero se puede hacer algo más: <strong>activar el borrado en cascada</strong>.</p> <p>Cuando se activa el borrado en cascada para una clave ajena, la base de datos se encargará de eliminar los registros adecuados si se borra un registro de la tabla a la que hace referencia esa clave ajena. Así también se protege la integridad referencial.</p> <p>En el ejemplo anterior, al borrar el autor 4, también se borrarán en cascada (¡y automáticamente!) <em>todos los libros escritos por ese autor</em>:</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-borrado-3.png" alt="Ejemplo de integridad referencial - Borrado" /></p> <p>El borrado en cascada se habilita durante la creación de la tabla con el modificador <strong>ON DELETE CASCADE</strong>. Por ejemplo, si queremos habilitarlo para la tabla <em>libros</em> anterior:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">libros</span> <span class="p">(</span>
    <span class="n">cod_libro</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">titulo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">cod_autor</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">autores</span><span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</code></pre></div></div> <h4 id="modificación-en-cascada"> <a href="#modificación-en-cascada" class="anchor-heading" aria-labelledby="modificación-en-cascada"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Modificación en cascada </h4> <p>La <strong>modificación de registros</strong> también puede provocar <strong>fallos de integridad referencial</strong>.</p> <p>Por ejemplo: ¿qué ocurre si modificamos la clave de un registro de nuestra tabla de <em>autores</em>?</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-modificacion-1.png" alt="Ejemplo de integridad referencial - Modificación" /></p> <p>Aquí lo tenemos otra vez: al cambiar el código del autor “Benito Pérez Galdós” de 4 a 5, el libro 485 vuelve a quedarse sin autor. ¡Hemos perdido información de nuevo!</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-modificacion-2.png" alt="Ejemplo de integridad referencial - Modificación" /></p> <p>Como en el caso del borrado, la base de datos <strong>nos prohibirá</strong> hacer este tipo de cosas para <strong>proteger la integridad referencial</strong>.</p> <p>Y, como en el caso del borrado, también existe la posibilidad de habilitar la <strong>actualización o modificación en cascada</strong>, de manera que, si cambia el valor de una clave primaria, pueda modificarse el valor de la clave ajena automáticamente:</p> <p><img src="/docs/prog-y-3d/_site/assets/images/08-01-integridad-referencial-modificacion-3.png" alt="Ejemplo de integridad referencial - Modificación" /></p> <p>Para habilitar la modificación en cascada, hay que especificarlo con <strong>ON UPDATE CASCADE</strong> durante la creación en la clave ajena:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">libros</span> <span class="p">(</span>
    <span class="n">cod_libro</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">titulo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">cod_autor</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">autores</span><span class="p">(</span><span class="n">cod_autor</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</code></pre></div></div> <p>Como ves en este código, la actualización y el borrado en cascada pueden usarse simultáneamente. También pueden habilitarse más tarde, cuando la tabla ya está en uso, mediante un <strong>ALTER TABLE</strong>.</p> <h2 id="83-usando-los-datos-lenguaje-de-manipulación-de-datos"> <a href="#83-usando-los-datos-lenguaje-de-manipulación-de-datos" class="anchor-heading" aria-labelledby="83-usando-los-datos-lenguaje-de-manipulación-de-datos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.3. Usando los datos: lenguaje de manipulación de datos </h2> <p>Hasta aquí hemos visto cómo SQL nos permite crear la estructura de la base de datos, es decir, las tablas con sus campos, tipos, restricciones, etc.</p> <p>Pero aún no lo hemos usado para <strong>almacenar y manipular datos</strong>, que es el objetivo final de toda base de datos. De eso se encarga otra parte de SQL llamada <strong>DML</strong> (lenguaje de manipulación de datos).</p> <p>En realidad, la creación de la estructura se hace solo una vez, cuando la base de datos se construye. Cuando la base de datos ya está en uso, raramente se altera la estructura, puesto que sería como modificar la estructura de una casa cuando ya está habitada: hay que meterse de albañiles y eso siempre es un engorro.</p> <p><em>Durante la inmensa mayoría del tiempo de explotación de una base de datos, el SQL que se utiliza es el que vamos a ver en esta sección.</em></p> <p>SQL tiene varias instrucciones para manipular datos, pero nos vamos a centrar en las cuatro más importantes:</p> <ul> <li><strong>INSERT</strong>: sirve para insertar datos en una tabla.</li> <li><strong>UPDATE</strong>: modifica datos ya existentes.</li> <li><strong>DELETE</strong>: elimina datos de una tabla.</li> <li><strong>SELECT</strong>: consulta datos de una o varias tablas.</li> </ul> <p>Insisto en la idea: estas instrucciones actúan a nivel de datos, es decir, de <em>registros</em> o <em>filas</em> de las tablas. Insertan, modifican y borran registros. Para insertar, modificar y borrar <em>campos</em> está el lenguaje de definición de datos, es decir, CREATE TABLE, ALTER TABLE o DROP TABLE.</p> <h3 id="831-inserción-de-datos-insert"> <a href="#831-inserción-de-datos-insert" class="anchor-heading" aria-labelledby="831-inserción-de-datos-insert"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.3.1. Inserción de datos: INSERT </h3> <p>La instrucción <strong>INSERT</strong> se utiliza para <strong>insertar registros en una tabla</strong>.</p> <p>Como siempre, vamos a aprender a utilizarla mediante algunos ejemplos.</p> <p>Supongamos que tenemos una tabla llamada <em>personas</em> con los siguientes campos:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PERSONAS(id, nombre, apellido1, apellido2, estatura, fecha_nacimiento, pais_nacimiento)
</code></pre></div></div> <p>Esta tabla se habrá creado mediante esta instrucción:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">personas</span> <span class="p">(</span>
   <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="n">nombre</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido1</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">apellido2</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
   <span class="n">estatura</span> <span class="nb">INTEGER</span><span class="p">,</span>
   <span class="n">fecha_nacimiento</span> <span class="nb">DATE</span><span class="p">,</span>
   <span class="n">pais_nacimiento</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
   <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div> <p>Pues bien: para <strong>insertar una fila</strong> en esta tabla, basta con escribir esta instrucción <strong>INSERT</strong>:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">personas</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">estatura</span><span class="p">,</span> <span class="n">fecha_nacimiento</span><span class="p">,</span> <span class="n">pais_nacimiento</span><span class="p">)</span>
       <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'José'</span><span class="p">,</span> <span class="s1">'Pérez'</span><span class="p">,</span> <span class="s1">'Sánchez'</span><span class="p">,</span> <span class="s1">'179'</span><span class="p">,</span> <span class="s1">'13/12/1998'</span><span class="p">,</span> <span class="s1">'México'</span><span class="p">);</span>
</code></pre></div></div> <p>En este código puedes observar varias cosas curiosas:</p> <ul> <li>No indicamos el valor del campo <em>id</em> porque lo hemos declarado como AUTO_INCREMENT y la base de datos se encargará de asignarle un valor automáticamente.</li> <li>Primero indicamos una lista de campos y luego una lista de valores. Los valores se asignarán a los campos en el mismo orden en el que están escritos.</li> <li>No hacemos distinción entre campos de texto, numéricos o fechas: todos los valores se escriben entre comillas. Da igual que sean comillas simples (‘) o dobles (“): SQL admite las dos. De hecho, los números pueden escribirse sin comillas, pero, para evitar errores, mi recomendación es que escribas todos los valores, siempre, entre comillas.</li> </ul> <p>Es posible no asignar valores a todos los campos. Por ejemplo, <em>estatura</em>, <em>fecha_nacimiento</em> y <em>pais_nacimiento</em> no están declarados como NOT NULL, es decir, que se pueden dejar en blanco, así que este INSERT también funcionaría:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">personas</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">)</span>
       <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Susana'</span><span class="p">,</span> <span class="s1">'García'</span><span class="p">,</span> <span class="s1">'Moreno'</span><span class="p">);</span>
</code></pre></div></div> <p>En cambio, si intentamos dejar en blanco el nombre o uno de los dos apellidos, el INSERT fallará.</p> <h3 id="832-modificación-de-datos-update"> <a href="#832-modificación-de-datos-update" class="anchor-heading" aria-labelledby="832-modificación-de-datos-update"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.3.2. Modificación de datos: UPDATE </h3> <p>La <strong>modificación o actualización de registros</strong> se hace mediante la instrucción <strong>UPDATE</strong>.</p> <p>La podemos ver en acción en este ejemplo basado en la misma tabla <em>personas</em> del apartado anterior:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Luis'</span>
   <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</code></pre></div></div> <p>Lo que hace UPDATE es localizar un registro que coincida con la condición expresada en la cláusula WHERE, el decir, localiza el registro cuyo id valga 18, y modifica el valor del campo <em>nombre</em> de ese registro, asignándole el valor “Luis”.</p> <p>Se pueden actualizar varios campos a la vez:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Luis'</span><span class="p">,</span>
       <span class="n">estatura</span> <span class="o">=</span> <span class="s1">'180'</span>
   <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
</code></pre></div></div> <p>Y también se puede usar otra condición que no sea sobre el campo <em>id</em>. Por ejemplo, esta instrucción UPDATE actualizará todos los nombres almacenados como “Paco” y los cambiará por “Francisco”.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Francisco'</span>
   <span class="k">WHERE</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Paco'</span><span class="p">;</span>
</code></pre></div></div> <p>Por lo tanto, un UPDATE puede afectar 0, 1 o muchas filas de la tabla. ¡Mucho cuidado con ejecutar un UPDATE sin cláusula WHERE! Esa actualización afectará a <strong>todos los registros</strong> de la tabla:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">personas</span>
   <span class="k">SET</span> <span class="n">nombre</span> <span class="o">=</span> <span class="s1">'Francisco'</span><span class="p">;</span>
</code></pre></div></div> <p>¡Acabamos de cambiar el nombre de todas las personas de nuestra base de datos!</p> <h3 id="833-borrado-de-datos-delete"> <a href="#833-borrado-de-datos-delete" class="anchor-heading" aria-labelledby="833-borrado-de-datos-delete"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.3.3. Borrado de datos: DELETE </h3> <p>Para <strong>eliminar registros</strong> utilizamos la instrucción <strong>DELETE</strong>.</p> <p>Aquí tienes un ejemplo sobre la tabla <em>personas</em>. Vamos a borrar la persona con id = 18:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">personas</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</code></pre></div></div> <p>Al igual que UPDATE, DELETE localizará el registro (o registros) que coincida con la condición expresada en la cláusula WHERE. Y, una vez localizado, lo borrará.</p> <p>Obviamente, DELETE es una <strong>instrucción destructiva</strong> y debe usarse con cautela.</p> <p>Se pueden borrar varios registros a la vez. Por ejemplo, así borraremos a todas las personas cuyo primer apellido sea “Pérez”:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">personas</span> <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="s1">'Pérez'</span><span class="p">;</span>
</code></pre></div></div> <p>Y así borramos <strong>todos los registros</strong> de una tabla y la dejamos completamente vacía. ¡Utilízalo solo cuando estés muy seguro/a de lo que estás haciendo!</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
</code></pre></div></div> <h2 id="84-consultas-las-instrucción-select"> <a href="#84-consultas-las-instrucción-select" class="anchor-heading" aria-labelledby="84-consultas-las-instrucción-select"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4. Consultas. Las instrucción SELECT </h2> <p>Para <strong>buscar datos</strong> entre las tablas de una base de datos se usa la sentencia <strong>SELECT</strong>. Estas búsquedas suelen recibir el nombre de <strong>consultas</strong>.</p> <p>El resultado de una búsqueda de datos tiene forma de tabla y está constituido por el conjunto de datos que cumplen unos <strong>criterios de búsqueda</strong>, porque, para buscar datos con SQL, no hace falta indicarle a la base de datos cómo hacer la búsqueda, sino <em>qué datos tiene que buscar</em>. Y ella se encarga de todo.</p> <p>Sí, es increíble, pero funciona.</p> <p>La sentencia SELECT es, probablemente, la más compleja del lenguaje SQL. Sin embargo, no necesitas conocerla en profundidad para sacarle partido. La mayor parte del tiempo, SELECT se usa en alguna de sus formas más simples. Si más adelante te vuelves un experto/a en bases de datos, ya aprenderás los usos más complejos.</p> <p>Para comprender mejor los siguientes ejemplos, vamos a suponer que nuestra tabla <em>personas</em> contiene estos siete registros (que quede claro que, en un caso real, la tabla podría tener cientos o miles de registros):</p> <div class="table-wrapper"><table> <thead> <tr> <th>id</th> <th>nombre</th> <th>apellido1</th> <th>apellido2</th> <th>estatura</th> <th>fecha_nacimiento</th> <th>pais_nacimiento</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Antonia</td> <td>López</td> <td>Zapata</td> <td>171</td> <td>18/02/2002</td> <td>España</td> </tr> <tr> <td>2</td> <td>Micaela</td> <td>Cruz</td> <td>Ortega</td> <td>168</td> <td>23/03/1993</td> <td>México</td> </tr> <tr> <td>3</td> <td>Luis Fernando</td> <td>Guzmán</td> <td>Rojas</td> <td>174</td> <td>01/01/2001</td> <td>Colombia</td> </tr> <tr> <td>4</td> <td>Juan</td> <td>López</td> <td>Gutiérrez</td> <td>191</td> <td>28/02/1997</td> <td>Argentina</td> </tr> <tr> <td>5</td> <td>Esteban</td> <td>López</td> <td>López</td> <td>166</td> <td>07/09/2001</td> <td>México</td> </tr> <tr> <td>6</td> <td>Ana Lucía</td> <td>Smith</td> <td>López</td> <td>185</td> <td>19/01/2000</td> <td>Argentina</td> </tr> <tr> <td>7</td> <td>Fernando José</td> <td>Delgado</td> <td>Aguas</td> <td>157</td> <td>17/08/1969</td> <td>México</td> </tr> </tbody> </table></div> <h3 id="841-seleccionar-columnas-de-una-tabla"> <a href="#841-seleccionar-columnas-de-una-tabla" class="anchor-heading" aria-labelledby="841-seleccionar-columnas-de-una-tabla"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.1. Seleccionar columnas de una tabla </h3> <p>La sintaxis más básica concebible de una sentencia SELECT funcional es esta:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">columna1</span><span class="p">,</span> <span class="n">columna2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">columnaN</span>
  <span class="k">FROM</span> <span class="n">nombre_tabla</span><span class="p">;</span>
</code></pre></div></div> <p>Por ejemplo, esta instrucción nos devolverá todos los registros de la tabla <em>personas</em>, pero seleccionando solo las columnas <em>nombre</em>, <em>apellido1</em> y <em>apellido2</em> y desechando todas las demás:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
</code></pre></div></div> <p>El resultado de la consulta será:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia López Zapata
Micaela Cruz Ortega
Luis Fernando Guzmán Rojas
Juan López Gutiérrez
Esteban López López
Ana Lucía Smith López
Fernando José Delgado Aguas
</code></pre></div></div> <p>El símbolo * (asterisco) significa “todas las columnas”. De modo que esto nos devolverá todo el contenido de la tabla <em>personas</em> sin excepción:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
</code></pre></div></div> <p>El resultado de esta consulta será:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 Antonia López Zapata 171 18/02/2002 España
2 Micaela Cruz Ortega 168 23/03/1993 México
3 Luis Fernando Guzmán Rojas 174 01/01/2001 Colombia
4 Juan López Gutiérrez 191 28/02/1997 Argentina
5 Esteban López López 166 07/09/2001 México
6 Ana Lucía Smith López 185 19/01/2000 Argentina
7 Fernando José Delgado Aguas 157 17/08/1969 México
</code></pre></div></div> <h3 id="842-filtrar-resultados-la-cláusula-where"> <a href="#842-filtrar-resultados-la-cláusula-where" class="anchor-heading" aria-labelledby="842-filtrar-resultados-la-cláusula-where"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.2. Filtrar resultados: la cláusula WHERE </h3> <p>Normalmente, no vamos a necesitar <em>todos</em> los registros de una tabla, sino que queremos localizar alguno o algunos en concreto. Para eso sirven las búsquedas, ¿no? Para encontrar unos pocos resultados entre un montón de datos.</p> <p>Pues bien, para <strong>filtrar esos resultados</strong> se utiliza la <strong>cláusula WHERE</strong>.</p> <p>Es sencilla de comprender. Simplemente, se indica una <strong>condición</strong> que afecte a alguno de los campos de la tabla, y la base de datos se encargará de encontrar para nosotros los registros que cumplan esa condición.</p> <p>Por ejemplo, esta consulta nos devuelve los nombres y apellidos de todas las personas cuya estatura es igual a 168 cm (recuerda que <em>estatura</em> es un campo de nuestra tabla <em>personas</em>):</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">=</span> <span class="s1">'168'</span><span class="p">;</span>
</code></pre></div></div> <p>Como resultado, solo obtendremos un registro, porque solo una persona cumple esa condición:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
</code></pre></div></div> <p>La condición puede utilizar los <strong>operadores de comparación</strong> habituales:</p> <ul> <li><strong>Igual que</strong>: =</li> <li><strong>Mayor que</strong>: &gt;</li> <li><strong>Mayor o igual</strong>: &gt;=</li> <li><strong>Menor que</strong>: &lt;</li> <li><strong>Menor o igual</strong>: &lt;=</li> <li><strong>Distinto de</strong>: !=</li> </ul> <p>Además, también existen <strong>operadores lógicos</strong> que ya conoces de otros lenguajes de programación: <strong>AND</strong>, <strong>OR</strong> y <strong>NOT</strong>.</p> <p>Con todo esto, se pueden hacer consultas bastante elaboradas con muy poco esfuerzo. Por ejemplo, vamos a pedirle a la base de datos que busque a todas las personas que miden más de 170 cm:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">&gt;</span> <span class="s1">'170'</span><span class="p">;</span>
</code></pre></div></div> <p>El resultado será:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia López Zapata
Luis Fernando Guzmán Rojas
Juan López Gutiérrez
Ana Lucía Smith López
</code></pre></div></div> <p>Esta otra consulta localiza a todas las personas cuyo primer apellido es “López” y que miden más de 170 cm:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="s1">'López'</span>
    <span class="k">AND</span> <span class="n">estatura</span> <span class="o">&gt;</span> <span class="s1">'170'</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia López Zapata
Juan López Gutiérrez
</code></pre></div></div> <p>Y esta otra busca a todas las personas que tienen “López” como primer o segundo apellido y que han nacido antes del año 2002. Observa cómo se pueden usar paréntesis para agrupar condiciones:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="p">(</span><span class="n">apellido1</span> <span class="o">=</span> <span class="s1">'López'</span> <span class="k">OR</span> <span class="n">apellido2</span> <span class="o">=</span> <span class="s1">'López'</span><span class="p">)</span>
    <span class="k">AND</span> <span class="n">fecha_nacimiento</span> <span class="o">&lt;</span> <span class="s1">'01/01/2002'</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Juan López Gutiérrez
Esteban López López
Ana Lucía Smith López
</code></pre></div></div> <h3 id="843-búsquedas-aproximadas-con-caracteres-comodín"> <a href="#843-búsquedas-aproximadas-con-caracteres-comodín" class="anchor-heading" aria-labelledby="843-búsquedas-aproximadas-con-caracteres-comodín"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.3. Búsquedas aproximadas con caracteres comodín </h3> <p>Las comparaciones en la cláusula WHERE permiten usar lo que se llaman <strong>caracteres comodín</strong>, que son básicamente dos: % (símbolo del tanto por ciento) y _ (símbolo del subrayado).</p> <ul> <li><strong>%</strong> significa “cualquier conjunto de caracteres, incluyendo ningún carácter”.</li> <li><strong>_</strong> significa “un carácter cualquiera”. En algunos gestores de bases de datos, este carácter es “?” (interrogación)</li> </ul> <p>Las comparaciones que usan carácteres comodín deben escribirse con el operador de comparación <strong>LIKE</strong>, no con los operadores habituales.</p> <p>Por ejemplo, esta consulta localiza personas cuyo nombre comienza por la letra A, sin importar cuántos caracteres contenga el nombre a continuación de esa A:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">nombre</span> <span class="k">LIKE</span> <span class="s1">'A%'</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia López Zapata
Ana Lucía Smith López
</code></pre></div></div> <p>Esta otra consulta busca a personas que hayan en el mes de enero de cualquier año:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">fecha_nacimiento</span> <span class="k">LIKE</span> <span class="s1">'__/01/____'</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Luis Fernando Guzmán Rojas
Ana Lucía Smith López
</code></pre></div></div> <h3 id="844-ordenar-resultados-con-order-by"> <a href="#844-ordenar-resultados-con-order-by" class="anchor-heading" aria-labelledby="844-ordenar-resultados-con-order-by"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.4. Ordenar resultados con ORDER BY </h3> <p>Los resultados obtenidos en una consulta pueden <strong>ordenarse</strong> por cualquier campo con la <strong>cláusula ORDER BY</strong>, independientemente de cuales sean las condiciones de búsqueda.</p> <p>Por ejemplo, para obtener una lista de personas ordenadas por apellido:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
Fernando José Delgado Aguas
Luis Fernando Guzmán Rojas
Antonia López Zapata
Juan López Gutiérrez
Esteban López López
Ana Lucía Smith López
</code></pre></div></div> <p>Fíjate que Antonia López, Juan López y Esteban López comparten el primer apellido y, por ese motivo, siguen apareciendo desordenados. O, mejor dicho, aparecen en el orden en el que están almacenados en la tabla, que no tiene por qué ser alfabético.</p> <p>Se puede indicar un segundo criterio de ordenación (y un tercero, y un cuarto…). Nosotros vamos a usar como segundo criterio el segundo apellido, así:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
Fernando José Delgado Aguas
Luis Fernando Guzmán Rojas
Esteban López López
Juan López Gutiérrez
Antonia López Zapata
Ana Lucía Smith López
</code></pre></div></div> <p>El ordenamiento se hace, por defecto, de manera <strong>ascendente</strong> (numérica en caso de campos numéricos o alfabética en caso de campos de texto). Se puede forzar un ordenamiento <strong>descendente</strong> con el modificador <strong>DESC</strong>.</p> <p>Por ejemplo, aquí obtenemos la lista de las personas apellidadas “López” ordenadas de la más alta a la más bajita:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">estatura</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="nv">"López"</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">estatura</span> <span class="k">DESC</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Juan López Gutiérrez 191
Antonia López Zapata 171
Esteban López López 166
</code></pre></div></div> <h3 id="845-agrupar-resultados-con-distinct"> <a href="#845-agrupar-resultados-con-distinct" class="anchor-heading" aria-labelledby="845-agrupar-resultados-con-distinct"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.5. Agrupar resultados con DISTINCT </h3> <p>Atención, pregunta. ¿Qué ocurrirá si ejecutamos esta consulta?</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">apellido1</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">;</span>
</code></pre></div></div> <p>Si has respondido que obtendremos todos los primeros apellidos de todas las personas de la tabla <em>personas</em>, ordenados alfabéticamente, has acertado.</p> <p><em>Pero hay varias personas que comparten el primer apellido.</em></p> <p>Por esa razón, ese apellido aparece (“López”) repetido varias veces en el resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cruz
Delgado
Guzmán
López
López
López
Smith
</code></pre></div></div> <p>Esta repetición de resultados puede ser algo buscado o un efecto secundario indeseable de la búsqueda. Para <strong>evitar resultados repetidos</strong> se usa <strong>DISTINCT</strong>. Por ejemplo, el siguiente SELECT nos mostrará todos los primeros apellidos de la tabla, pero sin repetir ninguno:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">apellido1</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">;</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cruz
Delgado
Guzmán
López
Smith
</code></pre></div></div> <h3 id="846-funciones-de-agregado-y-group-by"> <a href="#846-funciones-de-agregado-y-group-by" class="anchor-heading" aria-labelledby="846-funciones-de-agregado-y-group-by"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.6. Funciones de agregado y GROUP BY </h3> <p>En la lista de campos, se pueden utilizar las llamadas <strong>funciones de agregado</strong>. Se trata de funciones que realizan cálculos sobre los resultados de la consulta.</p> <p>Por ejemplo, esta consulta (que no usa funciones de agregado) nos devuelve los IDs de las personas cuyo país de nacimiento es “México”:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">id</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">pais_nacimiento</span> <span class="o">=</span> <span class="nv">"México"</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Micaela Cruz Ortega
Esteban López López
Fernando José Delgado Aguas
</code></pre></div></div> <p>En cambio, esta otra consulta (que usa la función de agregado COUNT()) nos devuelve <em>el número de personas</em> cuyo país de nacimiento es “México”:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">pais_nacimiento</span> <span class="o">=</span> <span class="nv">"México"</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
</code></pre></div></div> <p>Las <strong>funciones de agregado más importantes</strong> son las siguientes:</p> <ul> <li><strong>COUNT()</strong>: cuenta el número de filas que cumplen los criterios de búsqueda de la consulta.</li> <li><strong>MIN()</strong>: calcula el valor mínimo de un campo numérico.</li> <li><strong>MAX()</strong>: calcula el valor máximo de un campo numérico.</li> <li><strong>AVG()</strong>: calcula el valor promedio de un campo numérico.</li> <li><strong>SUM()</strong>: calcula la suma de todos los valores de un campo numérico.</li> </ul> <p>Con estas funciones, es muy fácil buscar, por ejemplo, la estatura máxima de todas las personas cuyo primer apellido es “López”:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">estatura</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">apellido1</span> <span class="o">=</span> <span class="nv">"López"</span><span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>191
</code></pre></div></div> <p>Las funciones de agregado se usan a menudo con la <strong>clásula GROUP BY</strong>, que nos permite <strong>agrupar los resultados por algún campo</strong>. Observa cómo funciona en este ejemplo:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">pais_nacimiento</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span><span class="p">;</span>
</code></pre></div></div> <p>Esta consulta nos dirá cuántas personas han nacido en cada país, ofreciéndonos un resultado con un aspecto como este:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Argentina 2
Colombia 1
España 1
México 3
</code></pre></div></div> <p>Lo que ha ocurrido aquí es que los resultados se han agrupado por paises (<strong>GROUP BY pais_nacimiento</strong>) y, para cada grupo, se ha hecho el cálculo de la función de agregado (<strong>COUNT(id)</strong>).</p> <p>La cláusula GROUP BY aparece, a veces, acompañada de la <strong>cláusula HAVING</strong>, que es <strong>como WHERE pero aplicable a funciones de agregado</strong>.</p> <p>Por ejemplo, esta consulta nos mostrará la cantidad de personas nacidas en cada país pero solo de aquellos países de los que se contabilicen al menos 3 personas en la tabla:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">pais_nacimiento</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">personas</span><span class="p">;</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">pais_nacimiento</span>
    <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">;</span>
</code></pre></div></div> <p>Resultado:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>México 3
</code></pre></div></div> <h3 id="847-obtener-resultados-de-varias-tablas-join"> <a href="#847-obtener-resultados-de-varias-tablas-join" class="anchor-heading" aria-labelledby="847-obtener-resultados-de-varias-tablas-join"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.7. Obtener resultados de varias tablas: JOIN </h3> <p>Hasta ahora, solo hemos visto ejemplos de consultas que obtienen datos de una sola tabla, pero es muy frecuente que queramos <strong>extraer datos de varias tablas relacionadas entre sí</strong>.</p> <p>SQL permite hacer eso con la cláusula <strong>JOIN</strong>.</p> <p>Para comprender cómo funciona JOIN, necesitamos añadir una o dos tablas a nuestra base de datos, así que los siguientes ejemplos se basarán en estas tres tablas:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PERSONAS(id, nombre, apellido1, apellido2, estatura, fecha_nacimiento, id_pais)
PAISES(id, nombre, id_continente)
CONTINENTES(id, nombre)
</code></pre></div></div> <p>Como puedes imaginarte, el campo <em>id_pais</em> de la tabla <em>PERSONAS</em> es una clave ajena que está relacionada con el campo <em>id</em> de la tabla <em>PAISES</em>.</p> <p>Del mismo modo, <em>id_continente</em> en la tabla <em>PAISES</em> es una clave ajena enlazada con <em>id</em> en la tabla CONTINENTES.</p> <p>Para que quede más claro, te muestro un ejemplo de lo que podrían contener estas tablas:</p> <p><strong>TABLA PERSONAS</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th>id</th> <th>nombre</th> <th>apellido1</th> <th>apellido2</th> <th>estatura</th> <th>fecha_nacimiento</th> <th>id_pais</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Antonia</td> <td>López</td> <td>Zapata</td> <td>171</td> <td>18/02/2002</td> <td>3</td> </tr> <tr> <td>2</td> <td>Micaela</td> <td>Cruz</td> <td>Ortega</td> <td>168</td> <td>23/03/1993</td> <td>1</td> </tr> <tr> <td>3</td> <td>Luis Fernando</td> <td>Guzmán</td> <td>Rojas</td> <td>174</td> <td>01/01/2001</td> <td>2</td> </tr> <tr> <td>4</td> <td>Juan</td> <td>López</td> <td>Gutiérrez</td> <td>191</td> <td>28/02/1997</td> <td>7</td> </tr> <tr> <td>5</td> <td>Esteban</td> <td>López</td> <td>López</td> <td>166</td> <td>07/09/2001</td> <td>1</td> </tr> <tr> <td>6</td> <td>Ana Lucía</td> <td>Smith</td> <td>López</td> <td>185</td> <td>19/01/2000</td> <td>7</td> </tr> <tr> <td>7</td> <td>Fernando José</td> <td>Delgado</td> <td>Aguas</td> <td>157</td> <td>17/08/1969</td> <td>1</td> </tr> <tr> <td>etc</td> <td>etc</td> <td>etc</td> <td>etc</td> <td>etc</td> <td>etc</td> <td>etc</td> </tr> </tbody> </table></div> <p><strong>TABLA PAISES</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th>id</th> <th>nombre</th> <th>id_continente</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>México</td> <td>2</td> </tr> <tr> <td>2</td> <td>Colombia</td> <td>2</td> </tr> <tr> <td>3</td> <td>España</td> <td>4</td> </tr> <tr> <td>4</td> <td>Australia</td> <td>5</td> </tr> <tr> <td>5</td> <td>China</td> <td>3</td> </tr> <tr> <td>6</td> <td>Egipto</td> <td>1</td> </tr> <tr> <td>7</td> <td>Argentina</td> <td>2</td> </tr> <tr> <td>etc</td> <td>etc</td> <td>etc</td> </tr> </tbody> </table></div> <p><strong>TABLA CONTINENTES</strong></p> <div class="table-wrapper"><table> <thead> <tr> <th>id</th> <th>nombre</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>África</td> </tr> <tr> <td>2</td> <td>América</td> </tr> <tr> <td>3</td> <td>Asia</td> </tr> <tr> <td>4</td> <td>Europa</td> </tr> <tr> <td>5</td> <td>Oceanía</td> </tr> </tbody> </table></div> <p>Ahora el nombre del país no está almacenado directamente en la tabla <em>personas</em>, sino en la tabla <em>paises</em>. Ambas tablas se relacionan gracias al campo <em>id_pais</em>. Lo mismo ocurre entre <em>paises</em> y <em>continentes</em>.</p> <p>Por lo tanto, si necesitamos recuperar, por ejemplo, <strong>los nombres y apellidos de todas las personas junto con su país de nacimiento</strong>, será necesario mezclar los datos de las tablas <em>personas</em> y <em>paises</em>. Esto se hace así:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
</code></pre></div></div> <p>El resultado será:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia López Zapata España
Micaela Cruz Ortega México
Luis Fernando Guzmán Rojas Colombia
Juan López Gutiérrez Argentina
Esteban López López México
Ana Lucía Smith López Argentina
Fernando José Delgado Aguas México
</code></pre></div></div> <p>Observa algunas cosas importantes en esta sentencia:</p> <ul> <li>En la <strong>clásula FROM</strong> indicamos la tabla principal de nuestra consulta (<em>personas</em>).</li> <li>En la <strong>clásula JOIN</strong> indicamos la segunda tabla de nuestra consulta (<em>paises</em>) y le indicamos a SQL cuál es el campo que relaciona <em>personas</em> con <em>paises</em> (<code class="language-plaintext highlighter-rouge">personas.id_pais = paises.id</code>).</li> <li>En la lista de campos, tenemos dos campos llamados <em>nombre</em>, uno perteneciente a la tabla <em>personas</em> (el nombre de la persona) y otro perteneciente a la tabla <em>paises</em> (el nombre del país). Por eso es necesario distinguirlos poniendo delante el identificador de la tabla (<em>personas.nombre</em> y <em>paises.nombre</em>). Con <em>apellido1</em> y <em>apellido2</em> no hace falta, puesto que esos campos solo existen en la tabla <em>personas</em>.</li> </ul> <p>Y poco más hay que decir sobre los JOIN. Son así de sencillos. SQL se encargará de mostrar a cada persona con su país correspondiente, cruzando los datos de las dos tablas.</p> <p>Se puede hacer <strong>JOIN de más de dos tablas</strong>. En esos casos, basta con cruzar las tablas por parejas. Por ejemplo, para mostrar la lista de personas junto con su país y su continente de nacimiento, primero cruzaremos <em>personas</em> con <em>paises</em> y después <em>paises</em> con <em>continentes</em>. No se puede cruzar directamente <em>personas</em> con <em>continentes</em> porque no tienen ningún campo en común, es decir, no están directamente relacionadas entre sí.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">continentes</span><span class="p">.</span><span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
  <span class="k">JOIN</span> <span class="n">continentes</span> <span class="k">ON</span> <span class="n">paises</span><span class="p">.</span><span class="n">id_continente</span> <span class="o">=</span> <span class="n">continentes</span><span class="p">.</span><span class="n">id</span>
</code></pre></div></div> <p>El resultado de esta consulta será:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Antonia López Zapata España Europa
Micaela Cruz Ortega México América
Luis Fernando Guzmán Rojas Colombia América
Juan López Gutiérrez Argentina América
Esteban López López México América
Ana Lucía Smith López Argentina América
Fernando José Delgado Aguas México América
</code></pre></div></div> <p>Por último, <strong>las consultas con JOIN también pueden llevar cláusulas WHERE, ORDER BY, GROUP BY o HAVING</strong>, como cualquier otra consulta. Por ejemplo, vamos a buscar los nombres, apellidos, país de nacimiento y continente de todas las personas nacidas a partir de 1 de enero del año 2000 y vamos a ordenar los resultados por apellidos:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">continentes</span><span class="p">.</span><span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
  <span class="k">JOIN</span> <span class="n">continentes</span> <span class="k">ON</span> <span class="n">paises</span><span class="p">.</span><span class="n">id_continente</span> <span class="o">=</span> <span class="n">continentes</span><span class="p">.</span><span class="n">id</span>
  <span class="k">WHERE</span> <span class="n">fecha_nacimiento</span> <span class="o">&gt;=</span> <span class="s1">'01/01/2000'</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">;</span>
</code></pre></div></div> <p>El resultado será:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Luis Fernando Guzmán Rojas Colombia América
Esteban López López México América
Antonia López Zapata España Europa
Ana Lucía Smith López Argentina América
</code></pre></div></div> <h3 id="848-sql-avanzado-introducción-a-las-subconsultas"> <a href="#848-sql-avanzado-introducción-a-las-subconsultas" class="anchor-heading" aria-labelledby="848-sql-avanzado-introducción-a-las-subconsultas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.8. SQL avanzado: introducción a las subconsultas </h3> <p>Hay ciertas situaciones en las que nos encontramos con una consulta tan compleja que no se puede resolver con las herramientas que hemos visto hasta ahora.</p> <p>En esos casos, <strong>utilizar una subconsulta en una cláusula WHERE o HAVING</strong> suele obrar milagros. Sin embargo, no conviene abusar de este recurso: las consultas con subconsultas siempre consumen más recursos y son más lentas de ejecutar que las consultas convencionales.</p> <p>La subconsulta se inserta en cualquier cláusula WHERE o HAVING con alguno de estos operadores:</p> <ul> <li><strong>ANY</strong>, <strong>ALL</strong> o <strong>SOME</strong>.</li> <li><strong>IN</strong> o <strong>NOT IN</strong>.</li> <li><strong>EXISTS</strong> o <strong>NOT EXISTS</strong>.</li> <li><strong>=, &gt;, &gt;=, &lt;, &lt;=</strong>.</li> </ul> <p>El significado de los operadores es bastante obvio. Como siempre, se comprende mejor con algunos ejemplos.</p> <p><strong>Ejemplo 1: buscar a todas las personas que hayan nacido en algún país del continente americano:</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id_pais</span> <span class="k">FROM</span> <span class="n">paises</span>
                              <span class="k">WHERE</span> <span class="n">id_continente</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></div></div> <p>Observa bien el código de esta consulta: le estamos pidiendo a la base de datos que, en primer lugar, ejecute la consulta que hay entre paréntesis (es decir, la <em>subconsulta</em>). Esta consulta nos devolverá una lista de IDs de paises del contienente americano. Y luego, gracias a la clásula WHERE de la consulta principal, seleccionaremos solo a las personas que hayan nacido en alguno de esos países.</p> <p>(Esta consulta, por cierto, puede resolverse sin subconsultas de forma más eficiente. Puedes pensar en ello si lo deseas: es un interesante ejercicio).</p> <p><strong>Ejemplo 2: buscar todos los países de los cuales hay al menos una persona en la base de datos:</strong></p> <p>También puede hacerse sin subconsultas, pero la solución con subconsulta es así de simple:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span>
  <span class="k">FROM</span> <span class="n">paises</span>
  <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="k">ANY</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">id_pais</span> <span class="k">FROM</span> <span class="n">personas</span><span class="p">);</span>
</code></pre></div></div> <p><strong>Ejemplo 3: buscar a las personas más altas de la base de datos</strong>:</p> <p>Es decir, buscar a las personas que compartan el valor máximo de estatura, sea este el que sea. Este es un ejemplo de consulta que difícilmente podrías resolver sin subconsultas, pero que con subconsultas queda en algo tan simple como:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">estatura</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">personas</span><span class="p">);</span>
</code></pre></div></div> <p>Las subconsultas se pueden considerar SQL avanzado, por lo que no es necesario que las domines en este momento, pero sí que conozcas su existencia por si más adelante en tu carrera como programador/a tienes que profundizar en ellas.</p> <h3 id="849-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas"> <a href="#849-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas" class="anchor-heading" aria-labelledby="849-otras-cuestiones-avanzadas-alias-y-combinaciones-de-consultas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.4.9. Otras cuestiones avanzadas: alias y combinaciones de consultas </h3> <p>Como dijimos al principio, SQL en general y la instrucción SELECT en particular son muy amplios y se pueden aplicar en muchísimos casos diferentes, desde consultas sencillísimas hasta casos complejos donde tu cerebro puede tener un amago de explosión mientras trata de buscar una solución.</p> <p>Te menciono aquí <strong>algunos aspectos avanzados de los SELECT</strong> para que los conozcas, haciéndote saber que, si no aprendes a controlarlos ahora, no es ninguna tragedia: más adelante, si te especializas en esto, sin duda aprenderás a dominarlos.</p> <p>Por ahora basta con que los conozcas y los comprendas. En algunos de los ejercicios del tema usaremos estos aspectos avanzados para buscar soluciones a supuestos prácticos particularmente enrevesados.</p> <p><strong>ALIAS</strong></p> <p>Los alias son <strong>nombres alternativos que se asignan a las tablas o a las columnas</strong> en una consulta.</p> <p>El objetivo del alias puede ser doble:</p> <ul> <li>Usar un nombre más corto para facilitar la escritura de una expresión que, de otro modo, sería muy larga.</li> <li>Poder referirse a la misma tabla en dos conextos diferentes.</li> </ul> <p>El primer uso es muy fácil de entender. El segundo, no tanto. De momento, vamos a ver el uso más fácil. No te preocupes demasiado por el otro: veremos algún ejemplo en los ejercicios de este capítulo.</p> <p>El <strong>alias se indica con la palabra AS</strong>.</p> <p>Por ejemplo, en la siguiente consulta, se usan alias para acortar los identificadores de los campos <em>persona.nombre</em>, <em>paises.nombre</em> y <em>continentes.nombre</em>, que pasan a ser <em>nom_pers</em>, <em>nom_pais</em> y <em>nom_cont</em>, respectivamente. Observa como podemos referirnos a cualquiera de esos campos por su nombre o su alias, como hacemos en la cláusula WHERE de este ejemplo.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">personas</span><span class="p">.</span><span class="n">nombre</span> <span class="k">AS</span> <span class="n">nom_pers</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">,</span> <span class="n">paises</span><span class="p">.</span><span class="n">nombre</span> <span class="k">AS</span> <span class="n">nom_pais</span><span class="p">,</span> <span class="n">continentes</span><span class="p">.</span><span class="n">nombre</span> <span class="k">AS</span> <span class="n">nom_cont</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">JOIN</span> <span class="n">paises</span> <span class="k">ON</span> <span class="n">personas</span><span class="p">.</span><span class="n">id_pais</span> <span class="o">=</span> <span class="n">paises</span><span class="p">.</span><span class="n">id</span>
  <span class="k">JOIN</span> <span class="n">continentes</span> <span class="k">ON</span> <span class="n">paises</span><span class="p">.</span><span class="n">id_continente</span> <span class="o">=</span> <span class="n">continentes</span><span class="p">.</span><span class="n">id</span>
  <span class="k">WHERE</span> <span class="n">nom_pers</span> <span class="k">LIKE</span> <span class="s1">'A%'</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span><span class="p">;</span>
</code></pre></div></div> <p><strong>COMBINACIONES DE CONSULTAS</strong></p> <p>Es posible <strong>combinar los resultados de dos consultas</strong> para obtener un resultado más amplio.</p> <p>Si tenemos dos consultas, que llamaremos C1 y C2, sus resultados pueden combinarse de tres modos diferentes:</p> <ul> <li>Con <strong>UNION</strong>: los registros de C1 y de C2 se sumarán, es decir, el resultado de <strong>C1 UNION C2</strong> serán todas las filas que estén en C1 más las que estén en C2.</li> <li>Con <strong>INSERSECT</strong>: el resultado de <strong>C1 INSERSECT C2</strong> serán todas las filas que están a la vez en C1 y en C2, es decir, la insersección de los dos conjuntos de resultados.</li> <li>Con <strong>EXCEPT</strong>: el resultado de <strong>C1 EXCEPT C2</strong> serán todas las filas que estén en C1, quitando las que estén en C2.</li> </ul> <p>Para poder hacer UNION, INSERSECT o EXCEPT de dos consultas, ambas tienen que haber producido exactamente el mismo conjunto de campos. Si no, estas operaciones no son posibles.</p> <p>Por ejemplo, observa el siguiente código. Fíjate en que las dos consultas producen el mismo conjunto de campos (<em>nombre, apellido1, apellido2</em>). Si no, no sería posible combinarlas. Observa también el uso de los paréntesis:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
  <span class="k">FROM</span> <span class="n">personas</span>
  <span class="k">WHERE</span> <span class="n">pais_nacimiento</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">)</span>
<span class="k">UNION</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellido1</span><span class="p">,</span> <span class="n">apellido2</span>
   <span class="k">FROM</span> <span class="n">personas</span><span class="p">)</span>
   <span class="k">WHERE</span> <span class="n">estatura</span> <span class="o">&gt;</span> <span class="s1">'180'</span><span class="p">);</span>
</code></pre></div></div> <p>(por supuesto, esto mismo puede resolverse sin usar UNION)</p> <ul> <li> <p>La combinación de estas dos consultas con <strong>UNION</strong> nos devuelve la lista de personas que han nacido en Argentina <strong>O</strong> que miden más de 180 cm. Cualquier persona que cumpla una de las dos condiciones estará en el resultado final.</p> </li> <li> <p>Si combinásemos las mismas consultas con <strong>INSERSECT</strong> en lugar de con UNION, lo que obtendríamos sería la lista de personas que nacieron en Argentina <strong>Y</strong> que miden más de 180 cm. Es decir, las personas que formen parte de los dos resultados y, por lo tanto, cumplan <em>a la vez</em> las dos condiciones.</p> <p>Fíjate en que en el enunciado solo hemos cambiado una “O” por una “Y”, pero es que esa es precisamente la diferencia entre UNION e INTERSECT.</p> </li> <li> <p>Por último, si combinamos las mismas consultas con <strong>EXCEPT</strong>, obtendremos la lista de personas que nacieron en Argentina, excepto las que miden más de 180 cm. Habremos eliminado del primer SELECT los resultados que estén en el segundo SELECT. Esto es, obtendremos la lista de personas nacidas en argentina que miden 180 cm o menos.</p> </li> </ul> <p>Es un lío desde el punto de vista lógico, ¿verdad? Y es que no se te habrán escapado las semejanzas de UNION, INTERSECT y EXCEPT con los operadores lógicos Y, O y NO. En efecto, UNION, INSERSECT y EXCEPT son los equivalentes a Y, O y NO a nivel de consultas completas.</p> <p>Aplicaremos UNION, INSERSECT y EXCEPT a algunas de las consultas más complejas de nuestros ejercicios propuestos.</p> <h2 id="85-y-cómo-puedo-probar-todo-esto"> <a href="#85-y-cómo-puedo-probar-todo-esto" class="anchor-heading" aria-labelledby="85-y-cómo-puedo-probar-todo-esto"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.5. ¿Y cómo puedo probar todo esto? </h2> <p>Seguro que te has hecho esta pregunta mientras leías los ejemplos de este capítulo y tal vez incluso intentabas resolverlos por tu cuenta.</p> <p>Es una excelente pregunta.</p> <p>Para ejecutar SQL <strong>necesitas un gestor de bases de datos relacionales</strong>. Puede instalar un gestor de escritorio, para bases de datos domésticas, como <em>Microsoft Access</em> o <em>Libreoffice Base</em>, o puedes decantarte por un gestor profesional en red, como <em>MySQL, MariaDB, Oracle, SQLite</em> o <em>SQL Server</em>.</p> <p>En realidad, da igual, porque el SQL es más o menos igual en todos.</p> <p>(Digo “más o menos” porque cada base de datos hace su propia interpretación del estándar SQL y puede haber pequeñas diferencias entre uno y otro).</p> <p>Si nunca has usado una base de datos profesional como MySQL, Oracle u SQL Server, probablemente <strong>lo más sencillo es que empieces por Microsoft Access o Libreoffice Base</strong>. Si, en cambio, ya conoces las bases de datos profesionales, no necesitas leer este apartado. Puedes pasar directamente a los ejercicios, aunque probablemente tampoco los necesites.</p> <ol> <li> <p><strong>Instala Microsoft Access (forma parte del paquete Microsoft Office) o Libreoffice Base (forma parte del paquete Libreoffice)</strong> en tu ordenador. Microsoft ofrece una versión online de su Office. Recuerda que Microsoft Office es un paquete de software propietario y que copiar y usar programas de forma fraudulenta es un delito penal. Libreoffice, en cambio, es software libre y puedes usarlo y distribuirlo libremente. Eso sí: ¡Descárgalo solo de la web oficial, por favor!</p> </li> <li> <p><strong>Arranca el programa</strong> (claro).</p> </li> <li> <p><strong>En Microsoft Access</strong>, crea una base de datos (o abre una existente). Ahora puedes ejecutar tus sentencias SQL pulsando el botón “Create” de la parte superior de la pantalla, y luego seleccionando “Query design” -&gt; “Show table” -&gt; “SQL view”. Escribe tu sentencia SQL y pulsa “Run” para probarla.</p> </li> <li> <p><strong>En Libreoffice Base</strong>, crea una base de datos (o abre una existente). Selecciona “Tool - SQL” y luego “Create Query in SQL view”. En la pantalla siguiente, haz clic en “View” -&gt; “Switch Design View On/Off”. Escribe tu sentencia SQL y pulsa “Run” para probarla.</p> </li> </ol> <p>En realidad, todo esto no tiene nada que ver con aprender SQL, sino con aprender a manejar un determinado programa. Elige el tuyo y bichea un poco hasta que averigües cómo se ejecuta el SQL. Se presupone de ti que eres un usuario/a de ordenadores de nivel medio-avanzado, y por eso quieres aprender a programar. No tiene mucho sentido explicar aquí cómo ejecutar SQL en cada gestor de bases de datos porque puede haber importantes diferencias entre un gestor de bases de datos y otro o, incluso, entre versiones del mismo programa. Y, en última instancia, es algo tan simple como trastear un rato con el programa.</p> <h2 id="86-ejercicios-propuestos"> <a href="#86-ejercicios-propuestos" class="anchor-heading" aria-labelledby="86-ejercicios-propuestos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.6. Ejercicios propuestos </h2> <p>Como de costumbre, vamos a proponer una batería de ejercicios de SQL para que practiques todo lo que hemos visto a lo largo de este capítulo.</p> <p>Muchos de ellos los encontrarás resueltos en la siguiente sección. Ya sabes lo que digo siempre: es una pésima idea mirar las soluciones antes de haber intentado resolverlos por tu cuenta.</p> <h4 id="ejercicio-1-compañía-de-seguros"> <a href="#ejercicio-1-compañía-de-seguros" class="anchor-heading" aria-labelledby="ejercicio-1-compañía-de-seguros"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 1: compañía de seguros </h4> <p>Una compañía de seguros dispone de una base de datos con las siguientes tablas:</p> <ul> <li>Personas (dni#, nombre, apellidos, dirección, ciudad, país)</li> <li>Coches (matrícula#, marca, modelo, potencia, conductor, seguro)</li> <li>Seguros (núm-póliza#, compañía, tipo, franquicia, dni-tomador, fecha)</li> </ul> <p>Las claves ajenas son estas:</p> <ul> <li>Coches.conductor → Personas.dni (es decir, el campo <em>coches.conductor</em> es una clave ajena de <em>personas.dni</em>)</li> <li>Coches.seguro → Seguros.núm-póliza (el campo <em>coches.seguro</em> es una clave ajena de <em>seguros.num-numpoliza</em>)</li> <li>Seguros.dni-tomador → Personas.dni (el campo <em>seguros.dni-tomador</em> es una clave ajena de <em>personas.dni</em>)</li> </ul> <p>Se pide escribir el código SQL necesario para:</p> <p><strong>a) Crear las tablas</strong> (CREATE TABLE), suponiendo las siguientes restricciones:</p> <ul> <li>Todas las claves primarias y ajenas son campos obligatorios (no pueden ser nulos). Además, las claves primarias no pueden tomar valores repetidos.</li> <li><em>Personas.país</em> tendrá, por defecto, el valor “España”. Personas.ciudad tendrá, por defecto, el valor “Almería”.</li> <li>Hay que activar el borrado y actualización en cascada en todas las relaciones.</li> <li>Es conveniente definir todas las claves como restricciones (<em>constraints</em>), con el objeto de poder modificarlas más adelante.</li> <li>Todos los datos son cadenas de caracteres (la longitud puedes elegirla tú, siempre que sea razonable), excepto los siguientes: <ul> <li><em>Coches.potencia</em> es un número real con tres cifras enteras y dos cifras decimales.</li> <li><em>Seguros.núm-póliza</em> es un número entero largo.</li> <li><em>Seguros.franquicia</em> es un número real con seis cifras enteras y dos decimales.</li> <li><em>Seguros.fecha</em> es de tipo fecha (claro)</li> </ul> </li> </ul> <p><strong>b) Realizar los siguientes cambios en las tablas</strong> (ALTER TABLE, INSERT, UPDATE, DELETE):</p> <ol> <li>Agregar a la tabla Personas el campo <em>sexo</em>, con un sólo carácter y obligatorio.</li> <li>Desactivar el borrado en cascada (no la actualización) de la clave ajena en la tabla Seguros.</li> <li>Insertar estos registros: <ul> <li>En <em>Personas</em>, DNI = 1111A, Juan Martín, C/ Barco, Roquetas de Mar, España</li> <li>En <em>Seguros</em>, Nº Póliza = 1, Compañía = Mapfre, Franquicia = 299,95 €, Tomador = Juan Martín</li> </ul> </li> <li>Modificar todos los seguros de tipo “Todo riesgo” para que la franquicia sea de 120 €</li> <li>Borrar todas las personas que no vivan ni en España ni en Portugal.</li> </ol> <p><strong>c) Realizar las siguientes consultas</strong> (SELECT):</p> <ol> <li>Nombre y apellidos, ordenados alfabéticamente, de todas las personas que viven en ciudades que empiezan por “A”.</li> <li>Compañías de seguros que aseguran coches de la marca Seat y cuyas pólizas fueron contratadas después del año 2005.</li> <li>Precio medio de las franquicias de los coches asegurados por la compañía Mapfre y cuya potencia es mayor de 100 caballos.</li> <li>Nombre, apellidos, marca, modelo y compañía aseguradora de los vehículos cuyos dueños tienen varios coches y están asegurados en compañías diferentes.</li> </ol> <h4 id="ejercicio-2-biblioteca"> <a href="#ejercicio-2-biblioteca" class="anchor-heading" aria-labelledby="ejercicio-2-biblioteca"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 2: Biblioteca </h4> <p>Una base de datos de una biblioteca que lleva algún tiempo funcionando contiene, entre otras tablas, estas dos:</p> <ul> <li>Libros (cód-libro#, título, editorial, cód-autor)</li> <li>Autores (cód-autor#, nombre, apellidos, país, fecha-nacimiento)</li> </ul> <p>Por un error de implementación, el campo <em>libros.cód-autor</em> no se hizo clave ajena durante la creación de la tabla. Ahora se ha intentado crear la clave ajena con un ALTER TABLE, pero la base de datos impide la ejecución de la instrucción, alegando que se produce una violación de la integridad referencial.</p> <ol> <li>¿A qué puede deberse que la base de datos esté dándonos ese error?</li> <li>¿Cómo puede solucionarse? Escribe el código SQL que estimes necesario para intentar arreglar el problema.</li> </ol> <h4 id="ejercicio-3-academia-de-idiomas"> <a href="#ejercicio-3-academia-de-idiomas" class="anchor-heading" aria-labelledby="ejercicio-3-academia-de-idiomas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 3: academia de idiomas </h4> <p>La base de datos de una academia de idiomas está formada por las siguientes tablas:</p> <ul> <li>PROFESORES(#dni-prof, nombre, apellidos, idioma)</li> <li>ALUMNOS(#dni-alum, nombre, apellidos)</li> <li>GRUPOS(#cod-grupo, denominación)</li> <li>HORARIOS(#cod-grupo, #día-semana, #dni-prof, hora-inicio, hora-fin, aula)</li> </ul> <p>Se pide escribir las sentencias SQL necesarias para:</p> <ol> <li>Crear la tabla HORARIOS. Las claves y las horas son campos obligatorios. El aula es un número entero, y, aunque no es obligatorio, tomará por defecto el valor 1.</li> <li>Modificar la tabla ALUMNOS para agregar el campo “cod-grupo”, que es una clave ajena.</li> <li>Insertar el registro [“12345678-Z”, “Juan”, “López López”, “Italiano”] en la tabla PROFESORES.</li> <li>Consultar los nombres y apellidos de los profesores que dan clase de francés de lunes a jueves a partir de las 16:00 horas, junto con la denominación de los grupos a los que dan clase y el horario de cada día.</li> <li>Consultar los nombres y apellidos de los alumnos que reciben clases de al menos dos idiomas diferentes.</li> <li>Consultar los nombres y apellidos de los alumnos que reciben clases de INGLÉS y de FRANCÉS.</li> <li>Consultar los nombres y apellidos de los alumnos que reciben clases de INGLÉS o de FRANCÉS.</li> <li>Consultar los nombres y apellidos de los alumnos que reciben clases de INGLÉS pero no reciben clases de ALEMÁN.</li> </ol> <h4 id="ejercicio-4-concesionario-de-automóviles"> <a href="#ejercicio-4-concesionario-de-automóviles" class="anchor-heading" aria-labelledby="ejercicio-4-concesionario-de-automóviles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 4: concesionario de automóviles </h4> <p>Una empresa de venta de coches nuevos y usados tiene en su base de datos estas tablas:</p> <ul> <li>COCHES(cod_coche#, marca, modelo, color, precio, tipo) – tipo puede ser “nuevo”, “km. 0” o “usado”</li> <li>COCHES_USADOS(cod_coche#, año, kilometraje, descuento, cod_desperfecto)</li> <li>DESPERFECTOS(cod_desperfecto#, descripción, observaciones)</li> <li>TIENDAS(cod_tienda#, ciudad, provincia, dirección, teléfono)</li> <li>COCHES-ESTÁN-EN-TIENDAS (cod_coche#, cod_tienda#, cantidad)</li> <li>CLIENTES (cod_cliente#, nombre, apellidos, domicilio, ciudad, provincia)</li> <li>VENTAS(cod_coche#, cod_tienda#, cod_cliente#, fecha)</li> </ul> <p>A partir de esas tablas, se pide:</p> <ol> <li>Crear la tabla COCHES, de forma coherente a cómo la hayas diseñado en el primer apartado. Utiliza tipos de datos SQL adecuados a la información que se guardará en cada campo. El campo cod_coche es obligatorio, y el campo precio tiene 10000,00 como valor por defecto.</li> <li>Se ha detectado que algunos clientes tienen una “provincia” con valor nulo, pero, en cambio, sí que tienen un valor asignado al campo “ciudad”. Escribe la(s) intrucción(es) SQL necesarias para arreglar este problema de la mejor manera que se te ocurra.</li> <li>Obtener el NIF de los clientes y los códigos de tienda que no sean de la misma ciudad.</li> <li>Obtener la matrícula, la marca y el modelo de los coches vendidos en tiendas de la provincia de Madrid que no hayan sido vendidos en ninguna otra provincia.</li> <li>Obtener el código, ciudad y dirección de las tiendas que tengan entre 5 y 10 vehículos usados que sean de marca “Renault” y modelo “Megane”.</li> <li>Obtener el código, marca y modelo del coche, así como el nombre y apellidos del cliente, de todos los vehículos vendidos a un cliente de Almería por un concesionario de Almería.</li> <li>Obtener el nombre y apellidos de clientes que hayan adquirido un coche en algún concesionario que posea actualmente en stock el vehículo marca “Seat”, modelo “León”.</li> <li>Obtener los nombres y apellidos de clientes que no han comprado ningún coche de color rojo a ningún concesionario de Andalucía.</li> </ol> <h4 id="ejercicio-5"> <a href="#ejercicio-5" class="anchor-heading" aria-labelledby="ejercicio-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 5 </h4> <p>Las siguientes tablas contienen información sobre la liga de fútbol (equipos, jugadores, árbitros y partidos):</p> <ul> <li>FUTBOLISTAS (cod-futbolista#, nombre, apellidos, fecha-nac, peso, estatura)</li> <li>PARTIDOS (cod-partido#, jornada, fecha, resultado)</li> <li>PARTICIPAN (cod-futbolista#, cod-partido#, minutos, goles, tarjetas) - Relación entre FUTBOLISTAS y PARTIDOS</li> <li>EQUIPOS (nombre-eq#, año_fundación, presidente, num_socios, estadio)</li> <li>JUEGAN (nombre-eq-casa#, nombre_eq_visitante#, cod_partido#) - Relación entre EQUIPOS y PARTIDOS</li> <li>CONTRATOS (num-contrato#, cod-futbolista, nombre-eq, fecha-contrato, duración, ficha, claúsulas)</li> <li>ÁRBITROS (num-colegiado#, colegio, nombre, apellidos, num-temporadas)</li> <li>ARBITRAN (cod-partido#, num-colegiado#, función) - Relación entre ÁRBITROS y PARTIDOS (“función” puede ser “principal”, “juez de línea” o “cuarto”)</li> </ul> <p>Realiza estas consultas en lenguaje SQL:</p> <ol> <li>El número de goles marcados por el jugador Pantuflo Zapatilla en los partidos del mes de febrero de 2007.</li> <li>El nombre de los equipos contra los que ha jugado el Almería en partidos arbitrados por Esquinas Torres, así como el resultado y la jornada de esos partidos.</li> <li>Todos los datos de la plantilla de futbolistas del Real Madrid.</li> <li>Buscar el nombre y la estatura del futbolista más alto del FC Barcelona.</li> </ol> <h2 id="87-ejercicios-resueltos"> <a href="#87-ejercicios-resueltos" class="anchor-heading" aria-labelledby="87-ejercicios-resueltos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8.7. Ejercicios resueltos </h2> <p>Vamos a resolver los ejercicios propuestos en el apartado anterior. Recuerda que es importante que, antes de mirar las soluciones, trates de resolverlos por tu cuenta.</p> <h4 id="ejercicio-1-compañía-de-seguros-1"> <a href="#ejercicio-1-compañía-de-seguros-1" class="anchor-heading" aria-labelledby="ejercicio-1-compañía-de-seguros-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 1: compañía de seguros </h4> <p><strong>a) Crear las tablas con las restricciones detalladas en el enunciado del ejercicio:</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Personas</span> <span class="p">(</span>
	<span class="n">dni</span>		<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">nombre</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">apellidos</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">ciudad</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="nv">"Almería"</span><span class="p">,</span>
	<span class="n">pa</span><span class="err">í</span><span class="n">s</span>		<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="nv">"España"</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_personas</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Seguros</span> <span class="p">(</span>
	<span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span>	<span class="nb">BIGINT</span>	<span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">compa</span><span class="err">ñí</span><span class="n">a</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">tipo</span>		<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
	<span class="n">franquicia</span>	<span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">dni_tomador</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">fecha</span>		<span class="nb">DATE</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_seguros</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_seguros_personas</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni_tomador</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Personas</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Coches</span> <span class="p">(</span>
	<span class="n">matr</span><span class="err">í</span><span class="n">cula</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>	<span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">marca</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">modelo</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
	<span class="n">potencia</span>	<span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
	<span class="n">conductor</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">seguro</span>	<span class="nb">BIGINT</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_coches</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">matricula</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_coches_personas</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">conductor</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Personas</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_coches_seguros</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">seguro</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Seguros</span><span class="p">(</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">);</span>
</code></pre></div></div> <p><strong>b) Realizar los siguientes cambios en las tablas</strong></p> <p><strong>Agregar a la tabla Personas el campo sexo, con un sólo carácter y obligatorio.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Personas</span>
	<span class="k">ADD</span> <span class="n">Sexo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Desactivar el borrado en cascada (no la actualización) de la clave ajena en la tabla Seguros.</strong></p> <p>(No puede eliminarse solamente el borrado en cascada, así que hay que quitar por completo la restricción “fk_seguros_personas”, y luego volver a crearla sin borrado en cascada. Observa que esto no afectará a los datos de la tabla.)</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Seguros</span>
	<span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">fk_seguros_personas</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Seguros</span>
	<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">fk_seguros_personas</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni_tomador</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Personas</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
		<span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Insertar estos registros:</strong></p> <ul> <li>En Personas, DNI = 1111A, Juan Martín, C/ Barco, Roquetas de Mar, España</li> <li>En Seguros, Nº Póliza = 1, Compañía = Mapfre, Franquicia = 299,95 €, Tomador = Juan Martín</li> </ul> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Personas</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'1111A'</span><span class="p">,</span> <span class="s1">'Juan'</span><span class="p">,</span> <span class="s1">'Martín'</span><span class="p">,</span> <span class="s1">'C/ Barco'</span><span class="p">,</span> <span class="s1">'Roquetas de Mar'</span><span class="p">,</span> <span class="s1">'España'</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Seguros</span> <span class="p">(</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span><span class="p">,</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span><span class="p">,</span> <span class="n">franquicia</span><span class="p">,</span> <span class="n">dni_tomador</span><span class="p">)</span>
	<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Mapfre'</span><span class="p">,</span> <span class="mi">299</span><span class="p">.</span><span class="mi">95</span><span class="p">,</span> <span class="s1">'1111A'</span><span class="p">);</span>
</code></pre></div></div> <p><strong>Modificar todos los seguros de tipo “Todo riesgo” para que la franquicia sea de 120 €</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">Pacientes</span>
	<span class="k">SET</span> <span class="n">pais</span> <span class="o">=</span> <span class="s1">'Desconocido'</span>
	<span class="k">WHERE</span> <span class="n">tipo</span> <span class="o">=</span> <span class="s1">'Todo riesgo'</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Borrar todas las personas que no vivan ni en España ni en Portugal.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Personas</span>
	<span class="k">WHERE</span> <span class="n">pa</span><span class="err">í</span><span class="n">s</span> <span class="o">&lt;&gt;</span> <span class="s1">'España'</span> <span class="k">AND</span> <span class="n">pa</span><span class="err">í</span><span class="n">s</span> <span class="o">&lt;&gt;</span> <span class="s1">'Portugal'</span><span class="p">;</span>
</code></pre></div></div> <p><strong>c) Realizar las siguientes consultas</strong> (SELECT):</p> <p><strong>Nombre y apellidos, ordenados alfabéticamente, de todas las personas que viven en ciudades que empiezan por “A” (consideraremos también la “A” con tilde):</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Personas</span>
	<span class="k">WHERE</span> <span class="n">ciudad</span> <span class="k">LIKE</span> <span class="s1">'A*'</span>  <span class="k">OR</span>  <span class="n">ciudad</span> <span class="k">LIKE</span> <span class="s1">'Á*'</span>
	<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">nombre</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Compañías de seguros que aseguran coches de la marca Seat y cuyas pólizas fueron contratadas después del año 2005.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span>
	<span class="k">FROM</span> <span class="n">Seguros</span><span class="p">,</span> <span class="n">Coches</span>
	<span class="k">WHERE</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">seguro</span>
	    <span class="k">AND</span> <span class="n">marca</span> <span class="o">=</span> <span class="s1">'Seat'</span>
	    <span class="k">AND</span> <span class="n">fecha</span> <span class="o">&gt;</span> <span class="s1">'31/12/2005'</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Precio medio de las franquicias de los coches asegurados por la compañía Mapfre y cuya potencia es mayor de 100 caballos.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">franquicia</span><span class="p">)</span>
	<span class="k">FROM</span> <span class="n">Seguros</span><span class="p">,</span> <span class="n">Coches</span>
	<span class="k">WHERE</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">seguro</span>
	    <span class="k">AND</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span> <span class="o">=</span> <span class="s1">'Mapfre'</span>
	    <span class="k">AND</span> <span class="n">potencia</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Nombre, apellidos, marca, modelo y compañía aseguradora de los vehículos cuyos dueños tienen varios coches y están asegurados en compañías diferentes.</strong></p> <p>Esta consulta no puede resolverse tal y como está, porque no conocemos a los dueños de los vehículos. Esa información, simplemente, no está en la base de datos. Así que supondremos que los dueños y los conductores son los mismos, porque los conductores sí están en la base de datos.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">marca</span><span class="p">,</span> <span class="n">modelo</span><span class="p">,</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span>
	<span class="k">FROM</span> <span class="n">Personas</span> <span class="k">AS</span> <span class="n">P1</span><span class="p">,</span> <span class="n">Coches</span> <span class="k">AS</span> <span class="n">C1</span><span class="p">,</span> <span class="n">Seguros</span>
	<span class="k">WHERE</span> <span class="n">P1</span><span class="p">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">dni_tomador</span>
	     <span class="k">AND</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">seguro</span>
	     <span class="k">AND</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span> 
 				<span class="k">FROM</span> <span class="n">Personas</span> <span class="k">AS</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Coches</span> <span class="k">AS</span> <span class="n">C2</span><span class="p">,</span> <span class="n">Seguros</span>
				<span class="k">WHERE</span> <span class="n">P2</span><span class="p">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">dni_tomador</span>
				     <span class="k">AND</span> <span class="n">Seguros</span><span class="p">.</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span> <span class="o">=</span> <span class="n">C2</span><span class="p">.</span><span class="n">seguro</span>
				     <span class="k">AND</span> <span class="n">P2</span><span class="p">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">P1</span><span class="p">.</span><span class="n">dni</span>
				     <span class="k">AND</span> <span class="n">C2</span><span class="p">.</span><span class="n">matr</span><span class="err">í</span><span class="n">cula</span> <span class="o">&lt;&gt;</span> <span class="n">C1</span><span class="p">.</span><span class="n">matr</span><span class="err">í</span><span class="n">cula</span><span class="p">);</span>
</code></pre></div></div> <p>Otra solución posible pasa por conectar la consulta y la subconsulta a través del dni del conductor:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">marca</span><span class="p">,</span> <span class="n">modelo</span><span class="p">,</span> <span class="n">compa</span><span class="err">ñí</span><span class="n">a</span>
	<span class="k">FROM</span> <span class="n">Personas</span> <span class="k">AS</span> <span class="n">P1</span><span class="p">,</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Seguros</span> <span class="k">AS</span> <span class="n">S1</span>
	<span class="k">WHERE</span> <span class="n">P1</span><span class="p">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">S1</span><span class="p">.</span><span class="n">dni_tomador</span>
	     <span class="k">AND</span> <span class="n">S1</span><span class="p">.</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">seguro</span>
	     <span class="k">AND</span> <span class="n">dni</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">dni</span> 
 			<span class="k">FROM</span> <span class="n">Personas</span> <span class="k">AS</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Seguros</span> <span class="k">AS</span> <span class="n">S2</span>
			<span class="k">WHERE</span> <span class="n">P2</span><span class="p">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">S2</span><span class="p">.</span><span class="n">dni_tomador</span>
			     <span class="k">AND</span> <span class="n">S2</span><span class="p">.</span><span class="n">num_p</span><span class="err">ó</span><span class="n">liza</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">seguro</span>
			     <span class="k">AND</span> <span class="n">S1</span><span class="p">.</span><span class="n">compa</span><span class="err">ñí</span><span class="n">a</span> <span class="o">&lt;&gt;</span> <span class="n">S2</span><span class="p">.</span><span class="n">compa</span><span class="err">ñí</span><span class="n">a</span>
			     <span class="k">AND</span> <span class="n">P1</span><span class="p">.</span><span class="n">dni</span> <span class="o">=</span> <span class="n">P2</span><span class="p">.</span><span class="n">dni</span><span class="p">);</span>
</code></pre></div></div> <h4 id="ejercicio-2-biblioteca-1"> <a href="#ejercicio-2-biblioteca-1" class="anchor-heading" aria-labelledby="ejercicio-2-biblioteca-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 2: Biblioteca </h4> <p><strong>¿A qué puede deberse que la base de datos esté dándonos ese error?</strong></p> <p>En la tabla de Libros debe existir al menos un código de autor que no se corresponde con ningún autor de la tabla de Autores. Probablemente se deba a un error en la introducción de los datos. Al convertir a Libros.cód_autor en clave ajena que hace referencia a Autor.cód_autor, la integridad referencial quedaría rota, y por eso el gestor de base de datos nos impide crear esa clave ajena.</p> <p><strong>¿Cómo puede solucionarse? Escribe el código SQL que estimes necesario para intentar arreglar el problema.</strong></p> <p>Habría que localizar los registros de Libros que tienen asociados autores que no existen en la tabla de Autores. Una vez localizados, tenemos varias opciones: a) Borrarlos (una solución un poco bestia) b) Moverlos a una nueva tabla temporal, para que el administrador de la base de datos haga lo que estime conveniente con esos registros (solución válida porque no destruye datos, pero muy trabajosa) c) Asignarles un autor “ficticio”. Por ejemplo, podemos crear un autor llamado “Desconocido” en la tabla de autores con un código especial (p.ej: el 0), y asignar esos libros al nuevo autor. Esta será la solución que adoptaremos.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Autores</span> <span class="p">(</span><span class="k">c</span><span class="err">ó</span><span class="n">d_autor</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">'Desconocido'</span><span class="p">);</span>

<span class="k">UPDATE</span> <span class="n">Libros</span> <span class="k">SET</span> <span class="k">c</span><span class="err">ó</span><span class="n">d_autor</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">WHERE</span> <span class="k">c</span><span class="err">ó</span><span class="n">d_autor</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">c</span><span class="err">ó</span><span class="n">d_autor</span> <span class="k">FROM</span> <span class="n">Autores</span><span class="p">);</span>
</code></pre></div></div> <p>Ahora sí podemos crear la clave ajena de Autores sin provocar una violación de la integridad referencial. Además, deberíamos repasar los datos de la tabla de Autores para asignar autores válidos a los libros marcados con el código de autor 0 (esto hay que hacerlo manualmente: la base de datos no puede saber qué códigos son los correctos)</p> <h4 id="ejercicio-3-academia-de-idiomas-1"> <a href="#ejercicio-3-academia-de-idiomas-1" class="anchor-heading" aria-labelledby="ejercicio-3-academia-de-idiomas-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 3: academia de idiomas </h4> <p><strong>Crear la tabla HORARIOS. Las claves y las horas son campos obligatorios. El aula es un número entero, y, aunque no es obligatorio, tomará por defecto el valor 1.</strong></p> <p>Como la clave primaria es triple (cod_grupo, dia_semana, dni_prof), no tiene sentido declarar esos atributos como UNIQUE de forma individual: lo que no puede repetirse es el conjunto de los tres, de modo que hay que crear una restricción de tabla que denominaremos pk_horarios_unique:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Horarios</span> <span class="p">(</span>
	<span class="n">cod_grupo</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">dia_semana</span>	<span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">dni_prof</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">hora_inicio</span>	<span class="nb">TIME</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">hora_fin</span>	<span class="nb">TIME</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">aula</span>		<span class="nb">SMALLINT</span>	<span class="k">DEFAULT</span> <span class="mi">1</span><span class="p">,</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_horarios</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_grupo</span><span class="p">,</span> <span class="n">dia_semana</span><span class="p">,</span> <span class="n">dni_prof</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">pk_horarios_unique</span>
		<span class="k">UNIQUE</span> <span class="p">(</span><span class="n">cod_grupo</span><span class="p">,</span> <span class="n">dia_semana</span><span class="p">,</span> <span class="n">dni_prof</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_horarios_1</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_grupo</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Grupos</span><span class="p">(</span><span class="n">cod_grupo</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">fk_horarios_2</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dni_prof</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Profesores</span><span class="p">(</span><span class="n">dni_prof</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div> <p><strong>Modificar la tabla ALUMNOS para agregar el campo “cod-grupo”, que es una clave ajena.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Alumnos</span>
	<span class="k">ADD</span> <span class="n">cod_grupo</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Alumnos</span>
	<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">fk_alumnos</span>
		<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_grupo</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Grupos</span><span class="p">(</span><span class="n">cod_grupo</span><span class="p">);</span>
</code></pre></div></div> <p><strong>Insertar el registro [“12345678-Z”, “Juan”, “López López”, “Italiano”] en la tabla PROFESORES.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Profesores</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'12345678-Z'</span><span class="p">,</span> <span class="s1">'Juan'</span><span class="p">,</span> <span class="s1">'López'</span><span class="p">,</span> <span class="s1">'Italiano'</span><span class="p">);</span>
</code></pre></div></div> <p><strong>Consultar los nombres y apellidos de los profesores que dan clase de francés de lunes a jueves a partir de las 16:00 horas, junto con la denominación de los grupos a los que dan clase y el horario de cada día.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span><span class="p">,</span> <span class="n">denominaci</span><span class="err">ó</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="err">í</span><span class="n">a_semana</span><span class="p">,</span> <span class="n">hora_inicio</span><span class="p">,</span> <span class="n">hora_fin</span> 
	<span class="k">FROM</span> <span class="n">Profesores</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Grupos</span>
	<span class="k">WHERE</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Grupos</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="p">(</span><span class="n">d</span><span class="err">í</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'L'</span> <span class="k">OR</span> <span class="n">d</span><span class="err">í</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'M'</span> <span class="k">OR</span> <span class="n">d</span><span class="err">í</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'X'</span> <span class="k">OR</span> <span class="n">d</span><span class="err">í</span><span class="n">a_semana</span> <span class="o">=</span> <span class="s1">'J'</span><span class="p">)</span>
	    <span class="k">AND</span> <span class="n">hora_inicio</span> <span class="o">&gt;=</span> <span class="s1">'16:00'</span>
	    <span class="k">AND</span> <span class="n">idioma</span> <span class="o">=</span> <span class="s1">'Francés'</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Consultar los nombres y apellidos de los alumnos que reciben clases de al menos dos idiomas diferentes.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span> <span class="k">AS</span> <span class="n">Profes1</span>
	<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profes1</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">dni</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">dni</span> 
				<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span> <span class="k">AS</span> <span class="n">Profes2</span>
				<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
			 	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profes2</span><span class="p">.</span><span class="n">dni_prof</span>
				    <span class="k">AND</span> <span class="n">Profes1</span><span class="p">.</span><span class="n">idioma</span> <span class="o">&lt;&gt;</span> <span class="n">Profes2</span><span class="p">.</span><span class="n">idioma</span><span class="p">);</span>
</code></pre></div></div> <p><strong>Consultar los nombres y apellidos de los alumnos que reciben clases de INGLÉS y de FRANCÉS.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span>
	<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Inglés"</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span>
	<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Francés"</span>
</code></pre></div></div> <p><strong>Consultar los nombres y apellidos de los alumnos que reciben clases de INGLÉS o de FRANCÉS.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span>
	<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="p">(</span><span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Inglés"</span> <span class="k">OR</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Francés"</span><span class="p">);</span>
</code></pre></div></div> <p><strong>Consultar los nombres y apellidos de los alumnos que reciben clases de INGLÉS pero no reciben clases de ALEMÁN.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span>
	<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Inglés"</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Alumnos</span><span class="p">,</span> <span class="n">Horarios</span><span class="p">,</span> <span class="n">Profesores</span>
	<span class="k">WHERE</span> <span class="n">Alumnos</span><span class="p">.</span><span class="n">cod_grupo</span> <span class="o">=</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">cod_grupo</span>
	    <span class="k">AND</span> <span class="n">Horarios</span><span class="p">.</span><span class="n">dni_prof</span> <span class="o">=</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">dni_prof</span>
	    <span class="k">AND</span> <span class="n">Profesores</span><span class="p">.</span><span class="n">idioma</span> <span class="o">=</span> <span class="nv">"Alemán"</span><span class="p">;</span>
</code></pre></div></div> <h4 id="ejercicio-4-concesionario-de-automóviles-1"> <a href="#ejercicio-4-concesionario-de-automóviles-1" class="anchor-heading" aria-labelledby="ejercicio-4-concesionario-de-automóviles-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 4: concesionario de automóviles </h4> <p><strong>Crear la tabla COCHES, de forma coherente a cómo la hayas diseñado en el primer apartado. Utiliza tipos de datos SQL adecuados a la información que se guardará en cada campo. El campo cod_coche es obligatorio, y el campo precio tiene 10000,00 como valor por defecto.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Coches</span> <span class="p">(</span>
	<span class="n">cod_coche</span> 	<span class="nb">INTEGER</span>	<span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
	<span class="n">marca</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">modelo</span>	<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>	<span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="n">color</span>		<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
	<span class="n">precio</span>	<span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>	<span class="k">DEFAULT</span> <span class="mi">10000</span><span class="p">.</span><span class="mi">00</span><span class="p">,</span>
	<span class="n">tipo</span>		<span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>	
	<span class="k">CONSTRAINT</span> <span class="n">pk_coches</span>
		<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cod_coche</span><span class="p">),</span>
	<span class="k">CONSTRAINT</span> <span class="n">valores_tipo</span>
		<span class="k">CHECK</span> <span class="p">(</span><span class="n">tipo</span> <span class="o">=</span> <span class="nv">"NUEVO"</span> <span class="k">OR</span> <span class="n">tipo</span> <span class="o">=</span> <span class="nv">"KM.0"</span> <span class="k">OR</span> <span class="n">tipo</span> <span class="o">=</span> <span class="nv">"USADO"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div> <p><strong>Se ha detectado que algunos clientes tienen una “provincia” con valor nulo, pero, en cambio, sí que tienen un valor asignado al campo “ciudad”. Escribe la(s) intrucción(es) SQL necesarias para arreglar este problema de la mejor manera que se te ocurra.</strong></p> <p>Eso no habría ocurrido si la base de datos hubiera estado bien diseñada, con las provincias y las ciudades en sus respectivas tablas independientes de los Clientes.</p> <p>Ahora habremos perdido datos irremediablemente. Lo único que podemos hacer es insertar una provincia genérica (por ejemplo, “Desconocida”) en los registros que hayan perdido su provincia, para evitar tener valores nulos en la tabla de Clientes.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">Clientes</span>
	<span class="k">SET</span> <span class="n">Provincia</span> <span class="o">=</span> <span class="nv">"Desconocida"</span>
	<span class="k">WHERE</span> <span class="n">Provincia</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Obtener el NIF de los clientes y los códigos de tienda que no sean de la misma ciudad.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">cod_cliente</span><span class="p">,</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	<span class="k">FROM</span> <span class="n">Clientes</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">cod_cliente</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_cliente</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">ciudad</span> <span class="o">&lt;&gt;</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">ciudad</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Obtener la matrícula, la marca y el modelo de los coches vendidos en tiendas de la provincia de Madrid que no hayan sido vendidos en ninguna otra provincia.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">SELECT</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span><span class="p">,</span> <span class="n">marca</span><span class="p">,</span> <span class="n">modelo</span>
	<span class="k">FROM</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">provincia</span> <span class="o">=</span> <span class="nv">"Madrid"</span><span class="p">)</span>
<span class="k">EXCEPT</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span><span class="p">,</span> <span class="n">marca</span><span class="p">,</span> <span class="n">modelo</span>
	<span class="k">FROM</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">provincia</span> <span class="o">&lt;&gt;</span> <span class="nv">"Madrid"</span><span class="p">);</span>
</code></pre></div></div> <p>Existe una solución alternativa basada en subconsultas, pero el resultado debe ser el mismo:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span><span class="p">,</span> <span class="n">marca</span><span class="p">,</span> <span class="n">modelo</span>
	<span class="k">FROM</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">provincia</span> <span class="o">=</span> <span class="nv">"Madrid"</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">cod_coche</span>
	<span class="k">FROM</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">provicia</span> <span class="o">&lt;&gt;</span> <span class="nv">"Madrid"</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Obtener el código, ciudad y dirección de las tiendas que tengan entre 5 y 10 vehículos usados que sean de marca “Renault” y modelo “Megane”.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span><span class="p">,</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">ciudad</span><span class="p">,</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">direcci</span><span class="err">ó</span><span class="n">n</span>
	<span class="k">FROM</span> <span class="n">Tiendas</span><span class="p">,</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">tiendas</span><span class="p">,</span> <span class="n">Coches</span>
	<span class="k">WHERE</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">tiendas</span><span class="p">.</span><span class="n">cod_coche</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">tiendas</span><span class="p">.</span><span class="n">cantidad</span> <span class="k">BETWEEN</span> <span class="mi">5</span> <span class="k">AND</span> <span class="mi">10</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">marca</span> <span class="o">=</span> <span class="nv">"Renault"</span> <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">modelo</span> <span class="o">=</span> <span class="nv">"Megane"</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="nv">"U"</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Obtener el código, marca y modelo del coche, así como el nombre y apellidos del cliente, de todos los vehículos vendidos a un cliente de Almería por un concesionario de Almería.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span><span class="p">,</span> <span class="n">marca</span><span class="p">,</span> <span class="n">modelo</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Clientes</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_cliente</span> <span class="o">=</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">cod_cliente</span>
	    <span class="k">AND</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">ciudad</span> <span class="o">=</span> <span class="nv">"Almería"</span>
	    <span class="k">AND</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">ciudad</span> <span class="o">=</span> <span class="nv">"Almería"</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Obtener el nombre y apellidos de clientes que hayan adquirido un coche en algún concesionario que posea actualmente en stock el vehículo marca “Seat”, modelo “León”.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Coches</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Clientes</span><span class="p">,</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">tiendas</span>
	<span class="k">WHERE</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">cod_cliente</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_cliente</span> 
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_coches</span> <span class="o">=</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">cod_coches</span> <span class="o">=</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">venta</span><span class="p">.</span><span class="n">cod_coche</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">marca</span> <span class="o">=</span> <span class="nv">"Seat"</span> <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">modelo</span> <span class="o">=</span> <span class="nv">"León"</span>
	    <span class="k">AND</span> <span class="n">Coches</span><span class="o">-</span><span class="n">est</span><span class="err">á</span><span class="n">n</span><span class="o">-</span><span class="n">en</span><span class="o">-</span><span class="n">tienda</span><span class="p">.</span><span class="n">cantidad</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Obtener los nombres y apellidos de clientes que no han comprado ningún coche de color rojo a ningún concesionario de Andalucía.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">apellidos</span>
	<span class="k">FROM</span> <span class="n">Clientes</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
	<span class="k">WHERE</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">cod_cliente</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_cliente</span>
	    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
	    <span class="k">AND</span> <span class="n">Cliende</span><span class="p">.</span><span class="n">cod_cliente</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">cod_cliente</span> 
					<span class="k">FROM</span> <span class="n">Clientes</span><span class="p">,</span> <span class="n">Ventas</span><span class="p">,</span> <span class="n">Tiendas</span>
					<span class="k">WHERE</span> <span class="n">Clientes</span><span class="p">.</span><span class="n">cod_cliente</span> <span class="o">=</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_cliente</span>
					    <span class="k">AND</span> <span class="n">Ventas</span><span class="p">.</span><span class="n">cod_tienda</span> <span class="o">=</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">cod_tienda</span>
					    <span class="k">AND</span> <span class="n">Coches</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="nv">"Rojo"</span>
					    <span class="k">AND</span> <span class="n">Tiendas</span><span class="p">.</span><span class="n">provincia</span> <span class="k">IN</span> <span class="p">(</span><span class="nv">"Almería"</span><span class="p">,</span> <span class="nv">"Granada"</span><span class="p">,</span> <span class="nv">"Jaén"</span><span class="p">,</span>
						<span class="nv">"Málaga"</span><span class="p">,</span> <span class="nv">"Córdoba"</span><span class="p">,</span> <span class="nv">"Sevilla"</span><span class="p">,</span> <span class="nv">"Cádiz"</span><span class="p">,</span> <span class="nv">"Huelva"</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div></div> <h4 id="ejercicio-5-1"> <a href="#ejercicio-5-1" class="anchor-heading" aria-labelledby="ejercicio-5-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ejercicio 5 </h4> <p><strong>El número de goles marcados por el jugador Pantuflo Zapatilla en los partidos del mes de febrero de 2007.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">ADD</span><span class="p">(</span><span class="n">goles</span><span class="p">)</span>
	<span class="k">FROM</span> <span class="n">Futbolistas</span><span class="p">,</span> <span class="n">Participan</span><span class="p">,</span> <span class="n">Partidos</span>
	<span class="k">WHERE</span> <span class="n">Futbolistas</span><span class="p">.</span><span class="n">cod_futbolista</span> <span class="o">=</span> <span class="n">Participan</span><span class="p">.</span><span class="n">cod_futbolista</span>
	    <span class="k">AND</span> <span class="n">Participan</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span>
	    <span class="k">AND</span> <span class="n">nombre</span> <span class="o">=</span> <span class="nv">"Pantuflo"</span> <span class="k">AND</span> <span class="n">apellidos</span> <span class="o">=</span> <span class="nv">"Zapatilla"</span>
	    <span class="k">AND</span> <span class="n">fecha</span> <span class="k">BETWEEN</span> <span class="nv">"1/2/07"</span> <span class="k">AND</span> <span class="nv">"28/2/2007"</span><span class="p">;</span>
</code></pre></div></div> <p><strong>El nombre de los equipos contra los que ha jugado el Almería en partidos arbitrados por Esquinas Torres, así como el resultado y la jornada de esos partidos.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">SELECT</span> <span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">visitante</span><span class="p">,</span> <span class="n">resultado</span><span class="p">,</span> <span class="n">jornada</span>
	<span class="k">FROM</span> <span class="n">Juegan</span><span class="p">,</span> <span class="n">Partidos</span><span class="p">,</span> <span class="n">Arbitran</span><span class="p">,</span> <span class="n">Arbitros</span>
	<span class="k">WHERE</span> <span class="n">Juegan</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span>
	     <span class="k">AND</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Arbitran</span><span class="p">.</span><span class="n">cod_partido</span>
	     <span class="k">AND</span> <span class="n">Arbitran</span><span class="p">.</span><span class="n">num_colegiado</span> <span class="o">=</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">num_colegiado</span>
	     <span class="k">AND</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="nv">"Esquinas"</span> <span class="k">AND</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">apellidos</span> <span class="o">=</span> <span class="nv">"Torres"</span>
	     <span class="k">AND</span> <span class="n">Juegan</span><span class="p">.</span><span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">casa</span> <span class="o">=</span> <span class="nv">"Almería"</span><span class="p">)</span>
<span class="k">UNION</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">casa</span><span class="p">,</span> <span class="n">resultado</span><span class="p">,</span> <span class="n">jornada</span>
	<span class="k">FROM</span> <span class="n">Juegan</span><span class="p">,</span> <span class="n">Partidos</span><span class="p">,</span> <span class="n">Arbitran</span><span class="p">,</span> <span class="n">Arbitros</span>
	<span class="k">WHERE</span> <span class="n">Juegan</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span>
	     <span class="k">AND</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Arbitran</span><span class="p">.</span><span class="n">cod_partido</span>
	     <span class="k">AND</span> <span class="n">Arbitran</span><span class="p">.</span><span class="n">num_colegiado</span> <span class="o">=</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">num_colegiado</span>
	     <span class="k">AND</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="nv">"Esquinas"</span> <span class="k">AND</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">apellidos</span> <span class="o">=</span> <span class="nv">"Torres"</span>
	     <span class="k">AND</span> <span class="n">Juegan</span><span class="p">.</span><span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">visitante</span> <span class="o">=</span> <span class="nv">"Almería"</span><span class="p">)</span>
</code></pre></div></div> <p>Una solución alternativa es la siguiente, que muestra en todos los registros el nombre de equipo “Almería” junto con su contrincante, ya sea local o visitante:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">casa</span><span class="p">,</span> <span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">visitante</span><span class="p">,</span> <span class="n">resultado</span><span class="p">,</span> <span class="n">jornada</span>
	<span class="k">FROM</span> <span class="n">Juegan</span><span class="p">,</span> <span class="n">Partidos</span><span class="p">,</span> <span class="n">Arbitran</span><span class="p">,</span> <span class="n">Arbitros</span>
	<span class="k">WHERE</span> <span class="n">Juegan</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span>
	     <span class="k">AND</span> <span class="n">Partidos</span><span class="p">.</span><span class="n">cod_partido</span> <span class="o">=</span> <span class="n">Arbitran</span><span class="p">.</span><span class="n">cod_partido</span>
	     <span class="k">AND</span> <span class="n">Arbitran</span><span class="p">.</span><span class="n">num_colegiado</span> <span class="o">=</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">num_colegiado</span>
	     <span class="k">AND</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="nv">"Esquinas"</span> <span class="k">AND</span> <span class="n">Arbitros</span><span class="p">.</span><span class="n">apellidos</span> <span class="o">=</span> <span class="nv">"Torres"</span>
	     <span class="k">AND</span> <span class="p">(</span><span class="n">Juegan</span><span class="p">.</span><span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">visitante</span> <span class="o">=</span> <span class="nv">"Almería"</span> <span class="k">OR</span> <span class="n">Juegan</span><span class="p">.</span><span class="n">nombre</span><span class="o">-</span><span class="n">eq</span><span class="o">-</span><span class="n">casa</span> <span class="o">=</span> <span class="nv">"Almeria"</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Todos los datos de la plantilla de futbolistas del Real Madrid.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">Futbolistas</span><span class="p">.</span><span class="o">*</span>
	<span class="k">FROM</span> <span class="n">Futbolistas</span><span class="p">,</span> <span class="n">Contratos</span>
	<span class="k">WHERE</span> <span class="n">Futbolistas</span><span class="p">.</span><span class="n">cod</span><span class="o">-</span><span class="n">futbolista</span> <span class="o">=</span> <span class="n">Contratos</span><span class="p">.</span><span class="n">cod</span><span class="o">-</span><span class="n">futbolista</span>
	    <span class="k">AND</span> <span class="n">Contratos</span><span class="p">.</span><span class="n">nombre_eq</span> <span class="o">=</span> <span class="nv">"Real Madrid"</span><span class="p">;</span>
</code></pre></div></div> <p><strong>Buscar el nombre y la estatura del futbolista más alto del FC Barcelona.</strong></p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">estatura</span>
	<span class="k">FROM</span> <span class="n">Futbolistas</span><span class="p">,</span> <span class="n">Contratos</span>
	<span class="k">WHERE</span> <span class="n">Futbolistas</span><span class="p">.</span><span class="n">cod</span><span class="o">-</span><span class="n">futbolista</span> <span class="o">=</span> <span class="n">Contratos</span><span class="p">.</span><span class="n">cod</span><span class="o">-</span><span class="n">futbolista</span>
	    <span class="k">AND</span> <span class="n">Contratos</span><span class="p">.</span><span class="n">nombre_eq</span> <span class="o">=</span> <span class="nv">"FC Barcelona"</span>
	    <span class="k">AND</span> <span class="n">estatura</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">estatura</span><span class="p">)</span>
				<span class="k">FROM</span> <span class="n">Futbolistas</span><span class="p">,</span> <span class="n">Contratos</span>
				<span class="k">WHERE</span> <span class="n">Futbolistas</span><span class="p">.</span><span class="n">cod</span><span class="o">-</span><span class="n">futbolista</span> <span class="o">=</span> <span class="n">Contratos</span><span class="p">.</span><span class="n">cod</span><span class="o">-</span><span class="n">futbolista</span>
				    <span class="k">AND</span> <span class="n">Contratos</span><span class="p">.</span><span class="n">nombre_eq</span> <span class="o">=</span> <span class="nv">"FC Barcelona"</span><span class="p">);</span>
</code></pre></div></div> <hr> <h2 class="text-delta">Table of contents</h2> <ul> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
