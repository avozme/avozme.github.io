<body style='background-color: grey; overflow: hidden' onkeydown='mover_coche(event)' id='pagina'>
    <img id='coche' src='coche.png' height='150px' style='position:absolute'>

    <script>
       document.getElementById('pagina').focus();

       var pos_x = window.innerWidth / 2 - 48;
       var pos_y = window.innerHeight - 200;
       document.getElementById('coche').style.top = pos_y;
       document.getElementById('coche').style.left = pos_x;
       var d = new Date();
       var hora_inicio = d.getTime();

       var bloques_izq = new Array();
       var bloques_der = new Array();
       var num_bloque = 0;
       const altura_bloque = 20;
       var anchura_bloque =  window.innerWidth / 2 - 100;
       const anchura_carretera = 200;
       var velocidad = 100.0;
       crear_bloques();
       var timer1 = setTimeout('mover_bloques()', velocidad);
       var timer2 = setTimeout('comprobar_colisiones()', velocidad);

       function mover_coche(event) {
           if (event.key == 'ArrowRight') {
               pos_x = pos_x + 10;
           }
           if (event.key == 'ArrowLeft') {
               pos_x = pos_x - 10;
           }
           document.getElementById('coche').style.left = pos_x;
       }

       function mover_bloques() {
           for (let i = 0; i < bloques_izq.length; i++) {
                let bloque = bloques_izq[i];
                let pos_bloque = parseInt(bloque.style.top);
                if (pos_bloque >= window.innerHeight) {
                    document.body.removeChild(bloque);
                    bloques_izq.splice(i, 1);
                    num_bloque++;
                    crear_bloque("izq", num_bloque, 1);
                } else {
                    bloque.style.top = pos_bloque + altura_bloque;
                }
           }
           for (let i = 0; i < bloques_der.length; i++) {
                let bloque = bloques_der[i];
                let pos_bloque = parseInt(bloque.style.top);
                if (pos_bloque >= window.innerHeight) {
                    document.body.removeChild(bloque);
                    bloques_der.splice(i, 1);
                    num_bloque++;
                    crear_bloque("der", num_bloque, 1);
                }
                bloque.style.top = pos_bloque + altura_bloque;
           }
           velocidad = velocidad - 0.1;
           if (velocidad < 1) velocidad = 1;
           timer1 = setTimeout('mover_bloques()', velocidad);
       }

       

        function comprobar_colisiones() {
            var colision = false;
            var centro_coche_x = pos_x + 40;
            var centro_coche_y = pos_y + 65;
            for (let i = 0; i < bloques_izq.length; i++) {
                let bloque_izq_x = parseInt(bloques_izq[i].style.width);
                let bloque_izq_y = parseInt(bloques_izq[i].style.top) + (altura_bloque/2);
                let bloque_der_x = parseInt(bloques_der[i].style.left);
                let bloque_der_y = parseInt(bloques_der[i].style.top) + (altura_bloque/2);

                if ((Math.abs(bloque_izq_x - centro_coche_x) < 40) && (Math.abs(bloque_izq_y - centro_coche_y) < 65)) {
                    colision = true;
                }
                if ((Math.abs(bloque_der_x - centro_coche_x) < 40) && (Math.abs(bloque_der_y - centro_coche_y) < 65)) {
                    colision = true;
                }
            }
            if (colision) {
                document.getElementById('coche').src = 'explosion.gif';
                clearTimeout(timer1);
                clearTimeout(timer2);
                var d = new Date();
                let tiempo_juego = parseInt((d.getTime() - hora_inicio)/1000);
                var mensaje = document.createElement("div");
                mensaje.style.position = "absolute";
                mensaje.style.top = "30%";
                mensaje.style.left = "30%";
                mensaje.style.height = "100px";
                mensaje.style.width = "40%";
                mensaje.style.borderStyle = "solid";
                mensaje.style.borderColor = "black";
                mensaje.style.backgroundColor = "red";
                mensaje.style.borderWidth = "10px";
                mensaje.style.borderRadius = "10px";
                mensaje.style.textAlign = "center";
                mensaje.style.verticalAlign = "middle";
                mensaje.style.color = "white";
                mensaje.style.fontFamily = "Arial";
                mensaje.style.fontSize = "40px";
                mensaje.innerHTML = "GAME OVER<br>Has aguantado " + tiempo_juego + " segundos";
                document.body.appendChild(mensaje);
            } else {
                timer2 = setTimeout('comprobar_colisiones()', velocidad);
            }
        }


        function crear_bloques() {
            var pos_bloque = 1;
            do {
               num_bloque++;
               crear_bloque("izq", num_bloque, pos_bloque);
               crear_bloque("der", num_bloque, pos_bloque);
               pos_bloque = pos_bloque + altura_bloque;
            } while (pos_bloque < window.innerHeight);
        }

        function crear_bloque(posicion, num_bloque, pos_bloque) {
            var nuevo_bloque = document.createElement("div");
            nuevo_bloque.id = "bloque" + num_bloque + posicion;
            nuevo_bloque.style.position = "absolute";
            nuevo_bloque.style.top = pos_bloque;
            nuevo_bloque.style.height = altura_bloque;
            if (posicion == "izq") {
                nuevo_bloque.style.left = 1;
                nuevo_bloque.style.width = anchura_bloque;
            } else {
                nuevo_bloque.style.left = anchura_bloque + anchura_carretera;
                nuevo_bloque.style.width = window.innerWidth - (anchura_carretera + anchura_carretera);
            }
            nuevo_bloque.style.backgroundColor = "brown";
            nuevo_bloque.style.zIndex = 0;
            document.body.appendChild(nuevo_bloque);
            if (posicion == "izq") {
                bloques_izq.push(nuevo_bloque);
            } else {
                bloques_der.push(nuevo_bloque);
            }
            anchura_bloque = anchura_bloque + (Math.random() * 20) - 10;
        }

   </script>
</body>
